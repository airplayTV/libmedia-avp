"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[522],{64436:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(134),r=a(63939),n=a(37837),i=a(71766);class o{constructor(){(0,s.A)(this,"inCodecpar",void 0),(0,s.A)(this,"inTimeBase",void 0),(0,s.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,n.Gy)(168),(0,i.Yi)(this.inCodecpar,e),this.inTimeBase={den:r.f[15](t+4),num:r.f[15](t)},0}destroy(){this.inCodecpar&&((0,i.dn)(this.inCodecpar),this.inCodecpar=0)}}},51113:(e,t,a)=>{a.d(t,{A:()=>y});var s=a(134),r=a(63939),n=a(50932),i=a(64436),o=a(14686),c=a(4624),d=a(9705),l=a(77231),u=a(44328),p=a(37837),h=a(71517),f=a(87771),m=a(92647),g=a(67672);class y extends i.A{constructor(...e){super(...e),(0,s.A)(this,"caches",void 0),(0,s.A)(this,"cache",void 0),(0,s.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],0}sendAVPacket(e){let t=0,a=this.lastDts||r.f[17](e+16)||r.f[17](e+8),s=(0,o.s3)(r.f[20](e+24),r.f[15](e+28)).slice(),n=!1,i=!!this.cache;for(i&&(s=(0,m.A)(Uint8Array,[this.cache,s]),this.cache=null);t<s.length;){if(t>s.length-10)return this.cache=s.subarray(t),this.lastDts=a,0;const o=f.R(s.subarray(t));if(g.ai(o))return c.z3("parse ac3 header failed","src/avformat/bsf/ac3/Ac32RawFilter.ts",84),d.LR;const p={dts:a,buffer:null,duration:l.N_};let h=o.frameSize;if(p.buffer=s.subarray(t,t+h),t+h>s.length)return this.cache=s.subarray(t),this.lastDts=a,0;const m=(0,u.k)(BigInt(1536/o.sampleRate*l.SF),l.KR,this.inTimeBase);p.duration=Number(m),this.caches.push(p),t+=h,a+=m,!n&&i&&(n=!0,a=r.f[17](e+16)||r.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,h.Up)(e);const t=this.caches.shift(),a=(0,p.sY)(t.buffer.length);return(0,o.lW)(a,t.buffer.length,t.buffer),(0,h.NX)(e,a,t.buffer.length),n.M[17](e+16,t.dts),n.M[17](e+8,t.dts),n.M[17](e+48,BigInt(Math.floor(t.duration))),n.M[15](e+36,1|r.f[15](e+36)),0}return d.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),0}}},56397:(e,t,a)=>{a.d(t,{A:()=>y});var s=a(134),r=a(63939),n=a(50932),i=a(64436),o=a(14686),c=a(4624),d=a(9705),l=a(77231),u=a(44328),p=a(37837),h=a(71517),f=a(75294),m=a(89088),g=a(92647);class y extends i.A{constructor(...e){super(...e),(0,s.A)(this,"frameHeader",void 0),(0,s.A)(this,"caches",void 0),(0,s.A)(this,"cache",void 0),(0,s.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.frameHeader=new f.Vz,0}sendAVPacket(e){let t=0,a=this.lastDts||r.f[17](e+16)||r.f[17](e+8),s=(0,o.s3)(r.f[20](e+24),r.f[15](e+28)).slice(),n=!1,i=!!this.cache;for(i&&(s=(0,g.A)(Uint8Array,[this.cache,s]),this.cache=null);t<s.length;){const o=s[t]<<4|s[t+1]>>4&14;if(4094!==o)return c.z3(`found syncWord not 0xFFE, got: 0x${o.toString(16)}`,"src/avformat/bsf/mp3/Mp32RawFilter.ts",82),d.LR;const p=s[1]>>>3&3,h=(12&s[2])>>>2,g={dts:a,buffer:null,extradata:null,duration:l.N_},y=m.Y2(p,h);f.qg(this.frameHeader,s[t]<<24|s[t+1]<<16|s[t+2]<<8|s[t+3]);let v=f.CM(this.frameHeader,y);if(g.buffer=s.subarray(t,t+v),t+v>s.length){this.cache=s.subarray(t),this.lastDts=a;break}const A=(0,u.k)(BigInt(Math.floor(v/y*l.SF)),l.KR,this.inTimeBase);g.duration=Number(A),this.caches.push(g),t+=v,a+=A,!n&&i&&(n=!0,a=r.f[17](e+16)||r.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,h.Up)(e);const t=this.caches.shift(),a=(0,p.sY)(t.buffer.length);return(0,o.lW)(a,t.buffer.length,t.buffer),(0,h.NX)(e,a,t.buffer.length),n.M[17](e+16,t.dts),n.M[17](e+8,t.dts),n.M[17](e+48,BigInt(Math.floor(t.duration))),n.M[15](e+36,1|r.f[15](e+36)),0}return d.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),0}}},58469:(e,t,a)=>{a.d(t,{Bq:()=>u,Ij:()=>l,XC:()=>d,f7:()=>p,uF:()=>n});var s=a(77231),r=a(37246);const n={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},i={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,s.N_,s.N_,s.N_],c=[s.N_,1,2,3,4,5,6,7];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:r,channels:n}=function(e){let t=s.N_,a=s.N_,r=s.N_;var n,i;return e.length>=2&&(t=e[0]>>3&31,a=null!==(n=o[(7&e[0])<<1|e[1]>>7])&&void 0!==n?n:48e3,r=null!==(i=c[e[1]>>3&15])&&void 0!==i?i:2),{profile:t,sampleRate:a,channels:r}}(t);e.codecpar.profile=a,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=n}}function l(e){const t=i[e.sampleRate],a=e.chLayout.nbChannels,s=new Uint8Array(2);return s[0]=(31&e.profile)<<3|(14&t)>>1,s[1]=(1&t)<<7|(15&a)<<3,s}function u(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],s=(192&e[2])>>>6,r=(60&e[2])>>>2,n=(1&e[2])<<2|(192&e[3])>>>6,i=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let l=1===a?7:9,u=i-l;return{syncWord:t,profile:s+1,sampleRate:o[r],channels:c[n],aacFrameLength:i,numberOfRawDataBlocksInFrame:d,headerLength:l,framePayloadLength:u}}function p(e,t){function a(){const e=t.readU(2);let a=0;for(let s=0;s<=e;s++)a<<=8,a|=t.readU(8);return a}t||(t=new r.A).appendBuffer(e);const s=t.getPointer(),n={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},i=t.readU(11);if(695!==i)return-1;n.syncWord=i,n.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(n.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let s=e?a():0;const r=t.readU(5);s-=5;const i=t.readU(4);s-=4;const d=t.readU(4);if(s-=4,t.readU(3),s-=3,s>0&&t.readU(s),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),n.profile=r+1,n.sampleRate=o[i],n.channels=c[d]}let l=0;for(;;){const e=t.readU(8);if(l+=e,255!==e)break}return n.framePayloadLength=l,n.headerLength=t.getPointer()-s+(8===t.getBitLeft()?0:1),n}},87771:(e,t,a)=>{a.d(t,{R:()=>h,j:()=>r});var s=a(37246);const r=[3,4,3,7,259,263,1539,1543],n=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],i=[4,5,6,5],o=[4,6,7,6],c=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],u=[1,2,3,6],p=7;function h(e){const t=new s.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=i[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=o[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=c[a.srCode]>>a.srShift,a.bitrate=1e3*d[a.ac3BitrateCode]>>a.srShift,a.channels=l[a.channelMode]+a.lfeOn,a.frameSize=2*n[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<p)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=c[e]/2,a.srShift=1}else a.numBlocks=u[t.readU(2)],a.sampleRate=c[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=l[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(r[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},89088:(e,t,a)=>{a.d(t,{Au:()=>v,He:()=>A,XC:()=>x,Y2:()=>m,hG:()=>g,oz:()=>y});var s=a(77231);const r=[44100,48e3,32e3,0],n=[22050,24e3,16e3,0],i=[11025,12e3,8e3,0],o=[0,1152,1152,384],c=[0,576,1152,384],d=[0,576,1152,384],l=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],u=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],p=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],h=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],f=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return i[t];case 2:return n[t];case 3:return r[t]}return s.N_}function g(e,t){switch(e){case 0:return d[t];case 2:return c[t];case 3:return o[t]}return s.N_}function y(e,t,a){switch(t){case 1:switch(e){case 0:case 2:return f[a];case 3:return p[a]}break;case 2:switch(e){case 0:case 2:return f[a];case 3:return u[a]}case 3:switch(e){case 0:case 2:return h[a];case 3:return l[a]}}return s.N_}function v(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return s.N_}const A={32:"Layer1",33:"Layer2",34:"Layer3"};function x(e,t){if(t&&t.length>=4){const a=t[1]>>>3&3,s=(6&t[1])>>1,r=(12&t[2])>>>2,n=3&~(t[3]>>>6)?2:1,i=v(s),o=m(a,r);e.codecpar.profile=i,e.codecpar.sampleRate=o,e.codecpar.chLayout.nbChannels=n}}},85947:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(134);class r{constructor(){(0,s.A)(this,"type",-1),(0,s.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},50522:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(134),r=a(73146),n=a.n(r),i=a(14686),o=a(61499),c=a(63939),d=a(50932),l=a(4624),u=a(9705),p=a(85947),h=a(37837),f=a(71517),m=a(89222),g=a(73002),y=a(41654),v=a(72739),A=a(89088),x=a(15012),k=a(48416),b=a(38183),S=a(60264),I=a(44328),w=a(77231),T=a(90764),P=a(79940),M=a(52575),q=a(39342),B=a(56397),U=a(30725),C=a(51113),z="src/avformat/formats/IRtspFormat.ts";class R extends p.A{constructor(e){super(),(0,s.A)(this,"type",6),(0,s.A)(this,"rtspSession",void 0),(0,s.A)(this,"options",void 0),(0,s.A)(this,"context",void 0),(0,s.A)(this,"cacheAVPacket",void 0),this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0),this.rtspSession=new m.A(this.options.uri,e.ioReader,e.ioWriter),this.context={sessionId:"",canOutputPacket:!0},this.cacheAVPacket=0}async readHeader(e){try{let t=await this.rtspSession.options();if(200!==t.statusCode)return u.LR;if(t=await this.rtspSession.describe(),200!==t.statusCode)return l.z3(`describe failed, ${n()(t)}`,z,139),u.LR;const a=g.q(t.context);let s=1,r=0;for(let i=0;i<a.media.length;i++){if(!a.media[i].rtp.length)continue;const c=e.createStream(),d=x.fm.find((e=>e.payload===a.media[i].rtp[0].payload));if(d)c.codecpar.codecType=d.codecType,c.codecpar.codecId=d.codecId,1===d.codecType?(c.codecpar.sampleRate=a.media[i].rtp[0].rate||d.rate,c.codecpar.chLayout.nbChannels=a.media[i].rtp[0].encoding||d.encoding,c.timeBase.num=1,c.timeBase.den=c.codecpar.sampleRate):(c.timeBase.num=1,c.timeBase.den=a.media[i].rtp[0].rate||d.rate);else{"audio"===a.media[i].type?c.codecpar.codecType=1:"video"===a.media[i].type&&(c.codecpar.codecType=0);const e=a.media[i].rtp[0].codec;let t=x.xl[e]||0;c.codecpar.codecId=t,1===c.codecpar.codecType?(c.codecpar.sampleRate=a.media[i].rtp[0].rate,c.codecpar.chLayout.nbChannels=a.media[i].rtp[0].encoding,c.timeBase.num=1,c.timeBase.den=c.codecpar.sampleRate):0===c.codecpar.codecType&&(c.timeBase.num=1,c.timeBase.den=a.media[i].rtp[0].rate)}const p={ssrc:0,trackId:s++,interleaved:r,payloadContext:null,queue:null,currentDTS:BigInt(0),gopCount:0,maxPts:BigInt(0),minPts:BigInt(0),payloadType:a.media[i].rtp[0].payload,dtsDelta:(0,I.k)(BigInt(33),w.i0,c.timeBase),rangeStartOffset:BigInt(0),lastRtcpNtpTime:w.Dh,firstRtcpNtpTime:w.Dh,lastRtcpTimestamp:0,rtcpTsOffset:BigInt(0),baseTimestamp:0,timestamp:0,unwrappedTimestamp:BigInt(0),filter:null};if(a.media[i].control){let e=a.media[i].control.split(";").find((e=>e.indexOf("trackID")>-1));if(e){let t=e.split("=");p.trackId=+t[1].trim()}}if(a.media[i].fmtp.length&&U.zQ[c.codecpar.codecId]&&(p.payloadContext=U.zQ[c.codecpar.codecId](c,a.media[i].fmtp[0].config)),p.queue=new k.A(c.codecpar[o.o9],p.payloadContext),r+=2,c.privData=p,t=await this.rtspSession.setup({trackId:p.trackId,streamMode:2,interleaved:p.interleaved,multcast:!1},this.context.sessionId),200!==t.statusCode)return l.z3(`setup track ${p.trackId} failed, ${n()(t)}`,z,250),u.LR;const h=t.headers.Transport.split(";").find((e=>e.indexOf("ssrc")>-1));h&&(p.ssrc=+("0x"+h.split("=")[1].trim())),this.context.sessionId=t.headers.Session,0===c.codecpar.codecType&&(this.context.canOutputPacket=!1),86017===c.codecpar.codecId?p.filter=new B.A:86019===c.codecpar.codecId&&(p.filter=new C.A),p.filter&&p.filter.init(c.codecpar[o.o9],c.timeBase[o.o9])}return e.streams.length?(t=await this.rtspSession.play(this.context.sessionId),200!==t.statusCode?(l.z3(`play failed, ${n()(t)}`,z,283),u.LR):0):(l.z3("not found stream",z,276),u.LR)}catch(t){return l.z3(t.message,z,290),e.ioReader.error}}addPrft(e,t,a){const s=e.privData;if(s.lastRtcpNtpTime!==w.Dh){const r=(0,h.sY)(16),n=y.q(s.lastRtcpNtpTime)-w.WT,i=BigInt(a)-s.lastRtcpNtpTime,o=(0,I.k)(i,e.timeBase,w.KR);d.M[17](r,n+o),d.M[15](r+8,24),(0,f.Ow)(t,27,r,16)}}getPacketPts(e,t,a){if(-1===a)return-BigInt(1);const s=t.privData;if(s.lastRtcpNtpTime!==w.Dh&&e.streams.length>1){const e=BigInt(a-s.lastRtcpTimestamp|0),r=(s.lastRtcpNtpTime-s.firstRtcpNtpTime)*BigInt(0|t.timeBase.den)/(BigInt(0|t.timeBase.num)<<BigInt(32));return s.rangeStartOffset+s.rtcpTsOffset+r+e}return s.baseTimestamp||(s.baseTimestamp=a),s.timestamp?s.unwrappedTimestamp+=BigInt(a-s.timestamp|0):s.unwrappedTimestamp+=BigInt(a),s.timestamp=a,s.unwrappedTimestamp+s.rangeStartOffset-BigInt(s.baseTimestamp)}handleRtcpPacket(e,t,a=-1){if(200===t[1]){const s=(0,q.N)(t);let r=e.streams.find((e=>{const t=e.privData;return t.ssrc===s.ssrc||t.interleaved===a}));if(r){const t=r.privData;t.lastRtcpNtpTime=s.ntp,t.lastRtcpTimestamp=s.timestamp,t.firstRtcpNtpTime===w.Dh&&(t.firstRtcpNtpTime=s.ntp,t.baseTimestamp||(t.baseTimestamp=s.timestamp),t.rtcpTsOffset=BigInt(t.lastRtcpTimestamp-t.baseTimestamp|0),t.timestamp&&(t.currentDTS=this.getPacketPts(e,r,t.timestamp)))}}}async readAVPacket(e,t){try{for(;;){const{data:a,interleaved:s}=await this.rtspSession.readPacket();if((0,T.A)(a))this.handleRtcpPacket(e,a,s);else if((0,P.A)(a)){const r=(0,M.A)(a),n=e.streams.find((e=>{const t=e.privData;return t.ssrc===r.header.ssrc||t.interleaved===s||t.payloadType===r.header.payloadType}));if(n){const a=n.privData;a.queue.push(r),a.ssrc||(a.ssrc=r.header.ssrc);let s=!1;const p=(a,r,l)=>{let u=s?(0,f._5)():t;d.M[15](u+32,n.index),(0,i.Mr)(u+72,n.timeBase[o.o9],8);const p=(0,h.sY)(a.length);return(0,i.lW)(p,a.length,a),(0,f.NX)(u,p,a.length),d.M[17](u+16,l),d.M[17](u+8,l),r&&(d.M[15](u+36,1|c.f[15](u+36)),this.context.canOutputPacket=!0),s?(e.interval.packetBuffer.push(u),u=0):s=!0,u},m=(a,r,l=BigInt(0))=>{if(!a.length)return;let u=s?(0,f._5)():t;d.M[15](u+32,n.index),(0,i.Mr)(u+72,n.timeBase[o.o9],8);const p=(0,h.sY)(a[0].length);(0,i.lW)(p,a[0].length,a[0]),(0,f.NX)(u,p,a[0].length),d.M[17](u+16,r),d.M[17](u+8,r),d.M[15](u+36,1|c.f[15](u+36)),s?(e.interval.packetBuffer.push(u),u=0):s=!0;for(let t=1;t<a.length;t++){const s=(0,f._5)();d.M[15](s+32,n.index),(0,i.Mr)(s+72,n.timeBase[o.o9],8),d.M[17](s+16,r+BigInt(t)*l),d.M[17](s+8,r+BigInt(t)*l),d.M[15](s+36,1|c.f[15](s+36));const u=(0,h.sY)(a[t].length);(0,i.lW)(u,a[t].length,a[t]),(0,f.NX)(s,u,a[t].length),e.interval.packetBuffer.push(s)}},g=(r,p)=>{let m=s?(0,f._5)():t;d.M[15](m+32,n.index),(0,i.Mr)(m+72,n.timeBase[o.o9],8);const g=(0,h.sY)(r.length);(0,i.lW)(g,r.length,r),(0,f.NX)(m,g,r.length),d.M[17](m+16,p),d.M[17](m+8,p);let y=a.filter.sendAVPacket(m);if(y<0)return l.h2("send avpacket to bsf failed",z,472),u.LR;if(y=a.filter.receiveAVPacket(m),y!==u.LT)for((0,i.Mr)(m+72,n.timeBase[o.o9],8),d.M[15](m+32,n.index),d.M[15](m+36,1|c.f[15](m+36)),s?(e.interval.packetBuffer.push(m),m=0):s=!0;;){const t=this.cacheAVPacket||(0,f._5)();if(y=a.filter.receiveAVPacket(t),0!==y){this.cacheAVPacket=t;break}(0,i.Mr)(t+72,n.timeBase[o.o9],8),d.M[15](t+32,n.index),e.interval.packetBuffer.push(t),this.cacheAVPacket=0}};for(;a.queue.hasFrame();){const t=a.queue.getFrame();if(!t.length)continue;const s=this.getPacketPts(e,n,t[0].header.timestamp);if(0===n.codecpar.codecType||this.context.canOutputPacket)if(27===n.codecpar.codecId||173===n.codecpar.codecId){const{nalus:e,isKey:r}=27===n.codecpar.codecId?b.Hj(t):b.pA(t,a.payloadContext);if(!e.length)continue;if(!r&&!this.context.canOutputPacket){a.currentDTS=s;continue}const i=p(S.nW(e),r,s);d.M[15](i+80,n.codecpar.bitFormat),d.M[17](i+16,a.currentDTS),a.currentDTS+=a.dtsDelta,r?(a.gopCount>1&&(a.dtsDelta=(a.maxPts-a.minPts)/BigInt(a.gopCount-1|0)),a.gopCount=1,a.minPts=s,a.maxPts=s):(a.gopCount++,a.gopCount>5&&a.gopCount<200&&(a.dtsDelta=(a.maxPts-a.minPts)/BigInt(a.gopCount-1|0))),s>a.maxPts&&(a.maxPts=s)}else if(86018===n.codecpar.codecId)m(b.kx(t,n.privData.payloadContext),s,BigInt(1024));else if(12===n.codecpar.codecId){const e=b.xW(t),r=e[4]>>>6==0;if(!r&&!this.context.canOutputPacket){a.currentDTS=s;continue}p(e,r,s)}else if(65543===n.codecpar.codecId||65542===n.codecpar.codecId||69660===n.codecpar.codecId||65537===n.codecpar.codecId||86076===n.codecpar.codecId||86051===n.codecpar.codecId)m([b.xW(t)],s);else if(86017===n.codecpar.codecId){const e=b.Jz(t,n.codecpar.codecType);if(n.codecpar.profile===w.N_){const t=(6&e[1])>>1;n.codecpar.profile=A.Au(t)}g(e,s)}else if(86019===n.codecpar.codecId)g(b.we(t),s);else if(2===n.codecpar.codecId){const e=b.Jz(t,n.codecpar.codecType),r=1==(e[5]>>3&7);if(!r&&!this.context.canOutputPacket){a.currentDTS=s;continue}p(e,r,s)}else if(139===n.codecpar.codecId){const{payload:e,isKey:r}=b.hw(t);if(!r&&!this.context.canOutputPacket){a.currentDTS=s;continue}p(e,r,s)}else if(167===n.codecpar.codecId){const{payload:e,isKey:r}=b.o_(t);if(!r&&!this.context.canOutputPacket){a.currentDTS=s;continue}p(e,r,s)}else if(225===n.codecpar.codecId){const{payload:e,isKey:r}=b.l6(t);if(!r&&!this.context.canOutputPacket){a.currentDTS=s;continue}p(e,r,s)}}if(s)return 0}}else l.R8("received invalid data",z,640)}}catch(t){return-1048576!==e.ioReader.error?(l.z3(`read packet error, ${t}`,z,646),u.LR):e.ioReader.error}}async seek(e,t,a,s){return BigInt(u.E$)}getAnalyzeStreamsCount(){return 0}async destroy(e){await this.rtspSession.teardown(this.context.sessionId),this.cacheAVPacket&&((0,f.Qe)(this.cacheAVPacket),this.cacheAVPacket=0),v.__(e.streams,(e=>{const t=e.privData;t.filter&&(t.filter.destroy(),t.filter=null)}))}}},75294:(e,t,a)=>{a.d(t,{CM:()=>o,Vz:()=>n,qg:()=>i});var s=a(134),r=a(89088);class n{constructor(){(0,s.A)(this,"version",void 0),(0,s.A)(this,"layer",void 0),(0,s.A)(this,"protection",void 0),(0,s.A)(this,"bitrateIndex",void 0),(0,s.A)(this,"samplingFrequency",void 0),(0,s.A)(this,"padding",void 0),(0,s.A)(this,"private",void 0),(0,s.A)(this,"mode",void 0),(0,s.A)(this,"modeExtension",void 0),(0,s.A)(this,"copyright",void 0),(0,s.A)(this,"original",void 0),(0,s.A)(this,"emphasis",void 0)}}function i(e,t){e.version=t>>19&3,e.layer=t>>17&3,e.protection=t>>16&1,e.bitrateIndex=t>>12&15,e.samplingFrequency=t>>10&3,e.padding=t>>9&1,e.mode=t>>6&3,e.modeExtension=t>>4&3,e.copyright=t>>3&1,e.original=t>>2&1,e.emphasis=3&t}function o(e,t){let a=r.oz(e.version,e.layer,e.bitrateIndex);switch(e.layer){case 1:default:a=144e3*a/(t<<(3===e.version?0:1))>>>0,a+=e.padding;break;case 2:a=144e3*a/t>>>0,a+=e.padding;break;case 3:a=12e3*a/t>>>0,a=4*(a+e.padding)}return a}},77872:(e,t,a)=>{a.d(t,{lN:()=>n});const s=/(.*)/,r="%s",n={v:[{name:"version",reg:/^(\d*)$/,format:r}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name",reg:s,format:r}],i:[{name:"description",reg:s,format:r}],u:[{name:"uri",reg:s,format:r}],e:[{name:"email",reg:s,format:r}],p:[{name:"phone",reg:s,format:r}],z:[{name:"timezones",reg:s,format:r}],r:[{name:"repeats",reg:s,format:r}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/,format:r},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:r},{name:"icelite",reg:/^(ice-lite)/,format:r},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){let t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/,format:r},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){let t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/,format:r},{name:"rtcpRsize",reg:/^(rtcp-rsize)/,format:r},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/,format:r},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){let t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",reg:s,names:["value"],format:r}]}},73002:(e,t,a)=>{a.d(t,{q:()=>o});var s=a(77872);const r=e=>/^([a-z])=(.*)/.test(e);function n(e){return String(Number(e))===e?Number(e):e}function i(e,t,a){const s=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:s&&!t[e.name]&&(t[e.name]={});const r=e.push?{}:s?t[e.name]:t;!function(e,t,a,s){if(s&&!a)t[s]=n(e[1]);else for(let s=0;s<a.length;s+=1)null!=e[s+1]&&(t[a[s]]=n(e[s+1]))}(a.match(e.reg),r,e.names,e.name),e.push&&t[e.push].push(r)}function o(e){const t={},a=[];let n=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((e=>{const t=e[0],r=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),n=a[a.length-1]);for(let e=0;e<(s.lN[t]||[]).length;e+=1){const a=s.lN[t][e];if(a.reg.test(r))return i(a,n,r)}})),t.media=a,t}},91712:(e,t,a)=>{a.d(t,{K:()=>i,pl:()=>n});var s=a(134);class r{constructor(){(0,s.A)(this,"version",void 0),(0,s.A)(this,"padding",void 0),(0,s.A)(this,"count",void 0),(0,s.A)(this,"payloadType",void 0),(0,s.A)(this,"length",void 0)}}class n{constructor(){(0,s.A)(this,"ssrc",void 0),(0,s.A)(this,"fractionLost",void 0),(0,s.A)(this,"packetLost",void 0),(0,s.A)(this,"highestSequence",void 0),(0,s.A)(this,"interArrivalJitter",void 0),(0,s.A)(this,"lsr",void 0),(0,s.A)(this,"dlsr",void 0)}}class i extends r{constructor(...e){super(...e),(0,s.A)(this,"ssrc",void 0),(0,s.A)(this,"ntp",void 0),(0,s.A)(this,"timestamp",void 0),(0,s.A)(this,"senderPacketCount",void 0),(0,s.A)(this,"senderOctetCount",void 0),(0,s.A)(this,"reports",[])}}},90764:(e,t,a)=>{function s(e){return e.length>4&&e[0]>127&&e[0]<192&&e[0]>>>6==2&&e[1]>=192&&e[1]<=223}a.d(t,{A:()=>s})},39342:(e,t,a)=>{a.d(t,{N:()=>n});var s=a(31865),r=a(91712);function n(e){const t=new s.A(e),a=new r.K;!function(e,t){let a=t.readUint8();e.version=a>>>6,e.padding=a>>>5&1,e.count=31&a,e.payloadType=t.readUint8(),e.length=t.readUint16()}(a,t),a.ssrc=t.readUint32(),a.ntp=t.readUint64(),a.timestamp=t.readUint32(),a.senderPacketCount=t.readUint32(),a.senderOctetCount=t.readUint32();for(let e=0;e<a.count;e++){const e=new r.pl;e.ssrc=t.readUint32(),e.fractionLost=t.readUint8(),e.packetLost=t.readUint24(),e.highestSequence=t.readUint32(),e.interArrivalJitter=t.readUint32(),e.lsr=t.readUint32(),e.dlsr=t.readUint32()}return a}},48416:(e,t,a)=>{a.d(t,{A:()=>c});var s=a(134),r=a(63939),n=a(77231),i=a(15012);const o=n.zg>>>1;class c{constructor(e,t){(0,s.A)(this,"queue",void 0),(0,s.A)(this,"frameQueue",void 0),(0,s.A)(this,"codecpar",void 0),(0,s.A)(this,"currentSeqStart",void 0),(0,s.A)(this,"readyPos",void 0),(0,s.A)(this,"maskerQueue",void 0),(0,s.A)(this,"payloadContext",void 0),this.codecpar=e,this.queue=[],this.frameQueue=[],this.currentSeqStart=-1,this.readyPos=0,this.maskerQueue=[],this.payloadContext=t}isSeqIncreaseOne(e,t){return e+1===t||e===n.zg&&0===t}seqAMoreThenB(e,t){return e>t&&e-t<o||e<t&&t-e>o}isFirstStart(){if(this.currentSeqStart>-1)return this.isSeqIncreaseOne(this.currentSeqStart,this.queue[0].header.sequence);if(this.queue.length>5){if(1===r.f[15](this.codecpar))return!0;if(27===r.f[15](this.codecpar+4))switch(31&this.queue[0].payload[0]){case 24:for(let e=1;e<this.queue[0].payload.length-2;){const t=this.queue[0].payload[e]<<8|this.queue[0].payload[e+1],a=31&this.queue[0].payload[e+2];if(7===a||8===a||5===a||9===a)return!0;e+=2+t}break;case 28:if(128&this.queue[0].payload[1])return!0;break;case 7:case 9:return!0}else if(173===r.f[15](this.codecpar+4))switch(this.queue[0].payload[0]>>>1&63){case 48:let e=i.Dm+(this.payloadContext.usingDonlField?i.hE:0);for(;e<this.queue[0].payload.length-i.Dm;){const t=this.queue[0].payload[e]<<8|this.queue[0].payload[e+1],a=this.queue[0].payload[e+2]>>>1&63;if(34===a||32===a||33===a||20===a||19===a||35===a)return!0;e+=2+t,this.payloadContext.usingDonlField&&(e+=i.hQ)}break;case 49:if(128&this.queue[0].payload[2])return!0;break;case 32:case 35:return!0}else if(139===r.f[15](this.codecpar+4)){if(16&this.queue[0].payload[0])return!0}else if(167===r.f[15](this.codecpar+4)){if(8&this.queue[0].payload[0])return!0}else if(225===r.f[15](this.codecpar+4)){if(1&this.queue[0].payload[0])return!0}else if(2===r.f[15](this.codecpar+4)&&1==(this.queue[0].payload[2]>>>5&1))return!0;return this.readyPos>200}return!1}check(){for(;this.readyPos<this.queue.length-1&&this.isSeqIncreaseOne(this.queue[this.readyPos].header.sequence,this.queue[this.readyPos+1].header.sequence);)this.readyPos++,(this.queue[this.readyPos].header.masker||65543===r.f[15](this.codecpar+4)||65542===r.f[15](this.codecpar+4)||86017===r.f[15](this.codecpar+4)||69660===r.f[15](this.codecpar+4)||65537===r.f[15](this.codecpar+4))&&this.maskerQueue.push(this.readyPos)}push(e){if(this.currentSeqStart>-1&&this.seqAMoreThenB(this.currentSeqStart,e.header.sequence))return;if(!this.queue.length)return this.queue.push(e),void(e.header.masker&&this.maskerQueue.push(0));let t=!1;if(this.seqAMoreThenB(this.queue[0].header.sequence,e.header.sequence))this.queue.unshift(e),this.readyPos=0,this.maskerQueue.length=0,t=!0,this.check();else for(let a=this.readyPos;a<this.queue.length;a++)if(this.seqAMoreThenB(this.queue[a].header.sequence,e.header.sequence)){this.queue.splice(a,0,e),t=!0,a===this.readyPos+1&&this.check();break}t||(this.queue.push(e),this.readyPos+2===this.queue.length&&this.check());let a=0;for(;this.isFirstStart()&&this.maskerQueue.length;){const e=this.maskerQueue.shift()+1,t=this.queue.slice(a,e);this.frameQueue.push(t),a=e,this.currentSeqStart=t[t.length-1].header.sequence}if(a){this.queue=this.queue.slice(a),this.readyPos=Math.max(0,this.readyPos-a);for(let e=0;e<this.maskerQueue.length;e++)this.maskerQueue[e]-=a}}hasFrame(){return this.frameQueue.length}getFrame(){return this.frameQueue.shift()}}},67088:(e,t,a)=>{a.d(t,{El:()=>i,N8:()=>c,tW:()=>o});var s=a(134),r=a(80662),n=a.n(r);class i{constructor(){(0,s.A)(this,"version",void 0),(0,s.A)(this,"padding",void 0),(0,s.A)(this,"extension",void 0),(0,s.A)(this,"csrc",void 0),(0,s.A)(this,"masker",void 0),(0,s.A)(this,"payloadType",void 0),(0,s.A)(this,"sequence",void 0),(0,s.A)(this,"timestamp",void 0),(0,s.A)(this,"ssrc",void 0),(0,s.A)(this,"csrcList",[])}}class o{constructor(){(0,s.A)(this,"id",void 0),(0,s.A)(this,"length",void 0),(0,s.A)(this,"extension",void 0),(0,s.A)(this,"headers",new(n()))}hasOneByteExtensions(){return 48862===this.id}hasTwoBytesExtensions(){return 4096==(65520&this.id)}parse(){if(this.hasOneByteExtensions())for(let e=0;e<this.extension.length;e++){const t=(240&this.extension[e])>>>4,a=1+(15&this.extension[e]);if(15===t)break;0!==t?(this.headers.set(t,this.extension.subarray(e+1,e+1+a)),e+=1+a):e++}else if(this.hasTwoBytesExtensions())for(let e=0;e<this.extension.length;e++){const t=this.extension[e],a=this.extension[e+1];0!==t?(this.headers.set(t,this.extension.subarray(e+2,e+2+a)),e+=2+a):e++}}}class c{constructor(){(0,s.A)(this,"header",void 0),(0,s.A)(this,"headerExtension",void 0),(0,s.A)(this,"payload",void 0)}}},38183:(e,t,a)=>{a.d(t,{Hj:()=>c,Jz:()=>f,hw:()=>u,kx:()=>l,l6:()=>h,o_:()=>p,pA:()=>d,we:()=>m,xW:()=>g});var s=a(4624),r=a(15012),n=a(92647),i=a(37246),o="src/avprotocol/rtp/depacketizer.ts";function c(e){const t=[];let a=!1;for(let r=0;r<e.length;r++){const i=e[r].payload,c=31&i[0];switch(c){case 24:for(let e=1;e<i.length-2;){const r=i[e]<<8|i[e+1];if(e+2+r>i.length)return s.z3("pack h264 STAP-A failed",o,52),{nalus:[],isKey:a};t.push(i.subarray(e+2,e+2+r)),5==(31&i[e+2])&&(a=!0),e+=2+r}break;case 25:case 26:case 27:case 29:return s.z3("not support nalu pack",o,75),{nalus:[],isKey:a};case 28:const d=i[1];if(1&~(d>>>7))return s.z3("not the first FU-A packet",o,84),{nalus:[],isKey:a};const l=31&d,u=224&i[0]|l;5===l&&(a=!0);const p=[new Uint8Array([u])];for(p.push(i.subarray(2)),r++;r<e.length&&(p.push(e[r].payload.subarray(2)),!(e[r].payload[1]>>>6&1));r++);t.push((0,n.A)(Uint8Array,p));break;default:5===c&&(a=!0),t.push(i)}}return{nalus:t,isKey:a}}function d(e,t){const a=[];let i=!1;for(let c=0;c<e.length;c++){const d=e[c].payload,l=d[0]>>>1&63;switch(l>50&&s.z3("not support nalu pack",o,131),l){case 48:for(let e=r.Dm+(t.usingDonlField?r.hE:0);e<d.length-2;){const n=d[e]<<8|d[e+1];if(e+2+n>d.length)return s.z3("pack hevc STAP-A failed",o,140),{nalus:[],isKey:i};a.push(d.subarray(e+2,e+2+n));const c=d[e+2]>>>1&63;20!==c&&19!==c||(i=!0),e+=2+n,t.usingDonlField&&(e+=r.hQ)}break;case 49:const u=63&d[2];20!==u&&19!==u||(i=!0);const p=[new Uint8Array([129&d[0]|u<<1,d[1]])];for(p.push(d.subarray(3+(t.usingDonlField?r.hE:0))),c++;c<e.length&&(p.push(e[c].payload.subarray(3+(t.usingDonlField?r.hE:0))),!(e[c].payload[2]>>>6&1));c++);a.push((0,n.A)(Uint8Array,p));break;case 50:return s.z3("not support nalu pack",o,184),{nalus:[],isKey:i};default:20!==l&&19!==l||(i=!0),a.push(d)}}return{nalus:a,isKey:i}}function l(e,t){const a=[],c=[],d=new i.A(r.MO);for(let i=0;i<e.length;i++){const l=e[i].payload;if(t.latm){let e=0;for(;e<l.length;){let t=0;for(;;){const a=l[e++];if(t+=a,255!==a)break}a.push(l.subarray(e,e+t)),e+=t}}else{if(l.length<2)return void s.z3("invalid mpeg4 payload length",o,228);const e=l[0]<<8|l[1];if(e>r.MO)return void s.z3("invalid mpeg4 payload au header length",o,233);const i=(e+7)/8>>>0;if(l.length-2<i)return void s.z3("invalid mpeg4 payload au length",o,238);const u=t.sizeLength+t.indexLength;if(e%u!=0)return void s.z3("not support mpeg4 payload au format",o,245);const p=e/u,h=[],f=[];d.reset(),d.appendBuffer(l.subarray(2));for(let e=0;e<p;e++)h.push(d.readU(t.sizeLength)),f.push(d.readU(t.indexLength));if(1===h.length&&h[0]+i+2>l.length)c.push(l.subarray(2+i));else if(h.length>1){let e=i+2;for(let t=0;t<h.length;t++)!f[t]&&c.length&&(a.push((0,n.A)(Uint8Array,c)),c.length=0),a.push(l.subarray(e,e+h[t])),e+=h[t]}}}return c.length&&a.push(1===c.length?c[0]:(0,n.A)(Uint8Array,c)),a}function u(e){const t=[];let a=!1;for(let s=0;s<e.length;s++){const r=e[s].payload[0]>>>7,n=e[s].payload[0]>>>4&1,i=7&e[s].payload[0];let o=1;if(r){const r=e[s].payload[o]>>>7,c=e[s].payload[o]>>>6&1,d=e[s].payload[o]>>>5&1,l=e[s].payload[o]>>>4&1;o++,r&&e[s].payload[o++]>>>7&&o++,c&&o++,(d||l)&&o++,!n||0!==i||1&e[s].payload[o]||(a=!0),t.push(e[s].payload.subarray(o))}}return 1===t.length?{payload:t[0],isKey:a}:{payload:(0,n.A)(Uint8Array,t),isKey:a}}function p(e){const t=[];let a=!1;for(let r=0;r<e.length;r++){const n=e[r].payload[0]>>>7,i=e[r].payload[0]>>>5&1,c=e[r].payload[0]>>>4&1,d=e[r].payload[0]>>>3&1,l=e[r].payload[0]>>>1&1;let u=1;n&&e[r].payload[u++]>>>7&&u++;let p=0;if(i&&(c&&(p=3&e[r].payload[u]),u++),c)for(let t=0;t<p;t++)16&e[t].payload[u]?u+=2:u+=1;if(l){const t=e[r].payload[u]>>5,a=!!(16&e[r].payload[u]),n=!!(8&e[r].payload[u]);if(u++,t>0&&s.h2("VP9 scalability structure with multiple layers",o,383),a)for(r=0;r<t+1;r++)u+=4;if(n){const t=e[r].payload[u++];for(r=0;r<t;r++){const t=e[r].payload[u]>>2&3;u++;for(let e=0;e<t;e++)u++}}}if(d){const t=e[r].payload[u],s=((t>>>4&1)<<1)+(t>>>5&1);a=!(t>>>(3===s?2:3)&1||t>>>(3===s?1:2)&1)}t.push(e[r].payload.subarray(u))}return 1===t.length?{isKey:a,payload:t[0]}:{isKey:a,payload:(0,n.A)(Uint8Array,t)}}function h(e){const t=[];let a=!1;function s(e,t){let a=0;for(let s=0;s<8;s++){let r=e[t++];if(a|=(127&r)<<7*s,!(128&r))break}return{value:a,offset:t}}for(let r=0;r<e.length;r++){const n=e[r].payload[0]>>>4&3;let i=1;if(n){for(let r=0;r<n-1;r++){const n=s(e[r].payload,i);i=n.offset,1==(e[r].payload[i]>>>3&15)&&(a=!0),t.push(e[r].payload.subarray(i,i+n.value)),i+=n.value}1==(e[r].payload[i]>>>3&15)&&(a=!0),t.push(e[r].payload.subarray(i))}else for(;i<e[r].payload.length-1;){const n=s(e[r].payload,i);i=n.offset,1==(e[r].payload[i]>>>3&15)&&(a=!0),t.push(e[r].payload.subarray(i,i+n.value)),i+=n.value}}return 1===t.length?{payload:t[0],isKey:a}:{payload:(0,n.A)(Uint8Array,t),isKey:a}}function f(e,t){const a=[];for(let s=0;s<e.length;s++){let r=4;0===t&&1==(e[s].payload[0]>>>2&1)&&(r=8),a.push(e[s].payload.subarray(r))}return 1===a.length?a[0]:(0,n.A)(Uint8Array,a)}function m(e){const t=[],a=[];for(let s=0;s<e.length;s++){const r=e[s].payload;switch(3&r[0]){case 0:t.push(r.subarray(2));break;case 1:case 2:a.push(r.subarray(2));break;case 3:a.push(r.subarray(2)),t.push((0,n.A)(Uint8Array,a)),a.length=0}}return 1===t.length?t[0]:(0,n.A)(Uint8Array,t)}function g(e){if(1===e.length)return e[0].payload;const t=[];for(let a=0;a<e.length;a++)t.push(e[a].payload);return(0,n.A)(Uint8Array,t)}},30725:(e,t,a)=>{a.d(t,{zQ:()=>f});var s=a(37837),r=a(14686),n=a(4919),i=a(20620),o=a(53e3),c=a(58469),d=a(60264),l=a(37246),u=a(4624);function p(e,t){const a=e.split(";");for(let e=0;e<a.length;e++){const s=a[e].split("="),r=s[0].trim();s.shift(),t(r,s.join("=").trim())}}function h(e,t){const a={};return p(t,((t,n)=>{switch(t){case"streamtype":a.streamType=+n;break;case"profile-level-id":a.profileLevelId=+n;break;case"mode":a.mode=n;break;case"sizelength":a.sizeLength=+n;break;case"indexlength":a.indexLength=+n;break;case"indexdeltalength":a.indexDeltaLength=+n;break;case"config":a.config=n,e.codecpar.extradata=(0,s.sY)(n.length/2),e.codecpar.extradataSize=n.length/2;const t=(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize);let i=0;for(let e=0;e<n.length;e+=2)t[i++]=+("0x"+n.substring(e,e+2));86018===e.codecpar.codecId&&c.XC(e,(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}})),a}const f={27:function(e,t){e.codecpar.bitFormat=2;const a={};return p(t,((t,o)=>{switch(t){case"profile-level-id":a.profile=+("0x"+o.substring(0,2)),a.level=+("0x"+o.substring(4,6));break;case"packetization-mode":a.packetizationMode=+o;break;case"sprop-parameter-sets":const t=o.split(",").map((e=>n.E_(e))),c=i.S1(d.nW(t));e.codecpar.extradata=(0,s.sY)(c.length),e.codecpar.extradataSize=c.length,(0,r.lW)(e.codecpar.extradata,c.length,c),i.XC(e,(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}})),a},173:function(e,t){const a={},i=[];if(e.codecpar.bitFormat=2,p(t,((e,t)=>{switch(e){case"profile-id":a.profile=+t;break;case"sprop-vps":case"sprop-sps":case"sprop-pps":case"sprop-sei":i.push(n.E_(t))}})),i.length){const t=o.S1(d.nW(i));e.codecpar.extradata=(0,s.sY)(t.length),e.codecpar.extradataSize=t.length,(0,r.lW)(e.codecpar.extradata,t.length,t),o.XC(e,(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}return a},86018:h,86065:function(e,t){const a={latm:!0};return e.codecpar.codecId=86018,p(t,((t,n)=>{switch(t){case"profile-level-id":a.profileLevelId=+n;break;case"cpresent":a.cpresent=+n;break;case"config":a.config=n;const t=new Uint8Array(n.length/2);let i=0;for(let e=0;e<n.length;e+=2)t[i++]=+("0x"+n.substring(e,e+2));const o=new l.A(t.length);o.appendBuffer(t);const d=o.readU1(),p=o.readU1();o.skip(6);const h=o.readU(4),f=o.readU(3);0==d&&1==p&&0==h&&0==f||u.h2("LATM config not support","src/avprotocol/rtp/fmtp.ts",186),e.codecpar.extradata=(0,s.sY)(2),e.codecpar.extradataSize=2;const m=(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize);m[0]=o.readU(8),m[1]=o.readU(8),c.XC(e,(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}})),a},12:h}},79940:(e,t,a)=>{function s(e){return e.length>12&&e[0]>127&&e[0]<192&&e[0]>>>6==2}a.d(t,{A:()=>s})},52575:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(67088);function r(e){const t=new s.N8,a=t.header=new s.El;let r=0;a.version=e[r]>>6,a.padding=e[r]>>5&1,a.extension=e[r]>>4&1,a.csrc=15&e[r],r++,a.masker=e[r]>>7&1,a.payloadType=127&e[r],r++,a.sequence=e[r]<<8|e[r+1],r+=2,a.timestamp=(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0,r+=4,a.ssrc=(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0,r+=4;for(let t=0;t<a.csrc;t++)a.csrcList.push((e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0),r+=4;return a.extension&&(t.headerExtension=t.headerExtension=new s.tW,t.headerExtension.id=e[r]<<8|e[r+1],r+=2,t.headerExtension.length=e[r]<<8|e[r+1],r+=2,t.headerExtension.extension=e.subarray(r,4*t.headerExtension.length),r+=4*t.headerExtension.length),t.payload=e.subarray(r,e.length-(a.padding?e[e.length-1]:0)),t}},15012:(e,t,a)=>{a.d(t,{Dm:()=>r,MO:()=>s,fm:()=>c,hE:()=>i,hQ:()=>n,xl:()=>o});const s=8192,r=2,n=1,i=2,o={PCMU:65542,PCMA:65543,G723:86068,G722:69660,L16:65537,MPA:86017,MPV:2,MP2T:131072,H264:27,H265:173,HEVC:173,VP8:139,VP9:167,AV1:225,opus:86076,speex:86051,vorbis:86021,theora:30,"MP4A-LATM":86065,"MP4V-ES":12,"mpeg4-generic":86018,ac3:86019},c=[{payload:0,name:"PCMU",codecType:1,codecId:65542,rate:8e3,encoding:1},{payload:4,name:"G723",codecType:1,codecId:86068,rate:8e3,encoding:1},{payload:8,name:"PCMA",codecType:1,codecId:65543,rate:8e3,encoding:1},{payload:9,name:"G722",codecType:1,codecId:69660,rate:8e3,encoding:1},{payload:10,name:"L16",codecType:1,codecId:65537,rate:44100,encoding:2},{payload:11,name:"L16",codecType:1,codecId:65537,rate:44100,encoding:1},{payload:14,name:"MPA",codecType:1,codecId:86017,rate:-1,encoding:-1},{payload:31,name:"H261",codecType:0,codecId:3,rate:9e4,encoding:-1},{payload:32,name:"MPV",codecType:0,codecId:2,rate:9e4,encoding:-1},{payload:33,name:"MPV",codecType:2,codecId:131072,rate:9e4,encoding:-1},{payload:34,name:"H263",codecType:0,codecId:4,rate:9e4,encoding:-1}]},89222:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(134),r=a(95434);class n extends r.zo{constructor(e,t,a){super(t,a),(0,s.A)(this,"seq",void 0),(0,s.A)(this,"version","RTSP/1.0"),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"authorization",void 0),this.seq=1,this.uri=e}async options(){const e=new r.yz("OPTIONS",this.uri,this.version,{CSeq:""+this.seq++});return super.request(e)}async describe(){const e=new r.yz("DESCRIBE",this.uri,this.version,{CSeq:""+this.seq++,Accept:"application/sdp",Authorization:this.authorization});return super.request(e)}async setup(e,t=""){let a="";2===e.streamMode&&(a="/TCP");let s="",n="";1===e.streamMode?n=`;${e.clientPort}-${e.clientPort+1}`:2===e.streamMode&&(s=`;${e.interleaved}-${e.interleaved+1}`);const i=new r.yz("SETUP",this.uri+`/trackID=${e.trackId}`,this.version,{CSeq:""+this.seq++,Session:t,Authorization:this.authorization,Transport:`RTP/AVP${a};${e.multcast?"multcast":"unicast"}${s}${n}`});return super.request(i)}async play(e,t={from:0,to:-1}){const a=new r.yz("PLAY",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization,Range:`npt=${t.from>=0?t.from:0}-${t.to>0?t.to:""}`});return super.request(a)}async pause(e){const t=new r.yz("PAUSE",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization});return super.request(t)}async teardown(e){const t=new r.yz("TEARDOWN",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization});await super.notify(t)}async readPacket(){for(;;){36!==await this.ioReader.peekUint8()&&await this.readResponse(),await this.ioReader.skip(1);const e=await this.ioReader.readUint8(),t=await this.ioReader.readUint16();return{interleaved:e,data:await this.ioReader.readBuffer(t)}}}}},41654:(e,t,a)=>{function s(e){const t=e>>BigInt(32),a=(e&BigInt(4294967295))*BigInt(1e6)/BigInt(4294967295);return t*BigInt(1e6)+a}a.d(t,{q:()=>s})},95434:(e,t,a)=>{a.d(t,{yz:()=>n,zo:()=>o});var s=a(134),r=a(95335);class n{constructor(e,t,a,r={},n=""){(0,s.A)(this,"method",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"protocol",void 0),(0,s.A)(this,"headers",void 0),(0,s.A)(this,"context",void 0),this.method=e,this.uri=t,this.protocol=a,this.headers=r,this.context=n}setHeader(e,t){this.headers[e]=t}encode(){let e=`${this.method} ${this.uri} ${this.protocol}\r\n`;return this.headers["Content-Length"]=this.context.length+"",r.__(this.headers,((t,a)=>{t&&(e+=`${a}: ${t}\r\n`)})),e+="\r\n",this.context&&(e+=this.context),e}}class i{constructor(e,t,a,r,n){(0,s.A)(this,"protocol",void 0),(0,s.A)(this,"statusCode",void 0),(0,s.A)(this,"statusText",void 0),(0,s.A)(this,"headers",void 0),(0,s.A)(this,"context",void 0),this.protocol=e,this.statusCode=t,this.statusText=a,this.headers=r,this.context=n}}class o{constructor(e,t){(0,s.A)(this,"ioReader",void 0),(0,s.A)(this,"ioWriter",void 0),this.ioReader=e,this.ioWriter=t}async readResponse(){let e=(await this.ioReader.readLine()).trim().split(" "),t="",a={};for(;;){const e=(await this.ioReader.readLine()).trim();if(!e)break;const t=e.split(":");a[t[0].trim()]=t[1].trim()}return a["Content-Length"]&&(t=await this.ioReader.readString(+a["Content-Length"])),new i(e[0].trim(),+e[1].trim(),e[2].trim(),a,t)}async request(e){return this.ioWriter.reset(),this.ioWriter.writeString(e.encode()),this.ioWriter.flush(),this.readResponse()}async notify(e){this.ioWriter.reset(),this.ioWriter.writeString(e.encode()),await this.ioWriter.flush()}}}}]);