"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[576],{41576:(e,t,i)=>{i.r(t),i.d(t,{default:()=>S});var s=i(134),n=i(80662),a=i.n(n),d=i(54001),o=i.n(d),r=i(13724),l=i(82800),u=i(95335),m=i(4624),h=i(78417),c=i(77580),g=i(86932),f=i(9705);const p="src\\avnetwork\\ioLoader\\DashIOLoader.ts";class S extends l.A{constructor(...e){super(...e),(0,s.A)(this,"info",void 0),(0,s.A)(this,"mediaPlayList",void 0),(0,s.A)(this,"fetchMediaPlayListPromise",void 0),(0,s.A)(this,"minBuffer",void 0),(0,s.A)(this,"audioResource",void 0),(0,s.A)(this,"videoResource",void 0),(0,s.A)(this,"subtitleResource",void 0),(0,s.A)(this,"aborted",void 0),(0,s.A)(this,"signal",void 0)}createResource(e){return{type:e,fetchedMap:new(a()),fetchedHistoryListMax:100,fetchedHistoryList:[],loader:null,segmentIndex:0,currentUri:"",selectedIndex:0,segments:[],initSegmentPadding:"",initedSegment:"",sleep:null,lastPendingSegmentFetchTs:0,lastPendingSegmentDuration:0}}addHistory(e,t,i){e.fetchedMap.clear(),e.fetchedHistoryList.length=0;for(let s=0;s<i;s++)e.fetchedMap.set(t[s].url,!0),e.fetchedHistoryList.push(t[s].url);for(;e.fetchedHistoryList.length>=e.fetchedHistoryListMax;)e.fetchedMap.delete(e.fetchedHistoryList.shift())}async fetchMediaPlayList(e){var t,i,s;if(!e){if(this.fetchMediaPlayListPromise)return;this.fetchMediaPlayListPromise=new(o())((t=>{e=t}))}const n={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};null!==(t=this.info.httpOptions)&&void 0!==t&&t.headers&&u.__(this.info.httpOptions.headers,((e,t)=>{n.headers[t]=e})),null!==(i=this.info.httpOptions)&&void 0!==i&&i.credentials&&(n.credentials=this.info.httpOptions.credentials),null!==(s=this.info.httpOptions)&&void 0!==s&&s.referrerPolicy&&(n.referrerPolicy=this.info.httpOptions.referrerPolicy);try{var a;"function"==typeof AbortController&&(this.signal=new AbortController);const t=await fetch(this.info.url,{...n,signal:null===(a=this.signal)||void 0===a?void 0:a.signal});this.signal=null;const i=await t.text();this.mediaPlayList=(0,h.A)(i,this.info.url),this.minBuffer=this.mediaPlayList.minBufferTime,"vod"===this.mediaPlayList.type?this.options.isLive=!1:this.options.isLive=!0;const s=(e,t,i)=>{let s=0,n=0;for(let e=t.length-2;e>=0;e--)if(!0!==t[e].pending&&(n+=t[e].segmentDuration,n>=i)){s=e;break}e.lastPendingSegmentFetchTs=this.mediaPlayList.maxSegmentDuration,e.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration,e.fetchedHistoryListMax=Math.max(e.fetchedHistoryListMax,t.length+1),this.addHistory(e,t,s)};if(this.mediaPlayList.mediaList.audio.length){const e=this.mediaPlayList.mediaList.audio[this.audioResource.selectedIndex];e.file?this.audioResource.segments=[{url:e.file}]:this.options.isLive&&this.audioResource.initedSegment===e.initSegment?(this.audioResource.segments=e.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration}))),this.audioResource.lastPendingSegmentFetchTs=this.mediaPlayList.timestamp,this.audioResource.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration):(this.options.isLive&&s(this.audioResource,e.mediaSegments,this.minBuffer),this.audioResource.segments=[{url:e.initSegment}].concat(e.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.audioResource.initedSegment=e.initSegment)}if(this.mediaPlayList.mediaList.video.length){const e=this.mediaPlayList.mediaList.video[this.videoResource.selectedIndex];e.file?this.videoResource.segments=[{url:e.file}]:this.options.isLive&&this.videoResource.initedSegment===e.initSegment?(this.videoResource.segments=e.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration}))),this.videoResource.lastPendingSegmentFetchTs=this.mediaPlayList.maxSegmentDuration,this.videoResource.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration):(this.options.isLive&&s(this.videoResource,e.mediaSegments,this.minBuffer),this.videoResource.segments=[{url:e.initSegment}].concat(e.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.videoResource.initedSegment=e.initSegment)}if(this.mediaPlayList.mediaList.subtitle.length){const e=this.mediaPlayList.mediaList.subtitle[this.subtitleResource.selectedIndex];e.file?this.subtitleResource.segments=[{url:e.file}]:this.options.isLive&&this.subtitleResource.initedSegment===e.initSegment?(this.subtitleResource.segments=e.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration}))),this.subtitleResource.lastPendingSegmentFetchTs=this.mediaPlayList.maxSegmentDuration,this.subtitleResource.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration):(this.options.isLive&&s(this.subtitleResource,e.mediaSegments,this.minBuffer),this.subtitleResource.segments=[{url:e.initSegment}].concat(e.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.subtitleResource.initedSegment=e.initSegment)}return e(),this.fetchMediaPlayListPromise=null,this.status=2,this.retryCount=0,this.mediaPlayList}catch(t){if(this.aborted)return this.status=3,void e();if(this.retryCount<this.options.retryCount)return this.retryCount++,m.z3(`failed fetch mpd file ${t}, retry(${this.retryCount}/3)`,p,300),await new r.A(2===this.status?this.options.retryInterval:5),this.fetchMediaPlayList(e);this.status=3,e(),m.h2(`DashLoader: exception, fetch slice error, error: ${t.message}`,p,308)}}async open(e){return 2===this.status?0:0!==this.status?f.lh:(this.info=e,this.videoResource=this.createResource(0),this.audioResource=this.createResource(1),this.subtitleResource=this.createResource(3),this.status=1,this.retryCount=0,this.aborted=!1,await this.fetchMediaPlayList(),0)}async readResource(e,t){let i=0;if(t.loader){if(i=await t.loader.read(e),-1048576!==i)return i;if(this.options.isLive)t.fetchedMap.set(t.currentUri,!0),t.fetchedHistoryList.length===t.fetchedHistoryListMax&&t.fetchedMap.delete(t.fetchedHistoryList.shift()),t.fetchedHistoryList.push(t.currentUri);else if(t.segmentIndex++,t.segmentIndex>=t.segments.length)return-1048576;t.loader=null}if(this.options.isLive){const i=t.segments.filter((e=>!t.fetchedMap.get(e.url)));if(!i.length){if(this.mediaPlayList.isEnd)return-1048576;const i=(this.mediaPlayList.duration||this.mediaPlayList.minimumUpdatePeriod)-((0,g.A)()-this.mediaPlayList.timestamp)/1e3;if(i>0&&(t.sleep=new r.A(i),await t.sleep,t.sleep=null,this.aborted))return-1048576;if(this.fetchMediaPlayListPromise){if(await this.fetchMediaPlayListPromise,3===this.status||this.aborted)return-1048576}else if(await this.fetchMediaPlayList(),this.aborted)return-1048576;return this.readResource(e,t)}if(t.currentUri=i[0].url,this.options.isLive&&i[0].pending){if(t.lastPendingSegmentFetchTs){const e=t.lastPendingSegmentDuration-((0,g.A)()-t.lastPendingSegmentFetchTs)/1e3;if(e>0&&(t.sleep=new r.A(e),await t.sleep,t.sleep=null,this.aborted))return-1048576}t.lastPendingSegmentFetchTs=(0,g.A)(),t.lastPendingSegmentDuration=i[0].duration||this.mediaPlayList.maxSegmentDuration}return t.loader=new c.A(u.X$({},this.options,{disableSegment:!0,loop:!1})),await t.loader.open(u.X$({},this.info,{url:t.currentUri}),{from:0,to:-1}),t.loader.read(e)}return t.loader=new c.A(u.X$({},this.options,{disableSegment:!0,loop:!1})),t.initSegmentPadding?(await t.loader.open(u.X$({},this.info,{url:t.initSegmentPadding}),{from:0,to:-1}),t.initSegmentPadding=null,t.segmentIndex--):await t.loader.open(u.X$({},this.info,{url:t.segments[t.segmentIndex].url}),{from:0,to:-1}),t.loader.read(e)}async read(e,t){return 1===t.mediaType?this.readResource(e,this.audioResource):0===t.mediaType?this.readResource(e,this.videoResource):3===t.mediaType?this.readResource(e,this.subtitleResource):f.UY}async seekResource(e,t){let i="";t.loader&&(i=t.loader.getUrl(),await t.loader.abort(),t.loader=null);let s=Number(BigInt.asIntN(32,e));if(t.segments){let e=0;const n=1===t.type?this.mediaPlayList.mediaList.audio:0===t.type?this.mediaPlayList.mediaList.video:this.mediaPlayList.mediaList.subtitle,a=n[t.selectedIndex].mediaSegments;if(null!=a&&a.length)for(let t=0;t<a.length;t++)if(s>=1e3*a[t].start&&s<1e3*a[t].end){e=t;break}t.segmentIndex=e+(n[t.selectedIndex].initSegment?1:0);let d="";0===t.type?d=this.mediaPlayList.mediaList.video[t.selectedIndex].initSegment:1===t.type?d=this.mediaPlayList.mediaList.audio[t.selectedIndex].initSegment:3===t.type&&(d=this.mediaPlayList.mediaList.subtitle[t.selectedIndex].initSegment),d&&d===i&&(t.initSegmentPadding=d)}}async seek(e,t){return 1===t.mediaType&&this.audioResource.loader&&await this.seekResource(e,this.audioResource),0===t.mediaType&&this.videoResource.loader&&await this.seekResource(e,this.videoResource),3===t.mediaType&&this.subtitleResource.loader&&await this.seekResource(e,this.subtitleResource),4===this.status&&(this.status=2),this.aborted=!1,0}async size(){return BigInt(0)}abortSleep(){this.aborted=!0,this.videoResource.loader&&this.videoResource.loader.abortSleep(),this.videoResource.sleep&&(this.videoResource.sleep.stop(),this.videoResource.sleep=null),this.audioResource.loader&&this.audioResource.loader.abortSleep(),this.audioResource.sleep&&(this.audioResource.sleep.stop(),this.audioResource.sleep=null),this.subtitleResource.loader&&this.subtitleResource.loader.abortSleep(),this.subtitleResource.sleep&&(this.subtitleResource.sleep.stop(),this.subtitleResource.sleep=null)}async abort(){this.abortSleep(),this.signal&&this.signal.abort(),this.videoResource.loader&&(await this.videoResource.loader.abort(),this.videoResource.loader=null),this.audioResource.loader&&(await this.audioResource.loader.abort(),this.audioResource.loader=null),this.subtitleResource.loader&&(await this.subtitleResource.loader.abort(),this.subtitleResource.loader=null)}async stop(){await this.abort(),this.status=0}getDuration(){return this.mediaPlayList.duration}hasVideo(){var e;return(null===(e=this.mediaPlayList)||void 0===e?void 0:e.mediaList.video.length)>0}hasAudio(){var e;return(null===(e=this.mediaPlayList)||void 0===e?void 0:e.mediaList.audio.length)>0}hasSubtitle(){var e;return(null===(e=this.mediaPlayList)||void 0===e?void 0:e.mediaList.subtitle.length)>0}getVideoList(){return this.hasVideo()?{list:this.mediaPlayList.mediaList.video.map((e=>({width:e.width,height:e.height,frameRate:e.frameRate,codec:e.codecs,bandwidth:e.bandwidth}))),selectedIndex:this.videoResource.selectedIndex}:{list:[],selectedIndex:0}}getAudioList(){return this.hasAudio()?{list:this.mediaPlayList.mediaList.audio.map((e=>({lang:e.lang,codec:e.codecs,bandwidth:e.bandwidth}))),selectedIndex:this.audioResource.selectedIndex}:{list:[],selectedIndex:0}}getSubtitleList(){return this.hasSubtitle()?{list:this.mediaPlayList.mediaList.subtitle.map((e=>({lang:e.lang,codec:e.codecs}))),selectedIndex:this.subtitleResource.selectedIndex}:{list:[],selectedIndex:0}}selectVideo(e){if(e!==this.videoResource.selectedIndex&&this.hasVideo()&&e>=0&&e<this.mediaPlayList.mediaList.video.length){this.videoResource.selectedIndex=e;const t=this.mediaPlayList.mediaList.video[this.videoResource.selectedIndex];if(t.file)this.videoResource.segments=[{url:t.file}];else{if(this.options.isLive){let e=this.videoResource.segmentIndex;this.videoResource.segments.find(((t,i)=>{if(t.url===this.videoResource.currentUri)return e=i,!0})),this.addHistory(this.videoResource,t.mediaSegments,e+1)}this.videoResource.segments=[{url:t.initSegment}].concat(t.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.videoResource.initSegmentPadding=t.initSegment}}}selectAudio(e){if(e!==this.audioResource.selectedIndex&&this.hasAudio()&&e>=0&&e<this.mediaPlayList.mediaList.audio.length){this.audioResource.selectedIndex=e;const t=this.mediaPlayList.mediaList.audio[this.audioResource.selectedIndex];if(t.file)this.audioResource.segments=[{url:t.file}];else{if(this.options.isLive){let e=this.audioResource.segmentIndex;this.audioResource.segments.find(((t,i)=>{if(t.url===this.audioResource.currentUri)return e=i,!0})),this.addHistory(this.audioResource,t.mediaSegments,e+1)}this.audioResource.segments=[{url:t.initSegment}].concat(t.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.audioResource.initSegmentPadding=t.initSegment}}}selectSubtitle(e){if(e!==this.subtitleResource.selectedIndex&&this.hasSubtitle()&&e>=0&&e<this.mediaPlayList.mediaList.subtitle.length){this.subtitleResource.selectedIndex=e;const t=this.mediaPlayList.mediaList.subtitle[this.subtitleResource.selectedIndex];if(t.file)this.subtitleResource.segments=[{url:t.file}];else{if(this.options.isLive){let e=this.subtitleResource.segmentIndex;this.subtitleResource.segments.find(((t,i)=>{if(t.url===this.subtitleResource.currentUri)return e=i,!0})),this.addHistory(this.subtitleResource,t.mediaSegments,e+1)}this.subtitleResource.segments=[{url:t.initSegment}].concat(t.mediaSegments.map((e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.subtitleResource.initSegmentPadding=t.initSegment}}}getCurrentProtection(e){return 1===e?this.mediaPlayList.mediaList.audio[this.audioResource.selectedIndex].protection:0===e?this.mediaPlayList.mediaList.video[this.videoResource.selectedIndex].protection:void 0}getMinBuffer(){return this.minBuffer}}},78417:(e,t,i)=>{i.d(t,{A:()=>R});var s=i(29967),n=i.n(s),a=i(88032),d=i.n(a),o=i(79331),r=i(67672),l=i(95335),u=i(62100),m=i(86932);function h(e){const t=e.match(/^PT?(?:(\d+)Y)?(?:(\d+)D)?(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:\.\d+)?)S)?$/);if(!t)throw new Error("Invalid DASH PT duration: "+e);const[,i,s,a,o,r]=t;return 3600*n()(i||"0")*24*365+3600*n()(s||"0")*24+3600*n()(a||"0")+60*n()(o||"0")+d()(r||"0")}function c(e,t){const i=(0,u.A)(e);return i.length>=t?i:"0".repeat(t-i.length)+i}function g(e){if(!e)return 0;if(e.indexOf("/")>-1){const t=e.split("/");return d()(t[0])/d()(t[1])}return d()(e)}function f(e){e=e.replaceAll("-","");const t=[];for(let i=0;i<e.length;i+=2)t.push(+`0x${e.substring(i,i+2)}`);return new Uint8Array(t)}function p(e){let t={};return e.forEach((e=>{const i={};if(l.__(e,((e,t)=>{i[t.toLocaleLowerCase()]=e})),i["cenc:default_kid"]&&(t.kid=f(i["cenc:default_kid"]),t.scheme=i.value),i.schemeiduri){const e=i.schemeiduri.split(":");3===e.length&&"urn"===e[0]&&"uuid"===e[1]&&(t.systemId=f(e[2]))}i["clearkey:laurl"]&&(t.url=i["clearkey:laurl"].value),i["dashif:laurl"]&&(t.url=i["dashif:laurl"].value)})),t}function S(e,t){return/^https?:\/\//.test(t)?t:e+t}function L(e,t,i){const s={mediaList:{audio:[],video:[],subtitle:[]},type:"live",isEnd:!1,duration:0,minBufferTime:0,maxSegmentDuration:0,minimumUpdatePeriod:0,timeShiftBufferDepth:0,timestamp:(0,m.A)()},a=[];"static"===e.type&&(s.type="vod",s.isEnd=!0),e.minBufferTime&&(s.minBufferTime=h(e.minBufferTime)),e.maxSegmentDuration&&(s.maxSegmentDuration=h(e.maxSegmentDuration)),e.minimumUpdatePeriod&&(s.minimumUpdatePeriod=Math.min(h(e.minimumUpdatePeriod),30*Math.max(s.maxSegmentDuration,2))),e.availabilityStartTime&&(s.availabilityStartTime=new Date(e.availabilityStartTime).getTime()),e.timeShiftBufferDepth&&(s.timeShiftBufferDepth=h(e.timeShiftBufferDepth)),e.mediaPresentationDuration&&(s.duration=h(e.mediaPresentationDuration));let o="";return e.BaseURL&&(o=r.YO(e.BaseURL)?e.BaseURL[0].value:r.Yj(e.BaseURL)?e.BaseURL:e.BaseURL.value),null!=t&&t.duration&&(s.duration=h(t.duration)),t.BaseURL&&(o=S(o,r.Yj(t.BaseURL)?t.BaseURL:t.BaseURL.value)),(r.YO(t.AdaptationSet)?t.AdaptationSet:[t.AdaptationSet]).forEach(((e,t)=>{let l,h="",f="",L="",R=0,y=0,v=0,b=0,P=0,x="1:1",w="1",T=0,A=o,D="und";e.BaseURL&&(A=S(A,r.Yj(e.BaseURL)?e.BaseURL:e.BaseURL.value)),e.lang&&(D=e.lang),e.mimeType||e.contentType?(h=e.mimeType,f=e.contentType,"video/mp4"===h||"video"===f?(L=e.codecs,R=d()(e.width),y=d()(e.height),e.maxWidth&&(v=d()(e.maxWidth)),e.maxHeight&&(b=d()(e.maxHeight)),e.frameRate&&(P=g(e.frameRate)),x=e.sar,w=e.startWithSAP,T=d()(e.bandwidth)):"audio/mp4"!==h&&"audio"!==f||(L=e.codecs,w=e.startWithSAP,T=d()(e.bandwidth))):(e.maxWidth&&(v=d()(e.maxWidth)),e.maxHeight&&(b=d()(e.maxHeight)),e.frameRate&&(P=g(e.frameRate))),e.ContentProtection&&(l=p(e.ContentProtection)),(r.YO(e.Representation)?e.Representation:[e.Representation]).forEach(((t,o)=>{a.indexOf(t.id)>-1&&(t.id=(n()(a[a.length-1])+1).toString()),a.push(t.id);let g="";const I=[];let B=0,U=s.duration,M=S(i.slice(0,i.lastIndexOf("/")+1),A);if(t.mimeType&&(h=t.mimeType),"video/mp4"===h||"video"===f?(t.codecs&&(L=t.codecs),t.width&&(R=d()(t.width)),t.height&&(y=d()(t.height)),t.maxWidth&&(v=d()(t.maxWidth)),t.maxHeight&&(b=d()(t.maxHeight)),t.frameRate&&(P=d()(t.frameRate)),t.sar&&(x=t.sar),t.startWithSAP&&(w=t.startWithSAP),t.bandwidth&&(T=d()(t.bandwidth))):(t.codecs&&(L=t.codecs),t.startWithSAP&&(w=t.startWithSAP),t.bandwidth&&(T=d()(t.bandwidth))),t.BaseURL&&(M=S(M,r.Yj(t.BaseURL)?t.BaseURL:t.BaseURL.value)),t.ContentProtection&&(l=p(t.ContentProtection)),t.SegmentBase)"video/mp4"===h||"video"===f?s.mediaList.video.push({id:t.id,file:M,mimeType:h,codecs:L,width:R,height:y,maxWidth:v,maxHeight:b,frameRate:P,sar:x,startWithSAP:"1"===w,bandwidth:T,timescale:B,duration:U,protection:l}):"audio/mp4"===h||"audio"===f?s.mediaList.audio.push({id:t.id,file:M,mimeType:h,codecs:L,startWithSAP:"1"===w,bandwidth:T,timescale:B,duration:U,protection:l,lang:D}):"application/mp4"!==h&&"text"!==f||s.mediaList.subtitle.push({id:t.id,file:M,mimeType:h,codecs:L,startWithSAP:"1"===w,bandwidth:T,timescale:B,duration:U,protection:l,lang:D});else{let i;if(e.SegmentTemplate&&(i=r.YO(e.SegmentTemplate)?e.SegmentTemplate[0]:e.SegmentTemplate),t.SegmentTemplate&&(i=r.YO(t.SegmentTemplate)?t.SegmentTemplate[0]:t.SegmentTemplate),i){let e=i.startNumber?n()(i.startNumber):1;if(g=i.initialization,B=d()(i.timescale||"1"),i.duration&&!i.SegmentTimeline){U=d()(i.duration);let a=U/B,o=e+Math.ceil((s.duration||a)/a)-1,l=o;if("live"===s.type&&(r.ai(s.availabilityStartTime)||i.presentationTimeOffset)){const t=((s.timestamp||(0,m.A)())-s.availabilityStartTime)/1e3-(i.presentationTimeOffset?n()(i.presentationTimeOffset):0);o=e+Math.floor(t/a),s.timeShiftBufferDepth&&(e=o-Math.ceil(s.timeShiftBufferDepth/a)+1),l=o,("false"===i.availabilityTimeComplete||s.minimumUpdatePeriod>2*s.minBufferTime)&&(o+=Math.ceil(s.minimumUpdatePeriod/a))}for(let n=e;n<=o;n++){const d=a*(n-e);let r=a*(n-e+1);n===o&&s.duration&&(a=s.duration-a*(o-e),r=s.duration),I.push({idx:n,start:d,end:r,url:M+i.media.replace(/\$RepresentationID\$/g,t.id).replace(/\$Number(%(\d+)d)?\$/g,((e,t,i)=>i?c(n,+i):(0,u.A)(n))),segmentDuration:a,pending:n>l})}}else if(i.SegmentTimeline&&i.SegmentTimeline.S){const s=r.YO(i.SegmentTimeline.S)?i.SegmentTimeline.S:[i.SegmentTimeline.S];let a=0,o=e;for(let e=0;e<s.length;e++){let r=d()(s[e].d);s[e].t&&(a=d()(s[e].t));let l=1;s[e].r&&(l=n()(s[e].r),-1===l&&U?l=Math.ceil(U*B/r):l+=1);for(let e=0;e<l;e++)I.push({idx:o,start:a/B,end:(a+r)/B,url:M+i.media.replace(/\$RepresentationID\$/g,t.id).replace(/\$Number(%(\d+)d)?\$/g,((e,t,i)=>i?c(o,+i):(0,u.A)(o))).replace(/\$Time\$/g,(0,u.A)(a)),segmentDuration:r/B}),o++,a+=r}}}else if(t.SegmentList){const e=r.YO(t.SegmentList.SegmentURL)?t.SegmentList.SegmentURL:[t.SegmentList.SegmentURL];let i=0,s=d()(t.SegmentList.duration);for(let t=0;t<e.length;t++)I.push({idx:t,start:i/B,end:(i+s)/B,url:M+e[t].media,segmentDuration:s/B}),i+=s}"video/mp4"===h||"video"===f?s.mediaList.video.push({id:t.id,baseURL:M,initSegment:M+g.replace(/\$RepresentationID\$/g,t.id).replace(/\$Bandwidth\$/g,(0,u.A)(T)),mediaSegments:I,mimeType:h,codecs:L,width:R,height:y,maxWidth:v,maxHeight:b,frameRate:P,sar:x,startWithSAP:"1"===w,bandwidth:T,timescale:B,duration:U,protection:l}):"audio/mp4"===h||"audio"===f?s.mediaList.audio.push({id:t.id,baseURL:M,initSegment:M+g.replace(/\$RepresentationID\$/g,t.id).replace(/\$Bandwidth\$/g,(0,u.A)(T)),mediaSegments:I,mimeType:h,codecs:L,startWithSAP:"1"===w,bandwidth:T,timescale:B,duration:U,protection:l,lang:D}):"application/mp4"!==h&&"text"!==f||s.mediaList.subtitle.push({id:t.id,baseURL:M,initSegment:M+g.replace(/\$RepresentationID\$/g,t.id).replace(/\$Bandwidth\$/g,(0,u.A)(T)),mediaSegments:I,mimeType:h,codecs:L,startWithSAP:"1"===w,bandwidth:T,timescale:B,duration:U,protection:l,lang:D})}}))})),["video","audio"].forEach((e=>{s.mediaList[e].sort(((e,t)=>e.bandwidth-t.bandwidth))})),s}function R(e,t){const i=(s=e,s?(0,o.A)(s,{aloneValueName:"value"}):null).MPD;var s;if("dynamic"===i.type){const e=r.YO(i.Period)?i.Period[i.Period.length-1]:i.Period;return L(i,e,t)}{const e=(r.YO(i.Period)?i.Period:[i.Period]).map((e=>L(i,e,t))),s=e[0];for(let t=1;t<e.length;t++)s.duration+=e[t].duration,e[t].mediaList.video.forEach((e=>{const t=s.mediaList.video.find((t=>e.initSegment&&e.initSegment===t.initSegment||e.id===t.id));var i,n;t?(null!==(i=t.mediaSegments)&&void 0!==i&&i.length&&null!==(n=e.mediaSegments)&&void 0!==n&&n.length&&e.mediaSegments.forEach((e=>{e.start+=t.mediaSegments[t.mediaSegments.length-1].end,e.end+=t.mediaSegments[t.mediaSegments.length-1].end})),t.mediaSegments=(t.mediaSegments||[]).concat(e.mediaSegments||[])):s.mediaList.video.push(e)})),e[t].mediaList.audio.forEach((e=>{const t=s.mediaList.audio.find((t=>e.initSegment&&e.initSegment===t.initSegment||e.id===t.id));var i,n;t?(null!==(i=t.mediaSegments)&&void 0!==i&&i.length&&null!==(n=e.mediaSegments)&&void 0!==n&&n.length&&e.mediaSegments.forEach((e=>{e.start+=t.mediaSegments[t.mediaSegments.length-1].end,e.end+=t.mediaSegments[t.mediaSegments.length-1].end})),t.mediaSegments=(t.mediaSegments||[]).concat(e.mediaSegments||[])):s.mediaList.audio.push(e)})),e[t].mediaList.subtitle.forEach((e=>{const t=s.mediaList.subtitle.find((t=>e.initSegment&&e.initSegment===t.initSegment||e.id===t.id));var i,n;t?(null!==(i=t.mediaSegments)&&void 0!==i&&i.length&&null!==(n=e.mediaSegments)&&void 0!==n&&n.length&&e.mediaSegments.forEach((e=>{e.start+=t.mediaSegments[t.mediaSegments.length-1].end,e.end+=t.mediaSegments[t.mediaSegments.length-1].end})),t.mediaSegments=(t.mediaSegments||[]).concat(e.mediaSegments||[])):s.mediaList.subtitle.push(e)}));return i.mediaPresentationDuration&&(s.duration=h(i.mediaPresentationDuration)),s}}},79331:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(68632),n=i.n(s),a=i(72739);const d={aloneValueName:"_@attribute"},o=[" ","/",'"',"'","<",">"];function r(e,t=d){e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/[\n\t\r]/g,"")).replace(/>[ \t]+</g,"><")).replace(/<\?[^>]*\?>/g,"");const i=[];let s=0;function r(e,s){const a=i[i.length-1];a&&(e!==t.aloneValueName||null==a.obj[t.aloneValueName]?null==a.obj[e]?a.obj[e]=s:n()(a.obj[e])?a.obj[e].push(s):a.obj[e]=[a.obj[e],s]:a.obj[t.aloneValueName]=[a.obj[t.aloneValueName],{tagName:e,...s}])}function l(t){for(;s<e.length;){if(e[s]===t)return!0;s++}return!1}function u(){m();let t="";for(;s<e.length&&!a.zy(o,e[s]);)t+=e[s],s++;return t}function m(){for(;s<e.length&&/\s|\r|\n/.test(e[s]);)s++}const h=/\s/,c=/'/,g=/"/;function f(){if(s>=e.length)return!0;m();let t=h;'"'!==e[s]&&"'"!=e[s]||(t='"'===e[s]?g:c,s++);let i="";for(;s<e.length;){if(t.test(e[s])){s++;break}i+=e[s],s++}return i}function p(){m();let t="";for(;s<e.length&&"<"!==e[s];)t+=e[s],s++;return t}function S(){for(;"<"===e[s];){const t=s;if(s++,m(),"/"!==e[s]){s=t;break}if(s++,u()===i[i.length-1].tag){if(i.length>1){const e=i.pop();r(e.tag,e.obj)}l(">"),s++,m()}else i.pop(),l(">"),s++,m()}}return function n(){if(s>=e.length)return;let a=s;if(m(),"<"!==e[s])return s=a,r(t.aloneValueName,p()),S(),n();let d=l("<");if(!d)return;a=s,s++;const o=u();if(i.push({obj:{},tag:o,start:a}),function(){for(;m(),">"!==e[s]&&"/"!==e[s];){let e=u();if(!e)break;"="===e[e.length-1]?e=e.substring(0,e.length-1):(l("="),s++),r(e,f())}}(),m(),"/"===e[s]){if(s++,i.length>1){const e=i.pop();r(e.tag,e.obj)}return l(">"),s++,S(),n()}d=l(">"),d&&(s++,m(),"<"!==e[s]&&(r(t.aloneValueName,p()),m()),S(),n())}(),{[i[0].tag]:i[0].obj}}}}]);