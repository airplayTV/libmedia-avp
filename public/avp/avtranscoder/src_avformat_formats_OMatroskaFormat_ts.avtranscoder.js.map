{"version":3,"file":"src_avformat_formats_OMatroskaFormat_ts.avtranscoder.js","mappings":"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","sources":["webpack://AVTranscoder/./src/avformat/bsf/AVBSFilter.ts","webpack://AVTranscoder/./src/avformat/bsf/h2645/Annexb2AvccFilter.ts","webpack://AVTranscoder/./src/avformat/formats/OMatroskaFormat.ts","webpack://AVTranscoder/./src/avformat/formats/matroska/matroska.ts","webpack://AVTranscoder/./src/avformat/formats/matroska/omatroska.ts","webpack://AVTranscoder/./src/avutil/codecs/vvc.ts","webpack://AVTranscoder/./src/avutil/util/crypto.ts","webpack://AVTranscoder/./src/avutil/util/pixel.ts","webpack://AVTranscoder/./src/common/math/align.ts"],"sourcesContent":["/*\r\n * libmedia AVBSFilter\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket from 'avutil/struct/avpacket'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport { avMallocz } from 'avutil/util/mem'\r\nimport { copyCodecParameters, freeCodecParameters } from 'avutil/util/codecparameters'\r\n\r\nexport default abstract class AVBSFilter {\r\n\r\n  inCodecpar: pointer<AVCodecParameters>\r\n  inTimeBase: Rational\r\n\r\n  outCodecpar: pointer<AVCodecParameters>\r\n\r\n  public init(codecpar: pointer<AVCodecParameters>, timeBase: pointer<Rational>): number {\r\n    this.inCodecpar = reinterpret_cast<pointer<AVCodecParameters>>(avMallocz(sizeof(AVCodecParameters)))\r\n    copyCodecParameters(this.inCodecpar, codecpar)\r\n\r\n    this.inTimeBase = {\r\n      den: timeBase.den,\r\n      num: timeBase.num\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  public destroy() {\r\n    if (this.inCodecpar) {\r\n      freeCodecParameters(this.inCodecpar)\r\n      this.inCodecpar = nullptr\r\n    }\r\n  }\r\n\r\n  public abstract sendAVPacket(avpacket: pointer<AVPacket>): number\r\n  public abstract receiveAVPacket(avpacket: pointer<AVPacket>): number\r\n  public abstract reset(): number\r\n}\r\n","/*\r\n * libmedia Annexb2AvccFilter\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport AVBSFilter from '../AVBSFilter'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport { addAVPacketData, addAVPacketSideData, copyAVPacketProps, createAVPacket,\r\n  destroyAVPacket, refAVPacket, unrefAVPacket\r\n} from 'avutil/util/avpacket'\r\n\r\nimport * as h264 from 'avutil/codecs/h264'\r\nimport * as hevc from 'avutil/codecs/hevc'\r\nimport * as vvc from 'avutil/codecs/vvc'\r\nimport { mapSafeUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { AVCodecID, AVPacketSideDataType } from 'avutil/codec'\r\nimport * as errorType from 'avutil/error'\r\nimport { avMalloc } from 'avutil/util/mem'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport default class Annexb2AvccFilter extends AVBSFilter {\r\n\r\n  private cache: pointer<AVPacket>\r\n  private cached: boolean\r\n  private reverseSps: boolean\r\n\r\n  constructor(reverseSps: boolean = false) {\r\n    super()\r\n    this.reverseSps = reverseSps\r\n  }\r\n\r\n  public init(codecpar: pointer<AVCodecParameters>, timeBase: pointer<Rational>): number {\r\n    super.init(codecpar, timeBase)\r\n    this.cache = createAVPacket()\r\n    this.cached = false\r\n\r\n    return 0\r\n  }\r\n\r\n  public destroy(): void {\r\n    super.destroy()\r\n    destroyAVPacket(this.cache)\r\n    this.cache = nullptr\r\n  }\r\n\r\n  public sendAVPacket(avpacket: pointer<AVPacket>): number {\r\n\r\n    const buffer = mapSafeUint8Array(avpacket.data, reinterpret_cast<size>(avpacket.size))\r\n\r\n    if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_H26X_ANNEXB)) {\r\n      refAVPacket(this.cache, avpacket)\r\n    }\r\n    else {\r\n\r\n      copyAVPacketProps(this.cache, avpacket)\r\n\r\n      let convert: {\r\n        bufferPointer: pointer<uint8>,\r\n        length: number,\r\n        extradata: Uint8Array,\r\n        key: boolean\r\n      }\r\n\r\n      if (this.inCodecpar.codecId === AVCodecID.AV_CODEC_ID_H264) {\r\n        convert = h264.annexb2Avcc(buffer, this.reverseSps)\r\n      }\r\n      else if (this.inCodecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n        convert = hevc.annexb2Avcc(buffer, this.reverseSps)\r\n      }\r\n      else if (this.inCodecpar.codecId === AVCodecID.AV_CODEC_ID_VVC) {\r\n        convert = vvc.annexb2Avcc(buffer, this.reverseSps)\r\n      }\r\n      else {\r\n        logger.fatal(`not support for codecId: ${this.inCodecpar.codecId}`)\r\n      }\r\n\r\n      this.cache.flags &= ~AVPacketFlags.AV_PKT_FLAG_H26X_ANNEXB\r\n\r\n      addAVPacketData(this.cache, convert.bufferPointer, convert.length)\r\n\r\n      if (convert.key) {\r\n        this.cache.flags |= AVPacketFlags.AV_PKT_FLAG_KEY\r\n      }\r\n\r\n      if (convert.extradata) {\r\n        const extradata = avMalloc(convert.extradata.length)\r\n        memcpyFromUint8Array(extradata, convert.extradata.length, convert.extradata)\r\n        addAVPacketSideData(this.cache, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradata, convert.extradata.length)\r\n      }\r\n    }\r\n    this.cached = true\r\n    return 0\r\n  }\r\n\r\n  public receiveAVPacket(avpacket: pointer<AVPacket>): number {\r\n    if (this.cached) {\r\n      unrefAVPacket(avpacket)\r\n      refAVPacket(avpacket, this.cache)\r\n      this.cached = false\r\n      return 0\r\n    }\r\n    else {\r\n      return errorType.DATA_INVALID\r\n    }\r\n  }\r\n\r\n  public reset(): number {\r\n    return 0\r\n  }\r\n}\r\n","/*\r\n * libmedia matroska encoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVOFormatContext } from '../AVFormatContext'\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport OFormat from './OFormat'\r\nimport { AVCodecID, AVMediaType, AVPacketSideDataType } from 'avutil/codec'\r\nimport { AVFormat } from 'avutil/avformat'\r\nimport * as logger from 'common/util/logger'\r\nimport { avRescaleQ2 } from 'avutil/util/rational'\r\nimport { createAVPacket, destroyAVPacket, getAVPacketData, getAVPacketSideData, hasAVPacketSideData } from 'avutil/util/avpacket'\r\nimport * as object from 'common/util/object'\r\nimport { OMatroskaContext, TrackEntry } from './matroska/type'\r\nimport IOWriterSync from 'common/io/IOWriterSync'\r\nimport * as omatroska from './matroska/omatroska'\r\nimport { EBMLId, MATROSKATrackType, MkvTag2CodecId, WebmTag2CodecId } from './matroska/matroska'\r\nimport * as crypto from 'avutil/util/crypto'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\nimport { chromaLocation2Pos } from 'avutil/util/pixel'\r\nimport { AV_MILLI_TIME_BASE_Q, NOPTS_VALUE_BIGINT } from 'avutil/constant'\r\nimport * as string from 'common/util/string'\r\nimport AVStream from 'avutil/AVStream'\r\nimport concatTypeArray from 'common/function/concatTypeArray'\r\nimport Annexb2AvccFilter from '../bsf/h2645/Annexb2AvccFilter'\r\nimport * as naluUtil from 'avutil/util/nalu'\r\nimport * as h264 from 'avutil/codecs/h264'\r\nimport * as hevc from 'avutil/codecs/hevc'\r\nimport * as vvc from 'avutil/codecs/vvc'\r\nimport * as intread from 'avutil/util/intread'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport { AVStreamMetadataKey } from 'avutil/AVStream'\r\n\r\nexport interface OMatroskaFormatOptions {\r\n  isLive?: boolean\r\n  docType?: string\r\n}\r\n\r\nconst defaultOMatroskaFormatOptions: OMatroskaFormatOptions = {\r\n  isLive: false,\r\n  docType: 'matroska'\r\n}\r\n\r\nfunction formatTimestamp(milliseconds: int64) {\r\n  const hours = milliseconds / BigInt(1000 * 60 * 60)\r\n  const remainingMilliseconds = milliseconds % BigInt(1000 * 60 * 60)\r\n\r\n  const minutes = remainingMilliseconds / BigInt(1000 * 60)\r\n  const remainingMillisecondsAfterMinutes = remainingMilliseconds % BigInt(1000 * 60)\r\n\r\n  const seconds = remainingMillisecondsAfterMinutes / 1000n\r\n\r\n  const ms = remainingMillisecondsAfterMinutes % 1000n\r\n\r\n  return string.format(\r\n    '%02d:%02d:%02d.%03d000000\\x00\\x00',\r\n    static_cast<int32>(hours),\r\n    static_cast<int32>(minutes),\r\n    static_cast<int32>(seconds),\r\n    static_cast<int32>(ms)\r\n  )\r\n}\r\n\r\nexport default class OMatroskaFormat extends OFormat {\r\n\r\n  public type: AVFormat = AVFormat.MATROSKA\r\n\r\n  private options: OMatroskaFormatOptions\r\n\r\n  private context: OMatroskaContext\r\n\r\n  private random: Uint8Array\r\n  private randomView: DataView\r\n\r\n  private avpacket: pointer<AVPacket>\r\n  private annexb2AvccFilter: Annexb2AvccFilter\r\n\r\n  constructor(options: OMatroskaFormatOptions = {}) {\r\n    super()\r\n    this.options = object.extend({}, defaultOMatroskaFormatOptions, options)\r\n\r\n    this.random = new Uint8Array(8)\r\n    this.randomView = new DataView(this.random.buffer)\r\n  }\r\n\r\n  public init(formatContext: AVOFormatContext): number {\r\n    formatContext.ioWriter.setEndian(false)\r\n    this.avpacket = createAVPacket()\r\n\r\n    const context: OMatroskaContext = {\r\n      isLive: this.options.isLive,\r\n      segmentStart: -1n,\r\n      seekHeadEnd: -1n,\r\n      header: {\r\n        version: 1,\r\n        readVersion: 1,\r\n        maxIdLength: 4,\r\n        maxSizeLength: 8,\r\n        docType: this.options.docType,\r\n        docTypeVersion: 4,\r\n        docTypeReadVersion: 2\r\n      },\r\n      seekHead: {\r\n        entry: []\r\n      },\r\n      info: {\r\n        muxingApp: defined(VERSION),\r\n        writingApp: defined(VERSION),\r\n        timestampScale: 1000000,\r\n        duration: 0,\r\n        segmentUUID: -1n\r\n      },\r\n      tracks: {\r\n        entry: []\r\n      },\r\n      attachments: {\r\n        entry: []\r\n      },\r\n      chapters: {\r\n        entry: []\r\n      },\r\n      cues: {\r\n        entry: []\r\n      },\r\n      tags: {\r\n        entry: [\r\n          {\r\n            tag: {\r\n              name: 'ENCODER',\r\n              string: defined(VERSION)\r\n            }\r\n          }\r\n        ]\r\n      },\r\n\r\n      elePositionInfos: [],\r\n      eleCaches: [],\r\n      eleWriter: new IOWriterSync(),\r\n      currentCluster: {\r\n        timeCode: -1n,\r\n        pos: -1n\r\n      },\r\n      hasVideo: false\r\n    }\r\n\r\n    if (context.header.docType === 'webm') {\r\n      context.header.docTypeVersion = 2\r\n      context.header.docTypeReadVersion = 2\r\n    }\r\n\r\n    context.eleWriter.onFlush = (data) => {\r\n      context.eleCaches.push(data.slice())\r\n      return 0\r\n    }\r\n\r\n    crypto.random(this.random)\r\n    context.info.segmentUUID = this.randomView.getBigUint64(0)\r\n\r\n    formatContext.privateData = this.context = context\r\n\r\n    const tag2CodecId = this.context.header.docType === 'webm' ? WebmTag2CodecId : MkvTag2CodecId\r\n\r\n    function codecId2Tag(codecpar: AVCodecParameters) {\r\n      let tag = ''\r\n      object.each(tag2CodecId, (id, t) => {\r\n        if (id === codecpar.codecId) {\r\n          tag = t\r\n        }\r\n      })\r\n      if (codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_F64LE\r\n        || codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_F32LE\r\n      ) {\r\n        tag = 'A_PCM/FLOAT/IEEE'\r\n      }\r\n      if (codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_S16BE\r\n        || codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_S24BE\r\n        || codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_S32BE\r\n      ) {\r\n        tag = 'A_PCM/INT/BIG'\r\n      }\r\n      if (codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_U8\r\n        || codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_S16LE\r\n        || codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_S24LE\r\n        || codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_S32LE\r\n      ) {\r\n        tag = 'A_PCM/INT/LIT'\r\n      }\r\n      return tag\r\n    }\r\n\r\n    formatContext.streams.forEach((stream) => {\r\n      if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_ATTACHMENT) {\r\n        crypto.random(this.random)\r\n        context.attachments.entry.push({\r\n          uid: this.randomView.getBigUint64(0),\r\n          name: stream.metadata[AVStreamMetadataKey.TITLE] || 'unknown',\r\n          mime: stream.metadata[AVStreamMetadataKey.MIME] || 'unknown',\r\n          data: {\r\n            data: mapUint8Array(stream.codecpar.extradata, reinterpret_cast<size>(stream.codecpar.extradataSize)),\r\n            size: static_cast<int64>(stream.codecpar.extradataSize),\r\n            pos: -1n\r\n          },\r\n          description: stream.metadata[AVStreamMetadataKey.DESCRIPTION] || 'unknown'\r\n        })\r\n      }\r\n      else {\r\n        const track: TrackEntry = {}\r\n        crypto.random(this.random)\r\n        track.uid = this.randomView.getBigUint64(0)\r\n        track.codecId = codecId2Tag(stream.codecpar)\r\n        track.number = stream.index + 1\r\n        if (stream.codecpar.extradata) {\r\n          track.codecPrivate = {\r\n            data: mapUint8Array(stream.codecpar.extradata, reinterpret_cast<size>(stream.codecpar.extradataSize)).slice(),\r\n            pos: -1n,\r\n            size: static_cast<int64>(stream.codecpar.extradataSize)\r\n          }\r\n        }\r\n        if (stream.metadata[AVStreamMetadataKey.LANGUAGE]) {\r\n          track.language = stream.metadata[AVStreamMetadataKey.LANGUAGE]\r\n        }\r\n        if (stream.metadata[AVStreamMetadataKey.TITLE]) {\r\n          track.name = stream.metadata[AVStreamMetadataKey.TITLE]\r\n        }\r\n\r\n        switch (stream.codecpar.codecType) {\r\n          case AVMediaType.AVMEDIA_TYPE_AUDIO: {\r\n            track.type = MATROSKATrackType.AUDIO\r\n            track.audio = {\r\n              channels: stream.codecpar.chLayout.nbChannels,\r\n              sampleRate: reinterpret_cast<float>(stream.codecpar.sampleRate),\r\n              bitDepth: stream.codecpar.bitsPerRawSample\r\n            }\r\n            break\r\n          }\r\n          case AVMediaType.AVMEDIA_TYPE_VIDEO: {\r\n            context.hasVideo = true\r\n            track.type = MATROSKATrackType.VIDEO\r\n            track.video = {\r\n              pixelWidth: stream.codecpar.width,\r\n              pixelHeight: stream.codecpar.height,\r\n              color: {\r\n                matrixCoefficients: stream.codecpar.colorSpace,\r\n                primaries: stream.codecpar.colorPrimaries,\r\n                transferCharacteristics: stream.codecpar.colorTrc,\r\n                range: stream.codecpar.colorRange\r\n              }\r\n            }\r\n            const result = chromaLocation2Pos(stream.codecpar.chromaLocation)\r\n            if (result) {\r\n              track.video.color.chromaSitingVert = (result.x >>> 7) + 1\r\n              track.video.color.chromaSitingHorz = (result.y >>> 7) + 1\r\n            }\r\n            if (stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264\r\n              || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n              || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n            ) {\r\n              if (track.codecPrivate) {\r\n                if (naluUtil.isAnnexb(track.codecPrivate.data)) {\r\n                  if (stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264) {\r\n                    track.codecPrivate.data = h264.annexbExtradata2AvccExtradata(track.codecPrivate.data)\r\n                  }\r\n                  else if (stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n                    track.codecPrivate.data = hevc.annexbExtradata2AvccExtradata(track.codecPrivate.data)\r\n                  }\r\n                  else if (stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC) {\r\n                    track.codecPrivate.data = vvc.annexbExtradata2AvccExtradata(track.codecPrivate.data)\r\n                  }\r\n                  track.codecPrivate.size = static_cast<int64>(track.codecPrivate.data.length)\r\n                }\r\n              }\r\n              this.annexb2AvccFilter = new Annexb2AvccFilter()\r\n              this.annexb2AvccFilter.init(addressof(stream.codecpar), addressof(stream.timeBase))\r\n            }\r\n            break\r\n          }\r\n          case AVMediaType.AVMEDIA_TYPE_SUBTITLE: {\r\n            track.type = MATROSKATrackType.SUBTITLE\r\n            break\r\n          }\r\n        }\r\n        track.lastPts = 0n\r\n        stream.privData = track\r\n\r\n        context.tracks.entry.push(track)\r\n      }\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  public async destroy(formatContext: AVOFormatContext) {\r\n    if (this.annexb2AvccFilter) {\r\n      this.annexb2AvccFilter.destroy()\r\n      this.annexb2AvccFilter = null\r\n    }\r\n    if (this.avpacket) {\r\n      destroyAVPacket(this.avpacket)\r\n      this.avpacket = nullptr\r\n    }\r\n  }\r\n\r\n  public writeHeader(formatContext: AVOFormatContext): number {\r\n    omatroska.writeHeader(formatContext.ioWriter, this.context, this.context.header)\r\n\r\n    omatroska.writeEbmlId(formatContext.ioWriter, EBMLId.SEGMENT)\r\n\r\n    const now = formatContext.ioWriter.getPos()\r\n    omatroska.writeEbmlLengthUnknown(formatContext.ioWriter, 8)\r\n    this.context.elePositionInfos.push({\r\n      pos: now,\r\n      length: 0,\r\n      bytes: 8\r\n    })\r\n\r\n    this.context.segmentStart = formatContext.ioWriter.getPos()\r\n    // SeekHead 占位\r\n    formatContext.ioWriter.skip(96)\r\n    this.context.seekHeadEnd = formatContext.ioWriter.getPos()\r\n\r\n    return 0\r\n  }\r\n\r\n  private writeBlock(stream: AVStream, avpacket: pointer<AVPacket>, id: EBMLId.SIMPLE_BLOCK | EBMLId.BLOCK = EBMLId.SIMPLE_BLOCK) {\r\n    const track = stream.privData as TrackEntry\r\n    omatroska.writeEbmlId(this.context.eleWriter, id)\r\n    if ((stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264\r\n        || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n        || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n    ) && (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_H26X_ANNEXB)\r\n    ) {\r\n      this.annexb2AvccFilter.sendAVPacket(avpacket)\r\n      this.annexb2AvccFilter.receiveAVPacket(this.avpacket)\r\n      avpacket = this.avpacket\r\n    }\r\n    omatroska.writeEbmlLength(this.context.eleWriter, omatroska.ebmlLengthSize(track.number) + 2 + 1 + avpacket.size)\r\n    omatroska.writeEbmlNum(this.context.eleWriter, track.number, omatroska.ebmlLengthSize(track.number))\r\n    const pts = avRescaleQ2(avpacket.pts, addressof(avpacket.timeBase), AV_MILLI_TIME_BASE_Q)\r\n\r\n    this.context.eleWriter.writeInt16(static_cast<int32>(pts - this.context.currentCluster.timeCode))\r\n\r\n    if (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY || stream.codecpar.codecType !== AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n      this.context.eleWriter.writeUint8(0x80)\r\n    }\r\n    else {\r\n      this.context.eleWriter.writeUint8(0x00)\r\n    }\r\n    if (!track.codecPrivate) {\r\n      let element = getAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA)\r\n      if (element) {\r\n        track.codecPrivate = {\r\n          data: mapUint8Array(element.data, element.size).slice(),\r\n          pos: -1n,\r\n          size: static_cast<int64>(element.size)\r\n        }\r\n      }\r\n    }\r\n    this.context.eleWriter.writeBuffer(getAVPacketData(avpacket))\r\n  }\r\n\r\n  private writeBlockGroup(stream: AVStream, avpacket: pointer<AVPacket>) {\r\n    omatroska.writeEleData(this.context.eleWriter, this.context, EBMLId.BLOCK_GROUP, (eleWriter) => {\r\n      if (avpacket.duration > 0) {\r\n        omatroska.writeEbmlUint(eleWriter, EBMLId.BLOCK_DURATION, avRescaleQ2(avpacket.duration, addressof(avpacket.timeBase), AV_MILLI_TIME_BASE_Q))\r\n      }\r\n      const additions: {\r\n        additionalId: int64\r\n        buffer: Uint8ArrayInterface\r\n      }[] = []\r\n      for (let i = 0; i < avpacket.sideDataElems; i++) {\r\n        if (avpacket.sideData[i].type === AVPacketSideDataType.AV_PKT_DATA_MATROSKA_BLOCKADDITIONAL) {\r\n          additions.push({\r\n            additionalId: intread.rb64(avpacket.sideData[i].data),\r\n            buffer: mapUint8Array(avpacket.sideData[i].data + 8, avpacket.sideData[i].size - 8)\r\n          })\r\n        }\r\n      }\r\n      if (additions.length) {\r\n        omatroska.writeEleData(this.context.eleWriter, this.context, EBMLId.BLOCK_ADDITIONS, (eleWriter) => {\r\n          omatroska.writeEleData(eleWriter, this.context, EBMLId.BLOCK_MORE, (eleWriter) => {\r\n            additions.forEach((addition) => {\r\n              omatroska.writeEbmlUint(eleWriter, EBMLId.BLOCK_ADD_ID, addition.additionalId)\r\n              omatroska.writeEbmlBuffer(eleWriter, EBMLId.BLOCK_ADDITIONS, addition.buffer)\r\n            })\r\n          })\r\n        })\r\n      }\r\n      if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO\r\n        && !(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY)\r\n      ) {\r\n        const track = stream.privData as TrackEntry\r\n        omatroska.writeEbmlSint(eleWriter, EBMLId.BLOCK_REFERENCE, track.lastPts - avpacket.pts)\r\n      }\r\n      this.writeBlock(stream, avpacket, EBMLId.BLOCK)\r\n    })\r\n  }\r\n\r\n  private writeCluster(formatContext: AVOFormatContext) {\r\n    if (this.context.currentCluster.pos === -1n) {\r\n      return\r\n    }\r\n\r\n    formatContext.ioWriter.flush()\r\n    this.context.eleWriter.flush()\r\n\r\n    let block = concatTypeArray(Uint8Array, this.context.eleCaches)\r\n\r\n    if (!block.length) {\r\n      return\r\n    }\r\n\r\n    this.context.eleCaches.length = 0\r\n    omatroska.writeEbmlUint(this.context.eleWriter, EBMLId.CLUSTER_TIME_CODE, this.context.currentCluster.timeCode)\r\n    this.context.eleWriter.flush()\r\n    block = concatTypeArray(Uint8Array, [...this.context.eleCaches, block])\r\n\r\n\r\n    omatroska.writeEbmlId(formatContext.ioWriter, EBMLId.CLUSTER)\r\n    omatroska.writeEbmlLength(formatContext.ioWriter, block.length)\r\n    formatContext.ioWriter.writeBuffer(block)\r\n\r\n    formatContext.ioWriter.flush()\r\n    this.context.eleCaches.length = 0\r\n  }\r\n\r\n  public writeAVPacket(formatContext: AVOFormatContext, avpacket: pointer<AVPacket>): number {\r\n\r\n    if (!avpacket.size) {\r\n      logger.warn(`packet\\'s size is 0: ${avpacket.streamIndex}, ignore it`)\r\n      return 0\r\n    }\r\n\r\n    const stream = formatContext.getStreamByIndex(avpacket.streamIndex)\r\n\r\n    if (!stream) {\r\n      logger.warn(`can not found the stream width the avpacket\\'s streamIndex: ${avpacket.streamIndex}, ignore it`)\r\n      return\r\n    }\r\n\r\n    const track = stream.privData as TrackEntry\r\n\r\n    const pts = avRescaleQ2(avpacket.pts !== NOPTS_VALUE_BIGINT ? avpacket.pts : avpacket.dts, addressof(avpacket.timeBase), AV_MILLI_TIME_BASE_Q)\r\n\r\n    if (!track.maxPts || track.maxPts < pts) {\r\n      track.maxPts = pts\r\n      track.duration = pts\r\n      if (avpacket.duration !== NOPTS_VALUE_BIGINT) {\r\n        track.duration += avRescaleQ2(avpacket.duration, addressof(avpacket.timeBase), AV_MILLI_TIME_BASE_Q)\r\n      }\r\n    }\r\n\r\n    if (this.options.isLive\r\n      || (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY)\r\n        && (\r\n          stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO\r\n          || !this.context.hasVideo\r\n            && (pts - this.context.currentCluster.timeCode > 5000n)\r\n        )\r\n    ) {\r\n      this.writeCluster(formatContext)\r\n      this.context.currentCluster.timeCode = pts\r\n      this.context.currentCluster.pos = formatContext.ioWriter.getPos() - this.context.segmentStart\r\n      this.context.cues.entry.push({\r\n        time: this.context.currentCluster.timeCode,\r\n        pos: [{\r\n          pos: this.context.currentCluster.pos,\r\n          track: track.number\r\n        }]\r\n      })\r\n    }\r\n\r\n    if (avpacket.duration > 0\r\n      || hasAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_MATROSKA_BLOCKADDITIONAL)\r\n    ) {\r\n      this.writeBlockGroup(stream, avpacket)\r\n    }\r\n    else {\r\n      this.writeBlock(stream, avpacket)\r\n    }\r\n\r\n    track.lastPts = avpacket.pts\r\n\r\n    return 0\r\n  }\r\n\r\n  public writeTrailer(formatContext: AVOFormatContext): number {\r\n\r\n    this.writeCluster(formatContext)\r\n\r\n    formatContext.streams.forEach((stream) => {\r\n      const track = stream.privData as TrackEntry\r\n\r\n      if (!this.options.isLive && track?.duration) {\r\n        const duration = track.duration\r\n        this.context.info.duration = reinterpret_cast<float>(static_cast<int32>(duration))\r\n        this.context.tags.entry.push({\r\n          tag: {\r\n            name: 'DURATION',\r\n            string: formatTimestamp(duration)\r\n          },\r\n          target: {\r\n            trackUid: track.uid\r\n          }\r\n        })\r\n      }\r\n    })\r\n\r\n    formatContext.ioWriter.flush()\r\n    this.context.eleWriter.flush()\r\n    this.context.eleCaches.length = 0\r\n\r\n    this.context.eleWriter.reset()\r\n\r\n    const now = formatContext.ioWriter.getPos()\r\n    let segmentLength = now - this.context.segmentStart\r\n\r\n    this.context.seekHead.entry.push({\r\n      id: EBMLId.INFO,\r\n      pos: this.context.eleWriter.getPos() + this.context.seekHeadEnd - this.context.segmentStart\r\n    })\r\n    omatroska.writeInfo(this.context.eleWriter, this.context, this.context.info)\r\n    this.context.seekHead.entry.push({\r\n      id: EBMLId.TRACKS,\r\n      pos: this.context.eleWriter.getPos() + this.context.seekHeadEnd - this.context.segmentStart\r\n    })\r\n    omatroska.writeTracks(this.context.eleWriter, this.context, this.context.tracks)\r\n    this.context.seekHead.entry.push({\r\n      id: EBMLId.TAGS,\r\n      pos: this.context.eleWriter.getPos() + this.context.seekHeadEnd - this.context.segmentStart\r\n    })\r\n    omatroska.writeTags(this.context.eleWriter, this.context, this.context.tags)\r\n    this.context.eleWriter.flush()\r\n\r\n    const buffer = concatTypeArray(Uint8Array, this.context.eleCaches)\r\n    formatContext.ioWriter.onFlush(buffer, this.context.seekHeadEnd)\r\n\r\n    segmentLength += static_cast<int64>(buffer.length)\r\n\r\n    this.context.cues.entry.forEach((cue) => {\r\n      cue.pos.forEach((item) => {\r\n        item.pos += static_cast<int64>(buffer.length)\r\n      })\r\n    })\r\n\r\n    if (this.context.cues.entry.length) {\r\n      this.context.seekHead.entry.push({\r\n        id: EBMLId.CUES,\r\n        pos: formatContext.ioWriter.getPos() - this.context.segmentStart + static_cast<int64>(buffer.length)\r\n      })\r\n      omatroska.writeCues(formatContext.ioWriter, this.context, this.context.cues)\r\n    }\r\n    if (this.context.attachments.entry.length) {\r\n      this.context.seekHead.entry.push({\r\n        id: EBMLId.ATTACHMENTS,\r\n        pos: formatContext.ioWriter.getPos() - this.context.segmentStart + static_cast<int64>(buffer.length)\r\n      })\r\n      omatroska.writeAttachments(formatContext.ioWriter, this.context, this.context.attachments)\r\n    }\r\n\r\n    formatContext.ioWriter.flush()\r\n    segmentLength += formatContext.ioWriter.getPos() - now\r\n\r\n    formatContext.ioWriter.seek(this.context.segmentStart)\r\n    omatroska.writeSeekHeader(formatContext.ioWriter, this.context, this.context.seekHead)\r\n    const seekHeadLen = formatContext.ioWriter.getPos() - this.context.segmentStart\r\n    omatroska.writeEbmlId(formatContext.ioWriter, EBMLId.VOID)\r\n    omatroska.writeEbmlLength(formatContext.ioWriter, this.context.seekHeadEnd - this.context.segmentStart - seekHeadLen - 2n, 1)\r\n    formatContext.ioWriter.flush()\r\n\r\n    this.context.elePositionInfos[0].length = segmentLength\r\n    omatroska.updatePositionSize(formatContext.ioWriter, this.context)\r\n\r\n    this.context.eleCaches.length = 0\r\n\r\n    return 0\r\n  }\r\n\r\n  public flush(formatContext: AVOFormatContext): number {\r\n    formatContext.ioWriter.flush()\r\n    this.context.currentCluster.timeCode = -1n\r\n    this.context.currentCluster.pos = -1n\r\n    return 0\r\n  }\r\n\r\n}\r\n","/*\r\n * libmedia matroska defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID } from 'avutil/codec'\r\n\r\nexport const enum EbmlType {\r\n  NONE,\r\n  UINT,\r\n  UINT64,\r\n  SINT,\r\n  SINT64,\r\n  FLOAT,\r\n  DOUBLE,\r\n  STRING,\r\n  BUFFER,\r\n  OBJECT,\r\n  BOOL\r\n}\r\n\r\nexport const enum EBMLId {\r\n  HEADER = 0x1A45DFA3,\r\n  SEGMENT = 0x18538067,\r\n\r\n  EBML_VERSION = 0x4286,\r\n  EBML_READ_VERSION = 0x42F7,\r\n  EBML_MAX_ID_LENGTH = 0x42F2,\r\n  EBML_MAX_SIZE_LENGTH = 0x42F3,\r\n  DOCTYPE = 0x4282,\r\n  DOC_TYPE_VERSION = 0x4287,\r\n  DOC_TYPE_READ_VERSION = 0x4285,\r\n  VOID = 0xEC,\r\n  CRC32 = 0xBF,\r\n\r\n  // Matroska top-level master ID\r\n  INFO = 0x1549A966,\r\n  TRACKS = 0x1654AE6B,\r\n  CUES = 0x1C53BB6B,\r\n  TAGS = 0x1254C367,\r\n  SEEK_HEAD = 0x114D9B74,\r\n  ATTACHMENTS = 0x1941A469,\r\n  CLUSTER = 0x1F43B675,\r\n  CHAPTERS = 0x1043A770,\r\n\r\n  /* IDs in the info master */\r\n  TIME_CODE_SCALE = 0x2AD7B1,\r\n  DURATION = 0x4489,\r\n  TITLE = 0x7BA9,\r\n  WRITING_APP = 0x5741,\r\n  MUXING_APP = 0x4D80,\r\n  DATE_UTC = 0x4461,\r\n  SEGMENT_UID = 0x73A4,\r\n\r\n  /* ID in the tracks master */\r\n  TRACK_ENTRY = 0xAE,\r\n\r\n  /* IDs in the track entry master */\r\n  TRACK_NUMBER = 0xD7,\r\n  TRACK_UID = 0x73C5,\r\n  TRACK_TYPE = 0x83,\r\n  TRACK_VIDEO = 0xE0,\r\n  TRACK_AUDIO = 0xE1,\r\n  TRACK_OPERATION = 0xE2,\r\n  TRACK_COMBINE_PLANES = 0xE3,\r\n  TRACK_PLANE = 0xE4,\r\n  TRACK_PLANE_UID = 0xE5,\r\n  TRACK_PLANE_TYPE = 0xE6,\r\n  CODEC_ID = 0x86,\r\n  CODEC_PRIVATE = 0x63A2,\r\n  CODEC_NAME = 0x258688,\r\n  CODEC_INFO_URL = 0x3B4040,\r\n  CODEC_DOWN_LOAD_URL = 0x26B240,\r\n  CODEC_DECODE_ALL = 0xAA,\r\n  CODEC_DELAY = 0x56AA,\r\n  SEEK_PREROLL = 0x56BB,\r\n  TRACK_NAME = 0x536E,\r\n  TRACK_LANGUAGE = 0x22B59C,\r\n  TRACK_FLAG_ENABLED = 0xB9,\r\n  TRACK_FLAG_DEFAULT = 0x88,\r\n  TRACK_FLAG_FORCED = 0x55AA,\r\n  TRACK_FLAG_LACING = 0x9C,\r\n  TRACK_MIN_CACHE = 0x6DE7,\r\n  TRACK_MAX_CACHE = 0x6DF8,\r\n  TRACK_DEFAULT_DURATION = 0x23E383,\r\n  TRACK_CONTENT_ENCODINGS = 0x6D80,\r\n  TRACK_CONTENT_ENCODING = 0x6240,\r\n  TRACK_TIME_CODE_SCALE = 0x23314F,\r\n  TRACK_MAX_BLK_ADD_ID = 0x55EE,\r\n\r\n  /* IDs in the track video master */\r\n  VIDEO_FRAMERATE = 0x2383E3,\r\n  VIDEO_DISPLAY_WIDTH = 0x54B0,\r\n  VIDEO_DISPLAY_HEIGHT = 0x54BA,\r\n  VIDEO_PIXEL_WIDTH = 0xB0,\r\n  VIDEO_PIXEL_HEIGHT = 0xBA,\r\n  VIDEO_PIXEL_CROP_B = 0x54AA,\r\n  VIDEO_PIXEL_CROP_T = 0x54BB,\r\n  VIDEO_PIXEL_CROP_L = 0x54CC,\r\n  VIDEO_PIXEL_CROP_R = 0x54DD,\r\n  VIDEO_DISPLAY_UNIT = 0x54B2,\r\n  VIDEO_FLAG_INTERLACED = 0x9A,\r\n  VIDEO_FIELD_ORDER = 0x9D,\r\n  VIDEO_STEREO_MODE = 0x53B8,\r\n  VIDEO_ALPHA_MODE = 0x53C0,\r\n  VIDEO_ASPECT_RATIO = 0x54B3,\r\n  VIDEO_COLORSPACE = 0x2EB524,\r\n  VIDEO_COLOR = 0x55B0,\r\n\r\n  VIDEO_COLOR_MATRIX_COEFF = 0x55B1,\r\n  VIDEO_COLOR_BITS_PER_CHANNEL = 0x55B2,\r\n  VIDEO_COLOR_CHROMA_SUB_HORZ = 0x55B3,\r\n  VIDEO_COLOR_CHROMA_SUB_VERT = 0x55B4,\r\n  VIDEO_COLOR_CB_SUB_HORZ = 0x55B5,\r\n  VIDEO_COLOR_CB_SUB_VERT = 0x55B6,\r\n  VIDEO_COLOR_CHROMA_SITING_HORZ = 0x55B7,\r\n  VIDEO_COLOR_CHROMA_SITING_VERT = 0x55B8,\r\n  VIDEO_COLOR_RANGE = 0x55B9,\r\n  VIDEO_COLOR_TRANSFER_CHARACTERISTICS = 0x55BA,\r\n\r\n  VIDEO_COLOR_PRIMARIES = 0x55BB,\r\n  VIDEO_COLOR_MAX_CLL = 0x55BC,\r\n  VIDEO_COLOR_MAX_FALL = 0x55BD,\r\n\r\n  VIDEO_COLOR_MASTERING_META = 0x55D0,\r\n  VIDEO_COLOR_RX = 0x55D1,\r\n  VIDEO_COLOR_RY = 0x55D2,\r\n  VIDEO_COLOR_GX = 0x55D3,\r\n  VIDEO_COLOR_GY = 0x55D4,\r\n  VIDEO_COLOR_BX = 0x55D5,\r\n  VIDEO_COLOR_BY = 0x55D6,\r\n  VIDEO_COLOR_WHITE_X = 0x55D7,\r\n  VIDEO_COLOR_WHITE_Y = 0x55D8,\r\n  VIDEO_COLOR_LUMINA_NCE_MAX = 0x55D9,\r\n  VIDEO_COLOR_LUMINA_NCE_MIN = 0x55DA,\r\n\r\n  VIDEO_PROJECTION = 0x7670,\r\n  VIDEO_PROJECTION_TYPE = 0x7671,\r\n  VIDEO_PROJECTION_PRIVATE = 0x7672,\r\n  VIDEO_PROJECTION_POSE_YAW = 0x7673,\r\n  VIDEO_PROJECTION_POSE_PITCH = 0x7674,\r\n  VIDEO_PROJECTION_POSE_ROLL = 0x7675,\r\n\r\n  /* IDs in the track audio master */\r\n  AUDIO_SAMPLING_FREQ = 0xB5,\r\n  AUDIO_OUT_SAMPLING_FREQ = 0x78B5,\r\n\r\n  AUDIO_BITDEPTH = 0x6264,\r\n  AUDIO_CHANNELS = 0x9F,\r\n\r\n  /* IDs in the content encoding master */\r\n  ENCODING_ORDER = 0x5031,\r\n  ENCODING_SCOPE = 0x5032,\r\n  ENCODING_TYPE = 0x5033,\r\n  ENCODING_COMPRESSION = 0x5034,\r\n  ENCODING_COMP_ALGO = 0x4254,\r\n  ENCODING_COMP_SETTINGS = 0x4255,\r\n\r\n  ENCODING_ENCRYPTION = 0x5035,\r\n  ENCODING_ENC_AES_SETTINGS = 0x47E7,\r\n  ENCODING_ENC_ALGO = 0x47E1,\r\n  ENCODING_ENC_KEY_ID = 0x47E2,\r\n  ENCODING_SIG_ALGO = 0x47E5,\r\n  ENCODING_SIG_HASH_ALGO = 0x47E6,\r\n  ENCODING_SIG_KEY_ID = 0x47E4,\r\n  ENCODING_SIG_NATURE = 0x47E3,\r\n\r\n  /* ID in the cues master */\r\n  POINT_ENTRY = 0xBB,\r\n\r\n  /* IDs in the point entry master */\r\n  CUE_TIME = 0xB3,\r\n  CUE_TRACK_POSITION = 0xB7,\r\n\r\n  /* IDs in the cue track position master */\r\n  CUE_TRACK = 0xF7,\r\n  CUE_CLUSTER_POSITION = 0xF1,\r\n  CUE_RELATIVE_POSITION = 0xF0,\r\n  CUE_DURATION = 0xB2,\r\n  CUE_BLOCKNUMBER = 0x5378,\r\n\r\n  /* IDs in the tags master */\r\n  TAG = 0x7373,\r\n  TAG_SIMPLE = 0x67C8,\r\n  TAG_NAME = 0x45A3,\r\n  TAG_STRING = 0x4487,\r\n  TAG_LANG = 0x447A,\r\n  TAG_DEFAULT = 0x4484,\r\n  TAG_DEFAULT_BUG = 0x44B4,\r\n  TAG_TARGETS = 0x63C0,\r\n  TAG_TARGETS_TYPE = 0x63CA,\r\n  TAG_TARGETS_TYPE_VALUE = 0x68CA,\r\n  TAG_TARGETS_TRACK_UID = 0x63C5,\r\n  TAG_TARGETS_CHAPTER_UID = 0x63C4,\r\n  TAG_TARGETS_ATTACH_UID = 0x63C6,\r\n\r\n  /* IDs in the seek head master */\r\n  SEEK_ENTRY = 0x4DBB,\r\n\r\n  /* IDs in the seek point master */\r\n  SEEK_ID = 0x53AB,\r\n  SEEK_POSITION = 0x53AC,\r\n\r\n  /* IDs in the cluster master */\r\n  CLUSTER_TIME_CODE = 0xE7,\r\n  CLUSTER_POSITION = 0xA7,\r\n  CLUSTER_PREV_SIZE = 0xAB,\r\n  BLOCK_GROUP = 0xA0,\r\n  BLOCK_ADDITIONS = 0x75A1,\r\n  BLOCK_MORE = 0xA6,\r\n  BLOCK_ADD_ID = 0xEE,\r\n  BLOCK_ADDITIONAL = 0xA5,\r\n  SIMPLE_BLOCK = 0xA3,\r\n\r\n  /* IDs in the block group master */\r\n  BLOCK = 0xA1,\r\n  BLOCK_DURATION = 0x9B,\r\n  BLOCK_REFERENCE = 0xFB,\r\n  CODEC_STATE = 0xA4,\r\n  DISCARD_PADDING = 0x75A2,\r\n\r\n  /* IDs in the attachments master */\r\n  ATTACHED_FILE = 0x61A7,\r\n  FILE_DESC = 0x467E,\r\n  FILE_NAME = 0x466E,\r\n  FILE_MIMETYPE = 0x4660,\r\n  FILE_DATA = 0x465C,\r\n  FILE_UID = 0x46AE,\r\n\r\n  /* IDs in the chapters master */\r\n  EDITION_ENTRY = 0x45B9,\r\n  CHAPTER_ATOM = 0xB6,\r\n  CHAPTER_TIME_START = 0x91,\r\n  CHAPTER_TIME_END = 0x92,\r\n  CHAPTER_DISPLAY = 0x80,\r\n  CHAP_STRING = 0x85,\r\n  CHAP_LANG = 0x437C,\r\n  CHAP_COUNTRY = 0x437E,\r\n  EDITION_UID = 0x45BC,\r\n  EDITION_FLAG_HIDDEN = 0x45BD,\r\n  EDITION_FLAG_DEFAULT = 0x45DB,\r\n  EDITION_FLAG_ORDERED = 0x45DD,\r\n  CHAPTER_UID = 0x73C4,\r\n  CHAPTER_FLAG_HIDDEN = 0x98,\r\n  CHAPTER_FLAG_ENABLED = 0x4598,\r\n  CHAPTER_PHYS_EQUIV = 0x63C3\r\n}\r\n\r\nexport const enum MATROSKATrackType {\r\n  NONE = 0x0,\r\n  VIDEO = 0x1,\r\n  AUDIO = 0x2,\r\n  COMPLEX = 0x3,\r\n  LOGO = 0x10,\r\n  SUBTITLE = 0x11,\r\n  BUTTONS = 0x12,\r\n  CONTROL = 0x20,\r\n  METADATA = 0x21,\r\n}\r\n\r\nexport const enum MATROSKATrackEncodingComp {\r\n  Z_LIB = 0,\r\n  BZ_LIB = 1,\r\n  LZO = 2,\r\n  HEADER_STRIP = 3\r\n}\r\n\r\nexport const enum MATROSKAVideoInterlaceFlag {\r\n  UNDETERMINED = 0,\r\n  INTERLACED = 1,\r\n  PROGRESSIVE = 2\r\n}\r\n\r\nexport const enum MATROSKAVideoFieldOrder {\r\n  PROGRESSIVE = 0,\r\n  TT = 1,\r\n  UNDETERMINED = 2,\r\n  BB = 6,\r\n  TB = 9,\r\n  BT = 14\r\n}\r\n\r\nexport const enum MATROSKAVideoStereoModeType {\r\n  MONO = 0,\r\n  LEFT_RIGHT = 1,\r\n  BOTTOM_TOP = 2,\r\n  TOP_BOTTOM = 3,\r\n  CHECKERBOARD_RL = 4,\r\n  CHECKERBOARD_LR = 5,\r\n  ROW_INTERLEAVED_RL = 6,\r\n  ROW_INTERLEAVED_LR = 7,\r\n  COL_INTERLEAVED_RL = 8,\r\n  COL_INTERLEAVED_LR = 9,\r\n  ANAGLYPH_CYAN_RED  = 10,\r\n  RIGHT_LEFT = 11,\r\n  ANAGLYPH_GREEN_MAG = 12,\r\n  BOTH_EYES_BLOCK_LR = 13,\r\n  BOTH_EYES_BLOCK_RL = 14,\r\n  NB\r\n}\r\n\r\nexport const enum MATROSKAVideoDisplayUint {\r\n  PIXELS = 0,\r\n  CENTIMETERS = 1,\r\n  INCHES = 2,\r\n  DAR = 3,\r\n  UNKNOWN = 4\r\n}\r\n\r\nexport const enum MATROSKAColourChromaSitingHorz {\r\n  UNDETERMINED = 0,\r\n  LEFT = 1,\r\n  HALF = 2,\r\n  NB\r\n}\r\n\r\nexport const enum MATROSKAColourChromaSitingVert {\r\n  UNDETERMINED = 0,\r\n  TOP = 1,\r\n  HALF = 2,\r\n  NB\r\n}\r\n\r\nexport const enum MATROSKAVideoProjectionType {\r\n  RECTANGULAR = 0,\r\n  EQUIRECTANGULAR = 1,\r\n  CUBE_MAP = 2,\r\n  MESH = 3\r\n}\r\n\r\nexport const enum MATROSKALacingMode {\r\n  NO_LACING = 0,\r\n  XIPH = 1,\r\n  FIXED_SIZE = 2,\r\n  EBML = 3\r\n}\r\n\r\nexport const enum MATROSKABlockAddIdType {\r\n  DEFAULT = 0,\r\n  OPAQUE = 1,\r\n  ITU_T_T35 = 4,\r\n  DVCC = 0x64766343,\r\n  DVVC = 0x64767643\r\n}\r\n\r\nexport const enum MATROSKATrackEncodingComp {\r\n  MATROSKA_TRACK_ENCODING_COMP_ZLIB        = 0,\r\n  MATROSKA_TRACK_ENCODING_COMP_BZLIB       = 1,\r\n  MATROSKA_TRACK_ENCODING_COMP_LZO         = 2,\r\n  MATROSKA_TRACK_ENCODING_COMP_HEADERSTRIP = 3\r\n}\r\n\r\nexport const MkvTag2CodecId: Record<string, AVCodecID> = {\r\n  'A_AAC': AVCodecID.AV_CODEC_ID_AAC,\r\n  'A_AC3': AVCodecID.AV_CODEC_ID_AC3,\r\n  'A_ALAC': AVCodecID.AV_CODEC_ID_ALAC,\r\n  'A_DTS': AVCodecID.AV_CODEC_ID_DTS,\r\n  'A_EAC3': AVCodecID.AV_CODEC_ID_EAC3,\r\n  'A_FLAC': AVCodecID.AV_CODEC_ID_FLAC,\r\n  'A_MLP': AVCodecID.AV_CODEC_ID_MLP,\r\n  'A_MPEG/L2': AVCodecID.AV_CODEC_ID_MP2,\r\n  'A_MPEG/L1': AVCodecID.AV_CODEC_ID_MP1,\r\n  'A_MPEG/L3': AVCodecID.AV_CODEC_ID_MP3,\r\n  'A_OPUS': AVCodecID.AV_CODEC_ID_OPUS,\r\n  'A_OPUS/EXPERIMENTAL': AVCodecID.AV_CODEC_ID_OPUS,\r\n  'A_PCM/FLOAT/IEEE': AVCodecID.AV_CODEC_ID_PCM_F32LE,\r\n  'A_PCM/INT/BIG': AVCodecID.AV_CODEC_ID_PCM_S16BE,\r\n  'A_PCM/INT/LIT': AVCodecID.AV_CODEC_ID_PCM_S16LE,\r\n  'A_QUICKTIME/QDMC': AVCodecID.AV_CODEC_ID_QDMC,\r\n  'A_QUICKTIME/QDM2': AVCodecID.AV_CODEC_ID_QDM2,\r\n  'A_REAL/14_4': AVCodecID.AV_CODEC_ID_RA_144,\r\n  'A_REAL/28_8': AVCodecID.AV_CODEC_ID_RA_288,\r\n  'A_REAL/ATRC': AVCodecID.AV_CODEC_ID_ATRAC3,\r\n  'A_REAL/COOK': AVCodecID.AV_CODEC_ID_COOK,\r\n  'A_REAL/SIPR': AVCodecID.AV_CODEC_ID_SIPR,\r\n  'A_TRUEHD': AVCodecID.AV_CODEC_ID_TRUEHD,\r\n  'A_TTA1': AVCodecID.AV_CODEC_ID_TTA,\r\n  'A_VORBIS': AVCodecID.AV_CODEC_ID_VORBIS,\r\n  'A_WAVPACK4': AVCodecID.AV_CODEC_ID_WAVPACK,\r\n\r\n  'D_WEBVTT/SUBTITLES': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n  'D_WEBVTT/CAPTIONS': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n  'D_WEBVTT/DESCRIPTIONS': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n  'D_WEBVTT/METADATA': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n\r\n  'S_TEXT/UTF8': AVCodecID.AV_CODEC_ID_SUBRIP,\r\n  'S_TEXT/ASCII': AVCodecID.AV_CODEC_ID_TEXT,\r\n  'S_TEXT/ASS': AVCodecID.AV_CODEC_ID_ASS,\r\n  'S_TEXT/SSA': AVCodecID.AV_CODEC_ID_ASS,\r\n  'S_ASS': AVCodecID.AV_CODEC_ID_ASS,\r\n  'S_SSA': AVCodecID.AV_CODEC_ID_ASS,\r\n  'S_VOBSUB': AVCodecID.AV_CODEC_ID_DVD_SUBTITLE,\r\n  'S_DVBSUB': AVCodecID.AV_CODEC_ID_DVB_SUBTITLE,\r\n  'S_HDMV/PGS': AVCodecID.AV_CODEC_ID_HDMV_PGS_SUBTITLE,\r\n  'S_HDMV/TEXTST': AVCodecID.AV_CODEC_ID_HDMV_TEXT_SUBTITLE,\r\n\r\n  'V_AV1': AVCodecID.AV_CODEC_ID_AV1,\r\n  'V_DIRAC': AVCodecID.AV_CODEC_ID_DIRAC,\r\n  'V_FFV1': AVCodecID.AV_CODEC_ID_FFV1,\r\n  'V_MJPEG': AVCodecID.AV_CODEC_ID_MJPEG,\r\n  'V_MPEG1': AVCodecID.AV_CODEC_ID_MPEG1VIDEO,\r\n  'V_MPEG2': AVCodecID.AV_CODEC_ID_MPEG2VIDEO,\r\n  'V_MPEG4/ISO/ASP': AVCodecID.AV_CODEC_ID_MPEG4,\r\n  'V_MPEG4/ISO/AP': AVCodecID.AV_CODEC_ID_MPEG4,\r\n  'V_MPEG4/ISO/SP': AVCodecID.AV_CODEC_ID_MPEG4,\r\n  'V_MPEG4/ISO/AVC': AVCodecID.AV_CODEC_ID_H264,\r\n  'V_MPEGH/ISO/HEVC': AVCodecID.AV_CODEC_ID_HEVC,\r\n  'V_MPEGH/ISO/VVC': AVCodecID.AV_CODEC_ID_VVC,\r\n  'V_MPEG4/MS/V3': AVCodecID.AV_CODEC_ID_MSMPEG4V3,\r\n  'V_PRORES': AVCodecID.AV_CODEC_ID_PRORES,\r\n  'V_REAL/RV10': AVCodecID.AV_CODEC_ID_RV10,\r\n  'V_REAL/RV20': AVCodecID.AV_CODEC_ID_RV20,\r\n  'V_REAL/RV30': AVCodecID.AV_CODEC_ID_RV30,\r\n  'V_REAL/RV40': AVCodecID.AV_CODEC_ID_RV40,\r\n  'V_SNOW': AVCodecID.AV_CODEC_ID_SNOW,\r\n  'V_THEORA': AVCodecID.AV_CODEC_ID_THEORA,\r\n  'V_UNCOMPRESSED': AVCodecID.AV_CODEC_ID_RAWVIDEO,\r\n  'V_VP8': AVCodecID.AV_CODEC_ID_VP8,\r\n  'V_VP9': AVCodecID.AV_CODEC_ID_VP9\r\n}\r\n\r\nexport const WebmTag2CodecId: Record<string, AVCodecID> = {\r\n  'V_VP8': AVCodecID.AV_CODEC_ID_VP8,\r\n  'V_VP9': AVCodecID.AV_CODEC_ID_VP9,\r\n  'V_AV1': AVCodecID.AV_CODEC_ID_AV1,\r\n\r\n  'A_VORBIS': AVCodecID.AV_CODEC_ID_VORBIS,\r\n  'A_OPUS': AVCodecID.AV_CODEC_ID_OPUS,\r\n\r\n  'D_WEBVTT/SUBTITLES': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n  'D_WEBVTT/CAPTIONS': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n  'D_WEBVTT/DESCRIPTIONS': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n  'D_WEBVTT/METADATA': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n}\r\n","/*\r\n * libmedia matroska encoder util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { BytesWriterSync, Uint8ArrayInterface } from 'common/io/interface'\r\nimport { EBMLId } from './matroska'\r\nimport * as is from 'common/util/is'\r\nimport IOWriterSync from 'common/io/IOWriterSync'\r\nimport * as text from 'common/util/text'\r\nimport { Attachment, Attachments, AudioTrack, Chapter, ChapterAtom, ChapterDisplay,\r\n  Chapters, CuePoint, CuePointPos, Cues, ElePositionInfo, Header, Info, OMatroskaContext,\r\n  SeekHead, SeekHeadEntry, SimpleTag, Tag, TagTargets, Tags, TrackEntry, Tracks, VideoColor, VideoTrack\r\n} from './type'\r\nimport concatTypeArray from 'common/function/concatTypeArray'\r\nimport * as array from 'common/util/array'\r\nimport * as object from 'common/util/object'\r\n\r\nexport function ebmlIdSize(id: EBMLId) {\r\n  return Math.floor((Math.log2(id) + 7) / 8)\r\n}\r\n\r\nexport function ebmlNumSize(value: number | bigint) {\r\n  let bytes = 0\r\n  do {\r\n    bytes++\r\n    // @ts-ignore\r\n  } while (value >>= (is.bigint(value) ? 7n : 7))\r\n\r\n  return bytes\r\n}\r\n\r\nexport function ebmlLengthSize(value: number | bigint) {\r\n  return is.bigint(value) ? ebmlNumSize(value + 1n) : ebmlNumSize(value + 1)\r\n}\r\n\r\nexport function writeEbmlNum(writer: BytesWriterSync, value: number | bigint, bytes: int32) {\r\n  if (is.bigint(value)) {\r\n    value |= (1n << BigInt(bytes * 7))\r\n    for (let i = bytes - 1; i >= 0; i--) {\r\n      writer.writeUint8(Number((value >> BigInt(i * 8)) & 0xffn))\r\n    }\r\n  }\r\n  else {\r\n    value |= (1 << bytes * 7)\r\n    for (let i = bytes - 1; i >= 0; i--) {\r\n      writer.writeUint8((value >> (i * 8)) & 0xff)\r\n    }\r\n  }\r\n}\r\n\r\nexport function writeEbmlId(writer: BytesWriterSync, id: EBMLId) {\r\n  let len = ebmlIdSize(id)\r\n  while (len--) {\r\n    writer.writeUint8(id >> (len * 8))\r\n  }\r\n}\r\n\r\nexport function writeEbmlLength(writer: BytesWriterSync, length:  number | bigint, bytes: int32 = 0) {\r\n  let need = ebmlLengthSize(length)\r\n\r\n  if (bytes === 0) {\r\n    bytes = need\r\n  }\r\n\r\n  writeEbmlNum(writer, length, bytes)\r\n}\r\n\r\nexport function writeEbmlLengthUnknown(writer: BytesWriterSync, bytes: int32) {\r\n  writer.writeUint8(0x1ff >> bytes)\r\n  for (let i = 0; i < bytes - 1; i++) {\r\n    writer.writeUint8(0xff)\r\n  }\r\n}\r\n\r\nexport function writeEbmlUid(writer: IOWriterSync, id: EBMLId, uid: uint64) {\r\n  writeEbmlId(writer, id)\r\n  writeEbmlLength(writer, 8)\r\n  writer.writeUint64(uid)\r\n}\r\n\r\nexport function writeEbmlUint(writer: IOWriterSync, id: EBMLId, value: number | bigint) {\r\n  let bytes = 1\r\n  let tmp = value\r\n\r\n  if (is.bigint(tmp)) {\r\n    while (tmp >>= 8n) {\r\n      bytes++\r\n    }\r\n  }\r\n  else {\r\n    while (tmp >>= 8) {\r\n      bytes++\r\n    }\r\n  }\r\n\r\n  writeEbmlId(writer, id)\r\n  writeEbmlLength(writer, bytes)\r\n  for (let i = bytes - 1; i >= 0; i--) {\r\n    writer.writeUint8(is.bigint(value) ? Number(value >> BigInt(i * 8)) : (value >> i * 8))\r\n  }\r\n}\r\n\r\nexport function writeEbmlSint(writer: IOWriterSync, id: EBMLId, value: number | bigint) {\r\n  let bytes = 0\r\n  if (value) {\r\n    let bitLength = value < 0 ? (~value).toString(2).length : value.toString(2).length\r\n    bytes = Math.ceil((bitLength + 1) / 8)\r\n  }\r\n  writeEbmlId(writer, id)\r\n  writeEbmlLength(writer, bytes)\r\n  switch (bytes) {\r\n    case 0:\r\n      return\r\n    case 1:\r\n      writer.writeInt8(Number(value))\r\n      return\r\n    case 2:\r\n      writer.writeInt16(Number(value))\r\n      return\r\n    case 3:\r\n      writer.writeInt24(Number(value))\r\n      return\r\n    case 4:\r\n      writer.writeInt32(Number(value))\r\n      return\r\n  }\r\n  value = BigInt.asUintN(bytes * 8, BigInt(value))\r\n  for (let i = bytes - 1; i >= 0; i--) {\r\n    writer.writeUint8(Number(value >> BigInt(i * 8)))\r\n  }\r\n}\r\n\r\nexport function writeEbmlFloat(writer: IOWriterSync, id: EBMLId, value: float) {\r\n  writeEbmlId(writer, id)\r\n  writeEbmlLength(writer, 4)\r\n  writer.writeFloat(value)\r\n}\r\n\r\nexport function writeEbmlDouble(writer: IOWriterSync, id: EBMLId, value: double) {\r\n  writeEbmlId(writer, id)\r\n  writeEbmlLength(writer, 8)\r\n  writer.writeDouble(value)\r\n}\r\n\r\nexport function writeEbmlBuffer(writer: IOWriterSync, id: EBMLId, value: Uint8ArrayInterface) {\r\n  writeEbmlId(writer, id)\r\n  writeEbmlLength(writer, value.length)\r\n  writer.writeBuffer(value)\r\n}\r\n\r\nexport function writeEbmlString(writer: IOWriterSync, id: EBMLId, value: string) {\r\n  const buffer = text.encode(value)\r\n  writeEbmlBuffer(writer, id, buffer)\r\n}\r\n\r\nexport function writeEbmlVoid(writer: IOWriterSync, size: int32) {\r\n  writeEbmlId(writer, EBMLId.VOID)\r\n  if (size < 10) {\r\n    size -= 2\r\n    writeEbmlLength(writer, size)\r\n  }\r\n  else {\r\n    size -= 9\r\n    writeEbmlLength(writer, size, 8)\r\n  }\r\n  writer.writeBuffer(new Uint8Array(size).fill(0))\r\n}\r\n\r\nexport function updatePositionSize(ioWriter: IOWriterSync, context: OMatroskaContext) {\r\n  const pos = ioWriter.getPos()\r\n  const pointer = ioWriter.getPointer()\r\n  const minPos = pos - static_cast<int64>(pointer)\r\n\r\n  const seeks: ElePositionInfo[] = []\r\n\r\n  array.each(context.elePositionInfos, (item) => {\r\n    if (item.pos < pos && item.pos >= minPos) {\r\n      ioWriter.seekInline(pointer + Number(item.pos - pos))\r\n      writeEbmlLength(ioWriter, item.length, item.bytes)\r\n    }\r\n    else {\r\n      seeks.push(item)\r\n    }\r\n  })\r\n\r\n  array.each(seeks, (item) => {\r\n    ioWriter.seek(item.pos)\r\n    writeEbmlLength(ioWriter, item.length, item.bytes)\r\n  })\r\n\r\n  if (seeks.length) {\r\n    ioWriter.seek(pos)\r\n  }\r\n  else {\r\n    ioWriter.seekInline(pointer)\r\n  }\r\n  ioWriter.flush()\r\n  context.elePositionInfos = []\r\n}\r\n\r\nexport function writeEleData(writer: IOWriterSync, context: OMatroskaContext, id: EBMLId, data: (eleWriter: IOWriterSync) => void) {\r\n  context.eleWriter.flush()\r\n  const oldCache = context.eleCaches\r\n\r\n  context.eleCaches = []\r\n  data(context.eleWriter)\r\n  context.eleWriter.flush()\r\n  const buffer = concatTypeArray(Uint8Array, context.eleCaches)\r\n\r\n  context.eleCaches = oldCache\r\n  writeEbmlBuffer(writer, id, buffer)\r\n}\r\n\r\nexport function writeHeader(writer: IOWriterSync, context: OMatroskaContext, header: Header) {\r\n  writeEleData(writer, context, EBMLId.HEADER, (eleWriter) => {\r\n    writeEbmlUint(eleWriter, EBMLId.EBML_VERSION, header.version)\r\n    writeEbmlUint(eleWriter, EBMLId.EBML_READ_VERSION, header.readVersion)\r\n    writeEbmlUint(eleWriter, EBMLId.EBML_MAX_ID_LENGTH, header.maxIdLength)\r\n    writeEbmlUint(eleWriter, EBMLId.EBML_MAX_SIZE_LENGTH, header.maxSizeLength)\r\n    writeEbmlString(eleWriter, EBMLId.DOCTYPE, header.docType)\r\n    writeEbmlUint(eleWriter, EBMLId.DOC_TYPE_VERSION, header.docTypeVersion)\r\n    writeEbmlUint(eleWriter, EBMLId.DOC_TYPE_READ_VERSION, header.docTypeReadVersion)\r\n  })\r\n}\r\n\r\nexport function writeSeekHeaderEntry(writer: IOWriterSync, context: OMatroskaContext, entry: SeekHeadEntry) {\r\n  writeEleData(writer, context, EBMLId.SEEK_ENTRY, (eleWriter) => {\r\n    writeEbmlUint(eleWriter, EBMLId.SEEK_ID, entry.id)\r\n    writeEbmlUint(eleWriter, EBMLId.SEEK_POSITION, entry.pos)\r\n  })\r\n}\r\n\r\nexport function writeSeekHeader(writer: IOWriterSync, context: OMatroskaContext, header: SeekHead) {\r\n  writeEleData(writer, context, EBMLId.SEEK_HEAD, (eleWriter) => {\r\n    header.entry.forEach((entry) => {\r\n      writeSeekHeaderEntry(eleWriter, context, entry)\r\n    })\r\n  })\r\n}\r\n\r\nexport function writeInfo(writer: IOWriterSync, context: OMatroskaContext, info: Info) {\r\n  writeEleData(writer, context, EBMLId.INFO, (eleWriter) => {\r\n    writeEbmlUid(eleWriter, EBMLId.SEGMENT_UID, info.segmentUUID)\r\n    writeEbmlUint(eleWriter, EBMLId.TIME_CODE_SCALE, info.timestampScale)\r\n    writeEbmlDouble(eleWriter, EBMLId.DURATION, static_cast<double>(info.duration))\r\n    writeEbmlString(eleWriter, EBMLId.MUXING_APP, info.muxingApp)\r\n    writeEbmlString(eleWriter, EBMLId.WRITING_APP, info.writingApp)\r\n  })\r\n}\r\n\r\nexport function writeVideoColor(writer: IOWriterSync, context: OMatroskaContext, color: VideoColor) {\r\n  writeEleData(writer, context, EBMLId.VIDEO_COLOR, (eleWriter) => {\r\n    if (object.has(color, 'matrixCoefficients')) {\r\n      writeEbmlUint(eleWriter, EBMLId.VIDEO_COLOR_MATRIX_COEFF, color.matrixCoefficients)\r\n    }\r\n    if (object.has(color, 'primaries')) {\r\n      writeEbmlUint(eleWriter, EBMLId.VIDEO_COLOR_PRIMARIES, color.primaries)\r\n    }\r\n    if (object.has(color, 'transferCharacteristics')) {\r\n      writeEbmlUint(eleWriter, EBMLId.VIDEO_COLOR_TRANSFER_CHARACTERISTICS, color.transferCharacteristics)\r\n    }\r\n    if (object.has(color, 'range')) {\r\n      writeEbmlUint(eleWriter, EBMLId.VIDEO_COLOR_RANGE, color.range)\r\n    }\r\n    if (object.has(color, 'chromaSitingVert')) {\r\n      writeEbmlUint(eleWriter, EBMLId.VIDEO_COLOR_CHROMA_SITING_VERT, color.chromaSitingVert)\r\n    }\r\n    if (object.has(color, 'chromaSitingHorz')) {\r\n      writeEbmlUint(eleWriter, EBMLId.VIDEO_COLOR_CHROMA_SITING_HORZ, color.chromaSitingHorz)\r\n    }\r\n  })\r\n}\r\n\r\nexport function writeVideoTrack(writer: IOWriterSync, context: OMatroskaContext, video: VideoTrack) {\r\n  writeEleData(writer, context, EBMLId.TRACK_VIDEO, (eleWriter) => {\r\n    writeEbmlUint(eleWriter, EBMLId.VIDEO_PIXEL_WIDTH, video.pixelWidth)\r\n    writeEbmlUint(eleWriter, EBMLId.VIDEO_PIXEL_HEIGHT, video.pixelHeight)\r\n    if (video.color) {\r\n      writeVideoColor(eleWriter, context, video.color)\r\n    }\r\n  })\r\n}\r\n\r\nexport function writeAudioTrack(writer: IOWriterSync, context: OMatroskaContext, audio: AudioTrack) {\r\n  writeEleData(writer, context, EBMLId.TRACK_AUDIO, (eleWriter) => {\r\n    writeEbmlDouble(eleWriter, EBMLId.AUDIO_SAMPLING_FREQ, reinterpret_cast<double>(audio.sampleRate))\r\n    if (audio.outSampleRate) {\r\n      writeEbmlDouble(eleWriter, EBMLId.AUDIO_SAMPLING_FREQ, reinterpret_cast<double>(audio.outSampleRate))\r\n    }\r\n    writeEbmlUint(eleWriter, EBMLId.AUDIO_BITDEPTH, audio.bitDepth)\r\n    writeEbmlUint(eleWriter, EBMLId.AUDIO_CHANNELS, audio.channels)\r\n  })\r\n}\r\n\r\nexport function writeTrack(writer: IOWriterSync, context: OMatroskaContext, track: TrackEntry) {\r\n  writeEleData(writer, context, EBMLId.TRACK_ENTRY, (eleWriter) => {\r\n    writeEbmlUint(eleWriter, EBMLId.TRACK_NUMBER, track.number)\r\n    writeEbmlUid(eleWriter, EBMLId.TRACK_UID, track.uid)\r\n    writeEbmlUint(eleWriter, EBMLId.TRACK_TYPE, track.type)\r\n    if (track.language) {\r\n      writeEbmlString(eleWriter, EBMLId.TRACK_NAME, track.language)\r\n    }\r\n    if (track.name) {\r\n      writeEbmlString(eleWriter, EBMLId.TRACK_NAME, track.name)\r\n    }\r\n    writeEbmlString(eleWriter, EBMLId.CODEC_ID, track.codecId)\r\n\r\n    if (track.codecPrivate) {\r\n      writeEbmlBuffer(eleWriter, EBMLId.CODEC_PRIVATE, track.codecPrivate.data)\r\n    }\r\n\r\n    if (track.audio) {\r\n      writeAudioTrack(eleWriter, context, track.audio)\r\n    }\r\n    else if (track.video) {\r\n      writeVideoTrack(eleWriter, context, track.video)\r\n    }\r\n  })\r\n}\r\n\r\nexport function writeTracks(writer: IOWriterSync, context: OMatroskaContext, tracks: Tracks) {\r\n  writeEleData(writer, context, EBMLId.TRACKS, (eleWriter) => {\r\n    tracks.entry.forEach((track) => {\r\n      writeTrack(eleWriter, context, track)\r\n    })\r\n  })\r\n}\r\n\r\nexport function writeTagTag(writer: IOWriterSync, context: OMatroskaContext, tag: SimpleTag) {\r\n  writeEleData(writer, context, EBMLId.TAG_SIMPLE, (eleWriter) => {\r\n    if (tag.name) {\r\n      writeEbmlString(eleWriter, EBMLId.TAG_NAME, tag.name)\r\n    }\r\n    if (tag.string) {\r\n      writeEbmlString(eleWriter, EBMLId.TAG_STRING, tag.string)\r\n    }\r\n    if (tag.language) {\r\n      writeEbmlString(eleWriter, EBMLId.TAG_LANG, tag.language)\r\n    }\r\n    if (object.has(tag, 'default')) {\r\n      writeEbmlUint(eleWriter, EBMLId.TAG_DEFAULT, tag.default)\r\n    }\r\n    if (tag.sub) {\r\n      writeTagTag(eleWriter, context, tag.sub)\r\n    }\r\n  })\r\n}\r\n\r\nexport function writeTagTarget(writer: IOWriterSync, context: OMatroskaContext, target: TagTargets) {\r\n  writeEleData(writer, context, EBMLId.TAG_TARGETS, (eleWriter) => {\r\n    if (target.type) {\r\n      writeEbmlString(eleWriter, EBMLId.TAG_TARGETS_TYPE, target.type)\r\n    }\r\n    if (object.has(target, 'typeValue')) {\r\n      writeEbmlUint(eleWriter, EBMLId.TAG_TARGETS_TYPE_VALUE, target.typeValue)\r\n    }\r\n    if (object.has(target, 'trackUid')) {\r\n      writeEbmlUid(eleWriter, EBMLId.TAG_TARGETS_TRACK_UID, target.trackUid)\r\n    }\r\n    if (object.has(target, 'chapterUid')) {\r\n      writeEbmlUid(eleWriter, EBMLId.TAG_TARGETS_CHAPTER_UID, target.chapterUid)\r\n    }\r\n    if (object.has(target, 'attachUid')) {\r\n      writeEbmlUid(eleWriter, EBMLId.TAG_TARGETS_CHAPTER_UID, target.attachUid)\r\n    }\r\n  })\r\n}\r\n\r\nexport function writeTag(writer: IOWriterSync, context: OMatroskaContext, tag: Tag) {\r\n  writeEleData(writer, context, EBMLId.TAG, (eleWriter) => {\r\n    if (tag.tag) {\r\n      writeTagTag(eleWriter, context, tag.tag)\r\n    }\r\n    if (tag.target) {\r\n      writeTagTarget(eleWriter, context, tag.target)\r\n    }\r\n  })\r\n}\r\n\r\nexport function writeTags(writer: IOWriterSync, context: OMatroskaContext, tags: Tags) {\r\n  writeEleData(writer, context, EBMLId.TAGS, (eleWriter) => {\r\n    tags.entry.forEach((tag) => {\r\n      writeTag(eleWriter, context, tag)\r\n    })\r\n  })\r\n}\r\n\r\nexport function writeCuePosition(writer: IOWriterSync, context: OMatroskaContext, pos: CuePointPos) {\r\n  writeEleData(writer, context, EBMLId.CUE_TRACK_POSITION, (eleWriter) => {\r\n    writeEbmlUint(eleWriter, EBMLId.CUE_TRACK, pos.track)\r\n    writeEbmlUint(eleWriter, EBMLId.CUE_CLUSTER_POSITION, pos.pos)\r\n  })\r\n}\r\n\r\nexport function writeCue(writer: IOWriterSync, context: OMatroskaContext, cue: CuePoint) {\r\n  writeEleData(writer, context, EBMLId.POINT_ENTRY, (eleWriter) => {\r\n    writeEbmlUint(eleWriter, EBMLId.CUE_TIME, cue.time)\r\n    cue.pos.forEach((p) => {\r\n      writeCuePosition(eleWriter, context, p)\r\n    })\r\n  })\r\n}\r\n\r\nexport function writeCues(writer: IOWriterSync, context: OMatroskaContext, cues: Cues) {\r\n  writeEleData(writer, context, EBMLId.CUES, (eleWriter) => {\r\n    cues.entry.forEach((cue) => {\r\n      writeCue(eleWriter, context, cue)\r\n    })\r\n  })\r\n}\r\n\r\nexport function writeChapterAtomDisplay(writer: IOWriterSync, context: OMatroskaContext, display: ChapterDisplay) {\r\n  writeEleData(writer, context, EBMLId.CHAPTER_DISPLAY, (eleWriter) => {\r\n    writeEbmlString(eleWriter, EBMLId.CHAP_STRING, display.title)\r\n    writeEbmlString(eleWriter, EBMLId.CHAP_LANG, display.language)\r\n  })\r\n}\r\n\r\nexport function writeChapterAtom(writer: IOWriterSync, context: OMatroskaContext, atom: ChapterAtom) {\r\n  writeEleData(writer, context, EBMLId.CHAPTER_ATOM, (eleWriter) => {\r\n    writeEbmlUint(eleWriter, EBMLId.CHAPTER_TIME_START, atom.start)\r\n    writeEbmlUint(eleWriter, EBMLId.CHAPTER_TIME_END, atom.end)\r\n    writeEbmlUid(eleWriter, EBMLId.CHAPTER_UID, atom.uid)\r\n    if (atom.display) {\r\n      writeChapterAtomDisplay(eleWriter, context, atom.display)\r\n    }\r\n  })\r\n}\r\n\r\nexport function writeChapter(writer: IOWriterSync, context: OMatroskaContext, chapter: Chapter) {\r\n  writeEleData(writer, context, EBMLId.EDITION_ENTRY, (eleWriter) => {\r\n    array.each(chapter.atom, (item) => {\r\n      writeChapterAtom(eleWriter, context, item)\r\n    })\r\n  })\r\n}\r\n\r\nexport function writeChapters(writer: IOWriterSync, context: OMatroskaContext, chapters: Chapters) {\r\n  writeEleData(writer, context, EBMLId.CHAPTERS, (eleWriter) => {\r\n    chapters.entry.forEach((chapter) => {\r\n      writeChapter(eleWriter, context, chapter)\r\n    })\r\n  })\r\n}\r\n\r\nexport function writeAttachment(writer: IOWriterSync, context: OMatroskaContext, attachment: Attachment) {\r\n\r\n  writeEbmlId(writer, EBMLId.ATTACHED_FILE)\r\n\r\n  const info: ElePositionInfo = {\r\n    pos: writer.getPos(),\r\n    length: 0,\r\n    bytes: 8\r\n  }\r\n  writeEbmlLength(writer, 0, 8)\r\n\r\n  const now = writer.getPos()\r\n  writeEbmlUid(writer, EBMLId.FILE_UID, attachment.uid)\r\n  writeEbmlString(writer, EBMLId.FILE_NAME, attachment.name)\r\n  writeEbmlString(writer, EBMLId.FILE_MIMETYPE, attachment.mime)\r\n  if (attachment.description) {\r\n    writeEbmlString(writer, EBMLId.FILE_DESC, attachment.description)\r\n  }\r\n  if (attachment.data) {\r\n    writeEbmlBuffer(writer, EBMLId.FILE_DATA, attachment.data.data)\r\n  }\r\n  info.length = writer.getPos() - now\r\n  context.elePositionInfos.push(info)\r\n}\r\n\r\nexport function writeAttachments(writer: IOWriterSync, context: OMatroskaContext, attachments: Attachments) {\r\n  const old = context.elePositionInfos\r\n  context.elePositionInfos = []\r\n\r\n  writeEbmlId(writer, EBMLId.ATTACHMENTS)\r\n\r\n  const info: ElePositionInfo = {\r\n    pos: writer.getPos(),\r\n    length: 0,\r\n    bytes: 8\r\n  }\r\n  writeEbmlLength(writer, 0, 8)\r\n\r\n  const now = writer.getPos()\r\n  attachments.entry.forEach((attachment) => {\r\n    writeAttachment(writer, context, attachment)\r\n  })\r\n\r\n  info.length = writer.getPos() - now\r\n  context.elePositionInfos.push(info)\r\n\r\n  updatePositionSize(writer, context)\r\n\r\n  context.elePositionInfos = old\r\n}\r\n","/*\r\n * libmedia vvc util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport * as array from 'common/util/array'\r\nimport AVPacket, { AVPacketFlags } from '../struct/avpacket'\r\nimport BufferWriter from 'common/io/BufferWriter'\r\nimport BufferReader from 'common/io/BufferReader'\r\nimport { AVPacketSideDataType } from '../codec'\r\nimport BitReader from 'common/io/BitReader'\r\nimport AVStream from '../AVStream'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\nimport * as naluUtil from '../util/nalu'\r\nimport { avMalloc } from '../util/mem'\r\nimport * as expgolomb from '../util/expgolomb'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport BitWriter from 'common/io/BitWriter'\r\nimport { Data } from 'common/types/type'\r\nimport * as intread from '../util/intread'\r\nimport * as intwrite from '../util/intwrite'\r\nimport { AVPixelFormat } from '../pixfmt'\r\n\r\nconst NALULengthSizeMinusOne = 3\r\n\r\nexport const enum VVCNaluType {\r\n  kTRAIL_NUT      = 0,\r\n  kSTSA_NUT       = 1,\r\n  kRADL_NUT       = 2,\r\n  kRASL_NUT       = 3,\r\n  kRSV_VCL_4      = 4,\r\n  kRSV_VCL_5      = 5,\r\n  kRSV_VCL_6      = 6,\r\n  kIDR_W_RADL     = 7,\r\n  kIDR_N_LP       = 8,\r\n  kCRA_NUT        = 9,\r\n  kGDR_NUT        = 10,\r\n  kRSV_IRAP_11    = 11,\r\n  kOPI_NUT        = 12,\r\n  kDCI_NUT        = 13,\r\n  kVPS_NUT        = 14,\r\n  kSPS_NUT        = 15,\r\n  kPPS_NUT        = 16,\r\n  kPREFIX_APS_NUT = 17,\r\n  kSUFFIX_APS_NUT = 18,\r\n  kPH_NUT         = 19,\r\n  kAUD_NUT        = 20,\r\n  kEOS_NUT        = 21,\r\n  kEOB_NUT        = 22,\r\n  kPREFIX_SEI_NUT = 23,\r\n  kSUFFIX_SEI_NUT = 24,\r\n  kFD_NUT         = 25,\r\n  kRSV_NVCL_26    = 26,\r\n  kRSV_NVCL_27    = 27,\r\n  kUNSPEC_28      = 28,\r\n  kUNSPEC_29      = 29,\r\n  kUNSPEC_30      = 30,\r\n  kUNSPEC_31      = 31,\r\n}\r\n\r\nexport const enum VVCSliceType {\r\n  kSliceNone = -1,\r\n  kSliceB = 0,\r\n  kSliceP = 1,\r\n  kSliceI = 2\r\n}\r\n\r\nexport const enum VVCAPSType {\r\n  kALF     = 0,\r\n  kLMCS    = 1,\r\n  kSCALING = 2\r\n}\r\n\r\n/* eslint-disable camelcase */\r\nfunction parsePTL(bitReader: BitReader) {\r\n  const olsIdx = bitReader.readU(9)\r\n  const numSublayers = bitReader.readU(3)\r\n  const constantFrameRate = bitReader.readU(2)\r\n  const chromaFormatIdc = bitReader.readU(2)\r\n  const bitDepthMinus8 = bitReader.readU(3)\r\n  bitReader.readU(5)\r\n\r\n  // VvcPTLRecord\r\n  bitReader.readU(2)\r\n  const num_bytes_constraint_info = bitReader.readU(6)\r\n  const generalProfileIdc = bitReader.readU(7)\r\n  const generalTierFlag = bitReader.readU(1)\r\n  const generalLevelIdc = bitReader.readU(8)\r\n  const ptlFrameOnlyConstraintFlag = bitReader.readU(1)\r\n  const ptlMultilayerEnabledFlag = bitReader.readU(1)\r\n  const generalConstraintInfo = []\r\n  const sublayerLevelIdc = []\r\n\r\n  if (num_bytes_constraint_info) {\r\n    for (let i = 0; i < num_bytes_constraint_info - 1; i++) {\r\n      generalConstraintInfo[i] = bitReader.readU(8)\r\n    }\r\n    generalConstraintInfo[num_bytes_constraint_info - 1] = bitReader.readU(6)\r\n  }\r\n  else {\r\n    bitReader.readU(6)\r\n  }\r\n  if (numSublayers > 1) {\r\n    let ptl_sublayer_present_mask = 0\r\n    for (let j = numSublayers - 2; j >= 0; --j) {\r\n      const val = bitReader.readU(1)\r\n      ptl_sublayer_present_mask |= val << j\r\n    }\r\n    for (let j = numSublayers; j <= 8 && numSublayers > 1; ++j) {\r\n      bitReader.readU(1)\r\n    }\r\n\r\n    for (let j = numSublayers - 2; j >= 0; --j) {\r\n      if (ptl_sublayer_present_mask & (1 << j)) {\r\n        sublayerLevelIdc[j] = bitReader.readU(8)\r\n      }\r\n    }\r\n  }\r\n  const ptl_num_sub_profiles = bitReader.readU(8)\r\n  const generalSubProfileIdc = []\r\n  if (ptl_num_sub_profiles) {\r\n    for (let i = 0; i < ptl_num_sub_profiles; i++) {\r\n      generalSubProfileIdc.push(bitReader.readU(8))\r\n    }\r\n  }\r\n\r\n  const maxPictureWidth = bitReader.readU(16)\r\n  const maxPictureHeight = bitReader.readU(16)\r\n  const avgFramerate = bitReader.readU(16)\r\n\r\n  return {\r\n    olsIdx,\r\n    numSublayers,\r\n    bitDepthMinus8,\r\n    chromaFormatIdc,\r\n    constantFrameRate,\r\n    generalProfileIdc,\r\n    generalTierFlag,\r\n    generalLevelIdc,\r\n    ptlFrameOnlyConstraintFlag,\r\n    ptlMultilayerEnabledFlag,\r\n    generalConstraintInfo,\r\n    sublayerLevelIdc,\r\n    generalSubProfileIdc,\r\n    maxPictureWidth,\r\n    maxPictureHeight,\r\n    avgFramerate\r\n  }\r\n}\r\n/* eslint-enable camelcase */\r\n\r\n/**\r\n * \r\n * vvcc 格式的 extradata 转 annexb vps sps pps\r\n * \r\n * bits    \r\n * - 5   reserved (11111)\r\n * - 2   lengthSizeMinusOne\r\n * - 1   ptl_present_flag\r\n * if ptl_present_flag\r\n *   - 9   ols_idx\r\n *   - 3  num_sublayers\r\n *   - 2  constant_frame_rate\r\n *   - 2  chroma_format_idc\r\n *   - 3  bit_depth_minus8\r\n *   - 5  reserved (11111)\r\n *   VvcPTLRecord\r\n *   - 2 reserved (11)\r\n *   - 6 num_bytes_constraint_info\r\n *   - 7 general_profile_idc\r\n *   - 1 general_tier_flag\r\n *   - 8 general_level_idc\r\n *   - 1 general_level_idc\r\n *   - 1 ptl_multilayer_enabled_flag\r\n *   if num_bytes_constraint_info > 0\r\n *      for (i = 0; i < num_bytes_constraint_info - 1; i++)\r\n *        - 8 general_constraint_info[i]\r\n *      - 6 general_constraint_info[num_bytes_constraint_info - 1]\r\n *   else\r\n *      - 6 reserved\r\n *   if num_sublayers > 1\r\n *      - num_sublayers - 2 ptl_sublayer_level_present_flag\r\n *      - 8 - num_sublayers + 1 ptl_reserved_zero_bit\r\n *      for (i = num_sublayers -2; i >= 0; i--)\r\n *        if ptl_sublayer_present_mask & (1 << i)\r\n *          - 8 sublayer_level_idc[i]\r\n *    - 8 ptl_num_sub_profiles\r\n *    if ptl_num_sub_profiles\r\n *      for (i = 0; i < ptl_num_sub_profiles; i++)\r\n *        - 32 general_sub_profile_idc[i]\r\n *    - 16 max_picture_width\r\n *    - 16 max_picture_height\r\n *    - 16 avg_frame_rate\r\n * - 8   numOfArrays\r\n * - repeated of array (vps/sps/pps)\r\n * - 1   array_completeness\r\n * - 2   reserved (0)\r\n * - 5   NAL_unit_type\r\n * if nalu_type != VVC_NALU_DEC_PARAM && nalu_type != VVC_NALU_OPI\r\n *    - 16  numNalus\r\n * else\r\n *   numNalus = 1\r\n * - repeated once per NAL\r\n * - 16  nalUnitLength\r\n * - N   NALU data\r\n * \r\n */\r\nexport function extradata2VpsSpsPps(extradata: Uint8ArrayInterface) {\r\n\r\n  const bufferReader = new BufferReader(extradata, true)\r\n\r\n  const ptlPresentFlag = bufferReader.readUint8() & 0x01\r\n\r\n  if (ptlPresentFlag) {\r\n    const bitReader = new BitReader()\r\n    bitReader.appendBuffer(extradata.subarray(1))\r\n    parsePTL(bitReader)\r\n    bufferReader.skip(bitReader.getPointer())\r\n  }\r\n\r\n  let vpss: Uint8ArrayInterface[] = []\r\n  let spss: Uint8ArrayInterface[] = []\r\n  let ppss: Uint8ArrayInterface[] = []\r\n\r\n  const arrayLen = bufferReader.readUint8()\r\n\r\n  for (let i = 0; i < arrayLen; i++) {\r\n    const naluType = bufferReader.readUint8() & 0x1f\r\n    let count = 1\r\n\r\n    if (naluType !== VVCNaluType.kDCI_NUT && naluType !== VVCNaluType.kOPI_NUT) {\r\n      count = bufferReader.readUint16()\r\n    }\r\n    const list = []\r\n\r\n    for (let j = 0; j < count; j++) {\r\n      const len = bufferReader.readUint16()\r\n      list.push(bufferReader.readBuffer(len))\r\n    }\r\n\r\n    if (naluType === VVCNaluType.kVPS_NUT) {\r\n      vpss = list\r\n    }\r\n    else if (naluType === VVCNaluType.kSPS_NUT) {\r\n      spss = list\r\n    }\r\n    else if (naluType === VVCNaluType.kPPS_NUT) {\r\n      ppss = list\r\n    }\r\n  }\r\n\r\n  return {\r\n    vpss,\r\n    spss,\r\n    ppss\r\n  }\r\n}\r\n\r\n/**\r\n * annexb vps sps pps 转 avcc 格式的 extradata\r\n * \r\n * @param vpss \r\n * @param spss \r\n * @param ppss \r\n * @returns \r\n */\r\nexport function vpsSpsPps2Extradata(vpss: Uint8ArrayInterface[], spss: Uint8ArrayInterface[], ppss: Uint8ArrayInterface[]) {\r\n\r\n  const sps = spss[0]\r\n  let ptl: Uint8Array\r\n  if (sps) {\r\n    const spsParams = parseSPS(sps)\r\n    let generalConstraintInfo = spsParams.generalConstraintInfo\r\n    if (!generalConstraintInfo.length) {\r\n      generalConstraintInfo = new Array(12).fill(0)\r\n    }\r\n    const biWriter = new BitWriter()\r\n    biWriter.writeU(9, 0)\r\n    biWriter.writeU(3, spsParams.spsMaxSublayersMinus1 + 1)\r\n    biWriter.writeU(2, 1)\r\n    biWriter.writeU(2, spsParams.chromaFormatIdc)\r\n    biWriter.writeU(3, spsParams.bitDepthMinus8)\r\n    biWriter.writeU(5, 0b11111)\r\n    biWriter.writeU(2, 0)\r\n    biWriter.writeU(6, generalConstraintInfo.length)\r\n    biWriter.writeU(7, spsParams.profile)\r\n    biWriter.writeU1(spsParams.tierFlag)\r\n    biWriter.writeU(8, spsParams.level)\r\n    biWriter.writeU1(spsParams.ptlFrameOnlyConstraintFlag)\r\n    biWriter.writeU1(spsParams.ptlMultilayerEnabledFlag)\r\n\r\n    if (generalConstraintInfo.length) {\r\n      for (let i = 0; i < generalConstraintInfo.length - 1; i++) {\r\n        biWriter.writeU(8, generalConstraintInfo[i])\r\n      }\r\n      biWriter.writeU(6, generalConstraintInfo[generalConstraintInfo.length - 1])\r\n    }\r\n    else {\r\n      biWriter.writeU(6, 0b111111)\r\n    }\r\n\r\n    if (spsParams.spsMaxSublayersMinus1 + 1 > 1) {\r\n      let ptlSubLayerLevelPresentFlags = 0\r\n      for (let i = spsParams.spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n        ptlSubLayerLevelPresentFlags = (ptlSubLayerLevelPresentFlags << 1 | spsParams.ptlSublayerLevelPresentFlag[i])\r\n      }\r\n      biWriter.writeU(spsParams.spsMaxSublayersMinus1, ptlSubLayerLevelPresentFlags)\r\n\r\n      for (let j = spsParams.spsMaxSublayersMinus1 + 1; j <= 8 && spsParams.spsMaxSublayersMinus1 > 0; ++j) {\r\n        biWriter.writeU1(0)\r\n      }\r\n      for (let i = spsParams.spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n        if (spsParams.ptlSublayerLevelPresentFlag[i]) {\r\n          biWriter.writeU(8, spsParams.sublayerLevelIdc[i])\r\n        }\r\n      }\r\n    }\r\n    biWriter.writeU(8, spsParams.generalSubProfileIdc.length)\r\n    for (let i = 0; i < spsParams.generalSubProfileIdc.length; i++) {\r\n      biWriter.writeU(8, spsParams.sublayerLevelIdc[i])\r\n    }\r\n    biWriter.writeU(16, spsParams.width)\r\n    biWriter.writeU(16, spsParams.height)\r\n    biWriter.writeU(16, 0)\r\n    biWriter.padding()\r\n    ptl = biWriter.getBuffer().subarray(0, biWriter.getPointer())\r\n  }\r\n\r\n  let length = 2 + (ptl ? ptl.length : 0)\r\n\r\n  if (vpss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = vpss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  if (spss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = spss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  if (ppss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = ppss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  const buffer = new Uint8Array(length)\r\n  const bufferWriter = new BufferWriter(buffer, true)\r\n\r\n  bufferWriter.writeUint8(NALULengthSizeMinusOne << 1 | (ptl ? 1 : 0) | 0xf8)\r\n\r\n  if (ptl) {\r\n    bufferWriter.writeBuffer(ptl)\r\n  }\r\n\r\n  // numOfArrays\r\n  let numOfArrays = 0\r\n  if (vpss.length) {\r\n    numOfArrays++\r\n  }\r\n  if (spss.length) {\r\n    numOfArrays++\r\n  }\r\n  if (ppss.length) {\r\n    numOfArrays++\r\n  }\r\n  bufferWriter.writeUint8(numOfArrays)\r\n\r\n  // vps\r\n  if (vpss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | VVCNaluType.kVPS_NUT)\r\n    bufferWriter.writeUint16(vpss.length)\r\n    array.each(vpss, (vps) => {\r\n      bufferWriter.writeUint16(vps.length)\r\n      bufferWriter.writeBuffer(vps)\r\n    })\r\n  }\r\n\r\n  // sps\r\n  if (spss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | VVCNaluType.kSPS_NUT)\r\n    bufferWriter.writeUint16(spss.length)\r\n    array.each(spss, (sps) => {\r\n      bufferWriter.writeUint16(sps.length)\r\n      bufferWriter.writeBuffer(sps)\r\n    })\r\n  }\r\n\r\n  // pps\r\n  if (ppss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | VVCNaluType.kPPS_NUT)\r\n    bufferWriter.writeUint16(ppss.length)\r\n    array.each(ppss, (pps) => {\r\n      bufferWriter.writeUint16(pps.length)\r\n      bufferWriter.writeBuffer(pps)\r\n    })\r\n  }\r\n\r\n  return buffer\r\n}\r\n\r\n/**\r\n * annexb extradata 转 avcc extradata\r\n * \r\n * @param data \r\n * @returns \r\n */\r\nexport function annexbExtradata2AvccExtradata(data: Uint8ArrayInterface) {\r\n  let nalus = naluUtil.splitNaluByStartCode(data)\r\n\r\n  if (nalus.length >= 2) {\r\n    const vpss: Uint8ArrayInterface[] = []\r\n    const spss: Uint8ArrayInterface[] = []\r\n    const ppss: Uint8ArrayInterface[] = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kVPS_NUT) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kSPS_NUT) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kPPS_NUT) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      return vpsSpsPps2Extradata(vpss, spss, ppss)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 从 annexb 码流里面生成 annexb extradata\r\n * \r\n * 提取出 vps、 sps 和 pps\r\n * \r\n * @param data \r\n * @returns \r\n */\r\nexport function generateAnnexbExtradata(data: Uint8ArrayInterface) {\r\n  let nalus = naluUtil.splitNaluByStartCode(data)\r\n\r\n  if (nalus.length >= 2) {\r\n    const vpss: Uint8ArrayInterface[] = []\r\n    const spss: Uint8ArrayInterface[] = []\r\n    const ppss: Uint8ArrayInterface[] = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kVPS_NUT) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kSPS_NUT) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kPPS_NUT) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      const nalus = [spss[0], ppss[0]]\r\n      if (vpss.length) {\r\n        nalus.unshift(vpss[0])\r\n      }\r\n      return naluUtil.joinNaluByStartCode(nalus, 0)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * annexb 格式的 NALU 转 avcc NALU \r\n * \r\n * 需要保证 data 是 safe 的\r\n * \r\n */\r\nexport function annexb2Avcc(data: Uint8ArrayInterface, reverseSps: boolean = false) {\r\n  let extradata: Uint8Array\r\n  let key: boolean = false\r\n\r\n  let nalus = naluUtil.splitNaluByStartCode(data)\r\n\r\n  if (nalus.length) {\r\n    const vpss: Uint8ArrayInterface[] = []\r\n    const spss: Uint8ArrayInterface[] = []\r\n    const ppss: Uint8ArrayInterface[] = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kVPS_NUT) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kSPS_NUT) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kPPS_NUT) {\r\n        ppss.push(nalu)\r\n      }\r\n      if (type === VVCNaluType.kIDR_N_LP\r\n        || type === VVCNaluType.kIDR_W_RADL\r\n        || type === VVCNaluType.kCRA_NUT\r\n        || type === VVCNaluType.kGDR_NUT\r\n      ) {\r\n        key = true\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      extradata = vpsSpsPps2Extradata(vpss, spss, ppss)\r\n      nalus = nalus.filter((nalu) => {\r\n        const type = (nalu[1] >>> 3) & 0x1f\r\n        return reverseSps\r\n          ? type !== VVCNaluType.kAUD_NUT\r\n          : (type !== VVCNaluType.kVPS_NUT\r\n            && type !== VVCNaluType.kSPS_NUT\r\n            && type !== VVCNaluType.kPPS_NUT\r\n            && type !== VVCNaluType.kAUD_NUT)\r\n      })\r\n    }\r\n    else {\r\n      nalus = nalus.filter((nalu) => {\r\n        const type = (nalu[1] >>> 3) & 0x1f\r\n        return type !== VVCNaluType.kAUD_NUT\r\n      })\r\n    }\r\n  }\r\n\r\n  const length = nalus.reduce((prev, nalu) => {\r\n    return prev + NALULengthSizeMinusOne + 1 + nalu.length\r\n  }, 0)\r\n\r\n  const bufferPointer: pointer<uint8> = avMalloc(length)\r\n  const buffer = mapUint8Array(bufferPointer, length)\r\n\r\n  naluUtil.joinNaluByLength(nalus, NALULengthSizeMinusOne, buffer)\r\n\r\n  return {\r\n    bufferPointer,\r\n    length,\r\n    extradata,\r\n    key\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * 需要保证 data 是 safe 的\r\n * \r\n * @param vpss \r\n * @param spss \r\n * @param ppss \r\n * @param nalus \r\n * @returns \r\n */\r\nexport function nalus2Annexb(\r\n  vpss: Uint8ArrayInterface[],\r\n  spss: Uint8ArrayInterface[],\r\n  ppss: Uint8ArrayInterface[],\r\n  nalus: Uint8ArrayInterface[],\r\n  key: boolean\r\n) {\r\n  const lengths = [\r\n    naluUtil.joinNaluByStartCodeLength(vpss, 0),\r\n    naluUtil.joinNaluByStartCodeLength(spss, 0),\r\n    naluUtil.joinNaluByStartCodeLength(ppss, 0),\r\n    naluUtil.joinNaluByStartCodeLength(nalus, 2)\r\n  ]\r\n\r\n  let length = lengths.reduce((prev, length) => {\r\n    return prev + length\r\n  }, 0)\r\n\r\n  const bufferPointer: pointer<uint8> = avMalloc(length + 7)\r\n\r\n  let offset = bufferPointer\r\n\r\n  // AUD\r\n  intwrite.w8(offset++, 0)\r\n  intwrite.w8(offset++, 0)\r\n  intwrite.w8(offset++, 0)\r\n  intwrite.w8(offset++, 1)\r\n  intwrite.w8(offset++, 0)\r\n  intwrite.w8(offset++, (VVCNaluType.kAUD_NUT << 3) | 1)\r\n  intwrite.w8(offset++, (key ? 1 : 0) << 7 | 0x28)\r\n\r\n  if (vpss.length) {\r\n    naluUtil.joinNaluByStartCode(vpss, 0, mapUint8Array(offset, lengths[0]))\r\n    offset = reinterpret_cast<pointer<uint8>>(offset + lengths[0])\r\n  }\r\n  if (spss.length) {\r\n    naluUtil.joinNaluByStartCode(spss, 0, mapUint8Array(offset, lengths[1]))\r\n    offset = reinterpret_cast<pointer<uint8>>(offset + lengths[1])\r\n  }\r\n  if (ppss.length) {\r\n    naluUtil.joinNaluByStartCode(ppss, 0, mapUint8Array(offset, lengths[2]))\r\n    offset = reinterpret_cast<pointer<uint8>>(offset + lengths[2])\r\n  }\r\n  if (nalus.length) {\r\n    naluUtil.joinNaluByStartCode(nalus, 2, mapUint8Array(offset, lengths[3]))\r\n  }\r\n\r\n  return {\r\n    bufferPointer,\r\n    length: length + 7\r\n  }\r\n}\r\n\r\n/**\r\n * annexb 添加 sps pps\r\n * \r\n * @param data \r\n * @param extradata \r\n */\r\nexport function annexbAddExtradata(data: Uint8ArrayInterface, extradata: Uint8ArrayInterface) {\r\n  let nalus = naluUtil.splitNaluByStartCode(data).concat(naluUtil.splitNaluByStartCode(extradata))\r\n  if (nalus.length) {\r\n    let vpss: Uint8ArrayInterface[] = []\r\n    let spss: Uint8ArrayInterface[] = []\r\n    let ppss: Uint8ArrayInterface[] = []\r\n    let others: Uint8ArrayInterface[] = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kVPS_NUT) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kSPS_NUT) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kPPS_NUT) {\r\n        ppss.push(nalu)\r\n      }\r\n      else if (type !== VVCNaluType.kAUD_NUT) {\r\n        others.push(nalu)\r\n      }\r\n    })\r\n    return nalus2Annexb(vpss, spss, ppss, others, true)\r\n  }\r\n}\r\n\r\n/**\r\n * avcc 格式的 NALU 转 annexb NALU \r\n * \r\n * 需要保证 data 是 safe 的\r\n * \r\n */\r\nexport function avcc2Annexb(data: Uint8ArrayInterface, extradata?: Uint8ArrayInterface) {\r\n  const naluLengthSizeMinusOne = extradata ? ((extradata[0] >>> 1) & 0x03) : NALULengthSizeMinusOne\r\n\r\n  let vpss: Uint8ArrayInterface[] = []\r\n  let spss: Uint8ArrayInterface[] = []\r\n  let ppss: Uint8ArrayInterface[] = []\r\n  let key = false\r\n\r\n  if (extradata) {\r\n    const result = extradata2VpsSpsPps(extradata)\r\n    vpss = result.vpss\r\n    spss = result.spss\r\n    ppss = result.ppss\r\n    key = true\r\n  }\r\n\r\n  const nalus = naluUtil.splitNaluByLength(data, naluLengthSizeMinusOne).filter((nalu) => {\r\n    const type = (nalu[1] >>> 3) & 0x1f\r\n    return type !== VVCNaluType.kAUD_NUT\r\n  })\r\n\r\n  return {\r\n    ...nalus2Annexb(vpss, spss, ppss, nalus, key),\r\n    key\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParametersBySps(stream: AVStream, sps: Uint8ArrayInterface) {\r\n  const { profile, level, width, height, videoDelay, chromaFormatIdc, bitDepthMinus8 } = parseSPS(sps)\r\n  stream.codecpar.profile = profile\r\n  stream.codecpar.level = level\r\n  stream.codecpar.width = width\r\n  stream.codecpar.height = height\r\n  stream.codecpar.videoDelay = videoDelay\r\n\r\n  switch (bitDepthMinus8) {\r\n    case 0:\r\n      if (chromaFormatIdc === 3) {\r\n        stream.codecpar.format = AVPixelFormat.AV_PIX_FMT_YUV444P\r\n      }\r\n      else if (chromaFormatIdc === 2) {\r\n        stream.codecpar.format = AVPixelFormat.AV_PIX_FMT_YUV422P\r\n      }\r\n      else {\r\n        stream.codecpar.format = AVPixelFormat.AV_PIX_FMT_YUV420P\r\n      }\r\n      break\r\n    case 2:\r\n      if (chromaFormatIdc === 3) {\r\n        stream.codecpar.format = AVPixelFormat.AV_PIX_FMT_YUV444P10LE\r\n      }\r\n      else if (chromaFormatIdc === 2) {\r\n        stream.codecpar.format = AVPixelFormat.AV_PIX_FMT_YUV422P10LE\r\n      }\r\n      else {\r\n        stream.codecpar.format = AVPixelFormat.AV_PIX_FMT_YUV420P10LE\r\n      }\r\n      break\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  let sps: Uint8ArrayInterface\r\n  if (extradata && naluUtil.isAnnexb(extradata)) {\r\n    array.each(naluUtil.splitNaluByStartCode(extradata), (nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kSPS_NUT) {\r\n        sps = nalu\r\n        return false\r\n      }\r\n    })\r\n  }\r\n  else if (extradata && extradata.length >= 6) {\r\n\r\n    stream.metadata.naluLengthSizeMinusOne = (extradata[0] >>> 1) & 0x03\r\n\r\n    const { spss } = extradata2VpsSpsPps(extradata)\r\n\r\n    if (spss.length) {\r\n      sps = spss[0]\r\n    }\r\n  }\r\n  if (sps) {\r\n    parseAVCodecParametersBySps(stream, sps)\r\n  }\r\n}\r\n\r\nexport function isIDR(avpacket: pointer<AVPacket>, naluLengthSize: int32 = 4) {\r\n  if (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_H26X_ANNEXB) {\r\n    let nalus = naluUtil.splitNaluByStartCode(mapUint8Array(avpacket.data, reinterpret_cast<size>(avpacket.size)))\r\n    return nalus.some((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      return type === VVCNaluType.kIDR_N_LP || type === VVCNaluType.kIDR_W_RADL\r\n    })\r\n  }\r\n  else {\r\n    const size = avpacket.size\r\n    let i = 0\r\n    while (i < (size - naluLengthSize)) {\r\n      const type = (intread.r8(avpacket.data + (i + naluLengthSize + 1)) >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kIDR_N_LP || type === VVCNaluType.kIDR_W_RADL) {\r\n        return true\r\n      }\r\n      if (naluLengthSize === 4) {\r\n        i += intread.rb32(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 3) {\r\n        i += intread.rb24(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 2) {\r\n        i += intread.rb16(avpacket.data + i)\r\n      }\r\n      else {\r\n        i += intread.r8(avpacket.data + i)\r\n      }\r\n      i += naluLengthSize\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\n/* eslint-disable camelcase */\r\nexport interface VvcSPS {\r\n  profile: number\r\n  level: number\r\n  width: number\r\n  height: number\r\n  videoDelay: number\r\n  chromaFormatIdc: number\r\n  bitDepthMinus8: number\r\n  generalProfileSpace: number\r\n  tierFlag: number\r\n  generalConstraintInfo: number[]\r\n  generalSubProfileIdc: number[]\r\n  ptlFrameOnlyConstraintFlag: number\r\n  ptlMultilayerEnabledFlag: number\r\n  spsMaxSublayersMinus1: number\r\n  ptlSublayerLevelPresentFlag: number[]\r\n  sublayerLevelIdc: number[]\r\n  sps_log2_max_pic_order_cnt_lsb_minus4: number\r\n  sps_poc_msb_cycle_flag: number\r\n  sps_poc_msb_cycle_len_minus1: number\r\n  sps_num_extra_ph_bytes: number\r\n  sps_extra_ph_bit_present_flag: number[]\r\n}\r\n\r\nexport function parseSPS(sps: Uint8ArrayInterface): VvcSPS {\r\n  if (!sps || sps.length < 3) {\r\n    return\r\n  }\r\n\r\n  let offset = 0\r\n  if (sps[0] === 0x00\r\n    && sps[1] === 0x00\r\n    && sps[2] === 0x00\r\n    && sps[3] === 0x01\r\n  ) {\r\n    offset = 4\r\n  }\r\n\r\n  let profile = 0\r\n  let level = 0\r\n  let width = 0\r\n  let height = 0\r\n  let bitDepthMinus8 = 0\r\n  let chromaFormatIdc = 1\r\n  let generalProfileSpace = 0\r\n  let tierFlag = 0\r\n  let ptlFrameOnlyConstraintFlag = 0\r\n  let ptlMultilayerEnabledFlag = 0\r\n\r\n  const generalConstraintInfo = []\r\n  const ptlSublayerLevelPresentFlag = []\r\n  const sublayerLevelIdc = []\r\n  const generalSubProfileIdc = []\r\n\r\n  const buffer = naluUtil.naluUnescape(sps.subarray(offset))\r\n  const bitReader = new BitReader(buffer.length)\r\n  bitReader.appendBuffer(buffer)\r\n\r\n  // forbidden_zero_bit\r\n  bitReader.readU1()\r\n  // nuh_reserved_zero_bit\r\n  bitReader.readU1()\r\n  // layerId\r\n  bitReader.readU(6)\r\n  // nalu type\r\n  bitReader.readU(5)\r\n  // tid\r\n  bitReader.readU(3)\r\n\r\n  // sps_seq_parameter_set_id && sps_video_parameter_set_id\r\n  bitReader.readU(8)\r\n\r\n  const spsMaxSublayersMinus1 = bitReader.readU(3)\r\n  chromaFormatIdc = bitReader.readU(2)\r\n  const sps_log2_ctu_size_minus5 = bitReader.readU(2)\r\n  const sps_ptl_dpb_hrd_params_present_flag = bitReader.readU(1)\r\n  if (sps_ptl_dpb_hrd_params_present_flag) {\r\n    profile = bitReader.readU(7)\r\n    tierFlag = bitReader.readU(1)\r\n    level = bitReader.readU(8)\r\n    ptlFrameOnlyConstraintFlag = bitReader.readU(1)\r\n    ptlMultilayerEnabledFlag = bitReader.readU(1)\r\n    const gci_present_flag = bitReader.readU(1)\r\n    if (gci_present_flag) {\r\n      for (let j = 0; j < 8; j++) {\r\n        generalConstraintInfo[j] = bitReader.readU(8)\r\n      }\r\n      generalConstraintInfo[8] = bitReader.readU(7)\r\n      const gci_num_reserved_bits = bitReader.readU(8)\r\n      bitReader.readU(gci_num_reserved_bits)\r\n    }\r\n    bitReader.skipPadding()\r\n    for (let i = spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n      ptlSublayerLevelPresentFlag[i] = bitReader.readU(1)\r\n    }\r\n    bitReader.skipPadding()\r\n    for (let i = spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n      if (ptlSublayerLevelPresentFlag[i]) {\r\n        sublayerLevelIdc[i] = bitReader.readU(8)\r\n      }\r\n    }\r\n\r\n    const ptl_num_sub_profiles = bitReader.readU(8)\r\n    if (ptl_num_sub_profiles) {\r\n      for (let i = 0; i < ptl_num_sub_profiles; i++) {\r\n        generalSubProfileIdc[i] = bitReader.readU(32)\r\n      }\r\n    }\r\n  }\r\n\r\n  // sps_gdr_enabled_flag\r\n  bitReader.readU1()\r\n  const sps_ref_pic_resampling_enabled_flag = bitReader.readU1()\r\n  if (sps_ref_pic_resampling_enabled_flag) {\r\n    // sps_res_change_in_clvs_allowed_flag\r\n    bitReader.readU1()\r\n  }\r\n\r\n  const sps_pic_width_max_in_luma_samples = width = expgolomb.readUE(bitReader)\r\n  const sps_pic_height_max_in_luma_samples = height = expgolomb.readUE(bitReader)\r\n\r\n  if (bitReader.readU1()) {\r\n    // sps_conf_win_left_offset\r\n    expgolomb.readUE(bitReader)\r\n    // sps_conf_win_right_offset\r\n    expgolomb.readUE(bitReader)\r\n    // sps_conf_win_top_offset\r\n    expgolomb.readUE(bitReader)\r\n    // sps_conf_win_bottom_offset\r\n    expgolomb.readUE(bitReader)\r\n  }\r\n\r\n  if (bitReader.readU1()) {\r\n    const sps_num_subpics_minus1 = expgolomb.readUE(bitReader)\r\n    const ctb_log2_size_y = sps_log2_ctu_size_minus5 + 5\r\n    const ctb_size_y      = 1 << ctb_log2_size_y\r\n    const tmp_width_val   = sps_pic_width_max_in_luma_samples / (1 << ctb_log2_size_y)\r\n    const tmp_height_val  = sps_pic_height_max_in_luma_samples / (1 << ctb_log2_size_y)\r\n    const wlen            = Math.ceil(Math.log2(tmp_width_val))\r\n    const hlen            = Math.ceil(Math.log2(tmp_height_val))\r\n\r\n    let sps_subpic_id_len = 0\r\n    let sps_subpic_same_size_flag = 0\r\n    let sps_independent_subpics_flag = 0\r\n    // sps_num_subpics_minus1\r\n    if (sps_num_subpics_minus1 > 0) {\r\n      sps_independent_subpics_flag = bitReader.readU1()\r\n      sps_subpic_same_size_flag = bitReader.readU1()\r\n    }\r\n    for (let i = 0; sps_num_subpics_minus1 > 0 && i <= sps_num_subpics_minus1; i++) {\r\n      if (!sps_subpic_same_size_flag || i == 0) {\r\n        if (i > 0 && sps_pic_width_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(wlen)\r\n        }\r\n        if (i > 0 && sps_pic_height_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(hlen)\r\n        }\r\n        if (i < sps_num_subpics_minus1 && sps_pic_width_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(wlen)\r\n        }\r\n        if (i < sps_num_subpics_minus1 && sps_pic_height_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(hlen)\r\n        }\r\n      }\r\n      if (!sps_independent_subpics_flag) {\r\n        // sps_subpic_treated_as_pic_flag && sps_loop_filter_across_subpic_enabled_flag\r\n        bitReader.readU(2)\r\n      }\r\n    }\r\n    sps_subpic_id_len = expgolomb.readUE(bitReader) + 1\r\n    // sps_subpic_id_mapping_explicitly_signalled_flag\r\n    if (bitReader.readU(1)) {\r\n      // sps_subpic_id_mapping_present_flag\r\n      if (bitReader.readU(1)) {\r\n        for (let i = 0; i <= sps_num_subpics_minus1; i++) {\r\n          // sps_subpic_id[i]\r\n          bitReader.readU(sps_subpic_id_len)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  bitDepthMinus8 = expgolomb.readUE(bitReader)\r\n\r\n  // sps_entropy_coding_sync_enabled_flag\r\n  bitReader.readU(1)\r\n  // sps_entry_point_offsets_present_flag\r\n  bitReader.readU(1)\r\n\r\n  const sps_log2_max_pic_order_cnt_lsb_minus4 = bitReader.readU(4)\r\n  const sps_poc_msb_cycle_flag = bitReader.readU(1)\r\n  let sps_poc_msb_cycle_len_minus1 = 0\r\n  if (sps_poc_msb_cycle_flag) {\r\n    sps_poc_msb_cycle_len_minus1 = expgolomb.readUE(bitReader)\r\n  }\r\n  const sps_extra_ph_bit_present_flag: number[] = []\r\n  const sps_num_extra_ph_bytes = bitReader.readU(2)\r\n  for (let i = 0; i < (sps_num_extra_ph_bytes * 8); i++) {\r\n    sps_extra_ph_bit_present_flag[i] = bitReader.readU(1)\r\n  }\r\n\r\n  const videoDelay = (spsMaxSublayersMinus1 + 1)  > 2 ? 2 : spsMaxSublayersMinus1\r\n\r\n  return {\r\n    profile,\r\n    level,\r\n    width,\r\n    height,\r\n    videoDelay,\r\n    chromaFormatIdc,\r\n    bitDepthMinus8,\r\n    generalProfileSpace,\r\n    tierFlag,\r\n    generalConstraintInfo,\r\n    generalSubProfileIdc,\r\n    ptlFrameOnlyConstraintFlag,\r\n    ptlMultilayerEnabledFlag,\r\n    spsMaxSublayersMinus1,\r\n    ptlSublayerLevelPresentFlag,\r\n    sublayerLevelIdc,\r\n    sps_log2_max_pic_order_cnt_lsb_minus4,\r\n    sps_poc_msb_cycle_flag,\r\n    sps_poc_msb_cycle_len_minus1,\r\n    sps_num_extra_ph_bytes,\r\n    sps_extra_ph_bit_present_flag\r\n  }\r\n}\r\n\r\nexport function parseExtraData(extradata: Uint8ArrayInterface) {\r\n\r\n  if (naluUtil.isAnnexb(extradata)) {\r\n    extradata = annexbExtradata2AvccExtradata(extradata)\r\n  }\r\n\r\n  const bitReader = new BitReader()\r\n  bitReader.appendBuffer(extradata)\r\n  const ptlPresentFlag = bitReader.readU(8) & 0x01\r\n  if (ptlPresentFlag) {\r\n    return parsePTL(bitReader)\r\n  }\r\n  return {} as Data\r\n}\r\n","/*\r\n * libmedia crypto util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nexport function random(buffer: Uint8Array) {\r\n  if (defined(ENV_NODE)) {\r\n    const crypto = require('crypto')\r\n    crypto.randomFillSync(buffer)\r\n  }\r\n  else {\r\n    crypto.getRandomValues(buffer)\r\n  }\r\n}\r\n","/*\r\n * libmedia video pixel util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVPixelFormatDescriptor, getAVPixelFormatDescriptor, AVPixelFormatFlags } from '../pixelFormatDescriptor'\r\nimport { AVChromaLocation, AVPixelFormat } from '../pixfmt'\r\nimport * as errorType from '../error'\r\nimport { INT32_MAX } from '../constant'\r\nimport { memset } from 'cheap/std/memory'\r\nimport * as stack from 'cheap/stack'\r\nimport { avFree, avMalloc } from './mem'\r\nimport alignFunc from 'common/math/align'\r\n\r\nexport function chromaLocation2Pos(pos: AVChromaLocation) {\r\n  if (pos <= AVChromaLocation.AVCHROMA_LOC_UNSPECIFIED || pos >= AVChromaLocation.AVCHROMA_LOC_NB) {\r\n    return\r\n  }\r\n  return {\r\n    x: (pos & 1) * 128,\r\n    y: ((pos >>> 1) ^ (pos < 4 ? 1 : 0)) * 128\r\n  }\r\n}\r\n\r\nfunction getMaxPixSteps(desc: AVPixelFormatDescriptor) {\r\n  const maxPixSteps: int32[] = [0, 0, 0, 0]\r\n  const maxPixStepsComps: int32[] = [0, 0, 0, 0]\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (desc.comp[i] && desc.comp[i].step > maxPixSteps[desc.comp[i].plane]) {\r\n      maxPixSteps[desc.comp[i].plane] = desc.comp[i].step\r\n      maxPixStepsComps[desc.comp[i].plane] = i\r\n    }\r\n  }\r\n\r\n  return {\r\n    maxPixSteps,\r\n    maxPixStepsComps\r\n  }\r\n}\r\n\r\nfunction setSystematicPal(pal: pointer<uint32>, pixfmt: AVPixelFormat) {\r\n  for (let i = 0; i < 256; i++) {\r\n    let r: int32, g: int32, b: int32\r\n\r\n    switch (pixfmt) {\r\n      case AVPixelFormat.AV_PIX_FMT_RGB8:\r\n        r = (i >> 5) * 36\r\n        g = ((i >> 2) & 7) * 36\r\n        b = (i & 3) * 85\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_BGR8:\r\n        b = (i >> 6) * 85\r\n        g = ((i >> 3) & 7) * 36\r\n        r = (i & 7) * 36\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_RGB4_BYTE:\r\n        r = (i >> 3) * 255\r\n        g = ((i >> 1) & 3) * 85\r\n        b = (i & 1) * 255\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_BGR4_BYTE:\r\n        b = (i >> 3) * 255\r\n        g = ((i >> 1) & 3) * 85\r\n        r = (i & 1) * 255\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_GRAY8:\r\n        r = b = g = i\r\n        break\r\n      default:\r\n        return errorType.INVALID_ARGUMENT\r\n    }\r\n    pal[i] = b + (g << 8) + (r << 16) + (0xFF << 24)\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\nfunction pixelGetLinesize_(width: int32, plane: int32, maxStep: int32, maxStepComp: int32, desc: AVPixelFormatDescriptor) {\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  if (width < 0) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const s = (maxStepComp === 1 || maxStepComp === 2) ? desc.log2ChromaW : 0\r\n\r\n  const shiftedW = ((width + (1 << s) - 1)) >>> s\r\n\r\n  if (shiftedW && maxStep > INT32_MAX / shiftedW) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  let linesize = maxStep * shiftedW\r\n\r\n  if (desc.flags & AVPixelFormatFlags.BIT_STREAM) {\r\n    linesize = (linesize + 7) >>> 3\r\n  }\r\n\r\n  return linesize\r\n}\r\n\r\nexport function pixelGetLinesize(pixfmt: AVPixelFormat, width: int32, plane: int32) {\r\n  const desc = getAVPixelFormatDescriptor(pixfmt)\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const { maxPixSteps, maxPixStepsComps } = getMaxPixSteps(desc)\r\n\r\n  return pixelGetLinesize_(width, plane, maxPixSteps[plane], maxPixStepsComps[plane], desc)\r\n}\r\n\r\nexport function pixelFillLinesizes(linesizes: pointer<int32>, pixfmt: AVPixelFormat, width: int32) {\r\n  const desc = getAVPixelFormatDescriptor(pixfmt)\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const { maxPixSteps, maxPixStepsComps } = getMaxPixSteps(desc)\r\n\r\n  memset(linesizes, 0, 4 * sizeof(linesizes[0]))\r\n\r\n  let ret = 0\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if ((ret = pixelGetLinesize_(width, i, maxPixSteps[i], maxPixStepsComps[i], desc)) < 0) {\r\n      return ret\r\n    }\r\n    linesizes[i] = ret\r\n  }\r\n}\r\n\r\nexport function pixelFillPlaneSizes(sizes: pointer<size>, pixfmt: AVPixelFormat, height: int32, linesizes: pointer<int32>) {\r\n  const hasPlane = [0, 0, 0, 0]\r\n\r\n  const desc = getAVPixelFormatDescriptor(pixfmt)\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  memset(sizes, 0, 4 * sizeof(sizes[0]))\r\n\r\n  if (linesizes[0] > INT32_MAX / height) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  sizes[0] = reinterpret_cast<size>(linesizes[0] * height)\r\n\r\n  if (desc.flags & AVPixelFormatFlags.PALETTE) {\r\n    sizes[1] = reinterpret_cast<size>(256 * 4)\r\n    return 0\r\n  }\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (desc.comp[i]) {\r\n      hasPlane[desc.comp[i].plane] = 1\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < 4 && hasPlane[i]; i++) {\r\n    let s = (i === 1 || i === 2) ? desc.log2ChromaH : 0\r\n    let h = (height + (1 << s) - 1) >> s\r\n\r\n    if (linesizes[i] > INT32_MAX / h) {\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n\r\n    sizes[i] = reinterpret_cast<size>(h * linesizes[i])\r\n  }\r\n  return 0\r\n}\r\n\r\nexport function pixelFillPointer(\r\n  data: pointer<pointer<uint8>>,\r\n  pixfmt: AVPixelFormat,\r\n  height: int32,\r\n  ptr: pointer<uint8>,\r\n  linesizes: pointer<int32>\r\n) {\r\n  const linesizes1 = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(linesizes[0]) * 4))\r\n  const sizes = reinterpret_cast<pointer<size>>(stack.malloc(sizeof(size) * 4))\r\n\r\n  memset(data, 0, 4 * sizeof(data[0]))\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    linesizes1[i] = linesizes[i]\r\n  }\r\n\r\n  let ret = pixelFillPlaneSizes(sizes, pixfmt, height, linesizes1)\r\n\r\n  if (ret < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  ret = 0\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (sizes[i] > INT32_MAX - ret) {\r\n      defer()\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n    ret += reinterpret_cast<double>(sizes[i])\r\n  }\r\n\r\n  if (!ptr) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  data[0] = ptr\r\n  for (let i = 1; i < 4 && sizes[i]; i++) {\r\n    data[i] = reinterpret_cast<pointer<uint8>>(data[i - 1] + sizes[i - 1])\r\n  }\r\n\r\n  defer()\r\n  return ret\r\n\r\n  function defer() {\r\n    stack.free(sizeof(linesizes[0]) * 4)\r\n    stack.free(sizeof(size) * 4)\r\n  }\r\n}\r\n\r\nexport function pixelAlloc(\r\n  pointers: pointer<pointer<uint8>>,\r\n  linesizes: pointer<int32>,\r\n  w: int32,\r\n  h: int32,\r\n  pixfmt: AVPixelFormat,\r\n  align: int32 = 1\r\n) {\r\n\r\n  const desc = getAVPixelFormatDescriptor(pixfmt)\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const linesizes1 = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(linesizes[0]) * 4))\r\n  const sizes = reinterpret_cast<pointer<size>>(stack.malloc(sizeof(size) * 4))\r\n\r\n  let ret = 0\r\n\r\n  if ((ret = pixelFillLinesizes(linesizes, pixfmt, align > 7 ? alignFunc(w, 8) : w)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    linesizes[i] = alignFunc(linesizes[i], align)\r\n    linesizes1[i] = linesizes[i]\r\n  }\r\n\r\n  if ((ret = pixelFillPlaneSizes(sizes, pixfmt, h, linesizes1)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  let totalSize: size = static_cast<size>(align)\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (totalSize > static_cast<size>(INT32_MAX) - sizes[i]) {\r\n      defer()\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n    totalSize += sizes[i]\r\n  }\r\n\r\n  const buf: pointer<uint8> = avMalloc(totalSize)\r\n\r\n  if (!buf) {\r\n    defer()\r\n    return errorType.NO_MEMORY\r\n  }\r\n\r\n  if ((ret = pixelFillPointer(pointers, pixfmt, h, buf, linesizes)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  if (desc.flags & AVPixelFormatFlags.PALETTE) {\r\n    if (align < 4) {\r\n      avFree(buf)\r\n      defer()\r\n      return ret\r\n    }\r\n    setSystematicPal(reinterpret_cast<pointer<uint32>>(pointers[1]), pixfmt)\r\n  }\r\n\r\n  if ((desc.flags & AVPixelFormatFlags.PALETTE)\r\n    && pointers[1]\r\n    && pointers[1] - pointers[0] > linesizes[0] * h\r\n  ) {\r\n    /* zero-initialize the padding before the palette */\r\n    memset(pointers[0] + linesizes[0] * h, 0, pointers[1] - pointers[0] - linesizes[0] * h)\r\n  }\r\n\r\n  defer()\r\n  return ret\r\n\r\n  function defer() {\r\n    stack.free(sizeof(linesizes[0]) * 4)\r\n    stack.free(sizeof(size) * 4)\r\n  }\r\n}\r\n\r\nexport function pixelGetSize(pixfmt: AVPixelFormat, width: int32, height: int32, align: int32) {\r\n  const desc = getAVPixelFormatDescriptor(pixfmt)\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const linesizes = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(int32) * 4))\r\n  const alignedLinesizes = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(int32) * 4))\r\n  const sizes = reinterpret_cast<pointer<size>>(stack.malloc(sizeof(size) * 4))\r\n\r\n  let ret = 0\r\n\r\n  if ((ret = pixelFillLinesizes(linesizes, pixfmt, width)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    alignedLinesizes[i] = alignFunc(linesizes[i], align)\r\n  }\r\n\r\n  if ((ret = pixelFillPlaneSizes(sizes, pixfmt, height, alignedLinesizes)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  let totalSize: size = 0\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (totalSize > reinterpret_cast<size>(INT32_MAX) - sizes[i]) {\r\n      defer()\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n    totalSize += sizes[i]\r\n  }\r\n\r\n  defer()\r\n\r\n  return totalSize\r\n\r\n  function defer() {\r\n    stack.free(sizeof(int32) * 4)\r\n    stack.free(sizeof(int32) * 4)\r\n    stack.free(sizeof(size) * 4)\r\n  }\r\n}\r\n","export default function align(value: number, alignment: number) {\r\n  return (value + (alignment - 1)) & ~(alignment - 1)\r\n}\r\n"],"names":[],"sourceRoot":""}