"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[3],{64436:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(134),r=i(63939),s=(i(77162),i(37837)),c=i(71766);class n{constructor(){(0,a.A)(this,"inCodecpar",void 0),(0,a.A)(this,"inTimeBase",void 0),(0,a.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,s.Gy)(168),(0,c.Yi)(this.inCodecpar,t),this.inTimeBase={den:r.f[15](e+4),num:r.f[15](e)},0}destroy(){this.inCodecpar&&((0,c.dn)(this.inCodecpar),this.inCodecpar=0)}}},26173:(t,e,i)=>{i.d(e,{A:()=>m});var a=i(134),r=i(63939),s=i(50932),c=i(64436),n=i(71517),o=i(62815),d=i(67659),h=i(59166),l=i(14686),f=i(9705),p=i(37837),u=i(4624);class m extends c.A{constructor(t=!1){super(),(0,a.A)(this,"cache",void 0),(0,a.A)(this,"cached",void 0),(0,a.A)(this,"reverseSps",void 0),this.reverseSps=t}init(t,e){return super.init(t,e),this.cache=(0,n._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,n.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(64&r.f[15](t+36)){let e;(0,n.zu)(this.cache,t);const i=(0,l.JW)(r.f[20](t+24),r.f[15](t+28));if(27===r.f[15](this.inCodecpar+4)?e=o.oT(i,this.reverseSps):173===r.f[15](this.inCodecpar+4)?e=d.oT(i,this.reverseSps):196===r.f[15](this.inCodecpar+4)?e=h.oT(i,this.reverseSps):u.h2(`not support for codecId: ${r.f[15](this.inCodecpar+4)}`,"src\\avformat\\bsf\\h2645\\Annexb2AvccFilter.ts",96),s.M[15](this.cache+36,-65&r.f[15](this.cache+36)),(0,n.NX)(this.cache,e.bufferPointer,e.length),e.key&&s.M[15](this.cache+36,1|r.f[15](this.cache+36)),e.extradata){const t=(0,p.sY)(e.extradata.length);(0,l.lW)(t,e.extradata.length,e.extradata),(0,n.Ow)(this.cache,1,t,e.extradata.length)}}else(0,n.rN)(this.cache,t);return this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,n.Up)(t),(0,n.rN)(t,this.cache),this.cached=!1,0):f.LR}reset(){return 0}}},4003:(t,e,i)=>{i.r(e),i.d(e,{default:()=>P});var a=i(134),r=i(61499),s=i(63939),c=i(9599),n=i(29170),o=i(51597),d=i(58121),h=i(68243),l=i(72739),f=i(35028),p=i(92647),u=i(14686),m=i(4624),g=i(71517),w=i(44328),U=i(26173),I=i(77231),v=i(65977),M=i(73040),x=i(94889),b=i(62815),k=i(67659),y=i(59166),A=i(60264),D=i(35336);const S="src\\avformat\\formats\\OFlvFormat.ts";class P extends o.A{constructor(t={}){super(),(0,a.A)(this,"type",0),(0,a.A)(this,"context",void 0),(0,a.A)(this,"header",void 0),(0,a.A)(this,"script",void 0),(0,a.A)(this,"options",void 0),(0,a.A)(this,"annexb2AvccFilter",void 0),(0,a.A)(this,"avpacket",void 0),(0,a.A)(this,"headerWriter",void 0),(0,a.A)(this,"headerBuffers",void 0),this.header=new d.A,this.script=new h.A,this.headerWriter=new D.A(1e5),this.headerBuffers=[],this.headerWriter.onFlush=t=>(this.headerBuffers.push(t.slice()),0),this.options=t,this.context={keyframeFilePositions:[],keyFrameTimes:[],lastkeyframelocation:0,lastkeyframetimestamp:BigInt(0),lasttimestamp:BigInt(0),framerate:0,filesize:0,audioSize:0,videosize:0,datasize:0,duration:0,scriptWrote:!1,frameCount:0,firstKeyframePositionWrote:!1,videoMetadataWrote:!1,enableNanoTimestamp:t.enableNanoTimestamp,multiAudioTracks:!1,multiVideoTracks:!1,useLegacyHevc:t.useLegacyHevc}}getDefaultStream(t,e){let i=t.streams.filter((t=>t.codecpar.codecType===e));if(i.length<2)return i[0];const a=i.filter((t=>!this.isEnhancedStream(t)));return a.find((t=>!!(1&t.disposition)))||a[0]||i[0]}isEnhancedStream(t){if(this.context.enableNanoTimestamp)return!0;const e=t.privData;return!(this.context.useLegacyHevc&&173===t.codecpar.codecId&&!e.trackId&&!this.context.multiVideoTracks)&&(x.C$(t.codecpar.codecId)||(null==e?void 0:e.trackId)>0)}init(t){t.ioWriter&&t.ioWriter.setEndian(!0);const e=this.getDefaultStream(t,1),i=this.getDefaultStream(t,0);let a=1,s=1;return t.streams.forEach((t=>{if(1===t.codecpar.codecType){this.header.hasAudio=!0,this.script.onMetaData.hasAudio=!0,86051===t.codecpar.codecId&&(16e3!==t.codecpar.sampleRate&&m.h2("flv speex only support 16000 sample rate",S,163),1!==t.codecpar.chLayout.nbChannels&&m.h2("flv speex only support 1 channel",S,166));let i=0;var c;t===e?(this.script.onMetaData.audiocodecid=null!==(c=f.FV[t.codecpar.codecId])&&void 0!==c?c:(0,v.A)(f.Tf[t.codecpar.codecId]),this.script.onMetaData.stereo=t.codecpar.chLayout.nbChannels>1,this.script.onMetaData.audiosamplerate=t.codecpar.sampleRate||0,this.script.onMetaData.audiosamplesize=t.codecpar.frameSize||0):(i=a++,this.script.onMetaData.audioTrackIdInfoMap||(this.script.onMetaData.audioTrackIdInfoMap={}),this.script.onMetaData.audioTrackIdInfoMap[i]={audiocodecid:f.Tf[t.codecpar.codecId]?(0,v.A)(f.Tf[t.codecpar.codecId]):f.FV[t.codecpar.codecId],stereo:t.codecpar.chLayout.nbChannels>1,audiosamplerate:t.codecpar.sampleRate||0,audiosamplesize:t.codecpar.frameSize||0},t.metadata.title&&(this.script.onMetaData.audioTrackIdInfoMap[i].title=t.metadata.title),t.metadata.language&&(this.script.onMetaData.audioTrackIdInfoMap[i].lang=t.metadata.language)),t.privData={trackId:i}}else if(0===t.codecpar.codecType){this.header.hasVideo=!0,this.script.onMetaData.hasVideo=!0,27!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||this.annexb2AvccFilter||(this.annexb2AvccFilter=new U.A,this.annexb2AvccFilter.init(i.codecpar[r.o9],i.timeBase[r.o9]));let e=0;var n;t===i?(this.script.onMetaData.videocodecid=null!==(n=f.FV[t.codecpar.codecId])&&void 0!==n?n:(0,v.A)(f.Tf[t.codecpar.codecId]),this.script.onMetaData.width=t.codecpar.width||0,this.script.onMetaData.height=t.codecpar.height||0,this.script.onMetaData.framerate=(0,w.lb)(t.codecpar.framerate)):(e=s++,this.script.onMetaData.videoTrackIdInfoMap||(this.script.onMetaData.videoTrackIdInfoMap={}),this.script.onMetaData.videoTrackIdInfoMap[e]={videocodecid:f.Tf[t.codecpar.codecId]?(0,v.A)(f.Tf[t.codecpar.codecId]):f.FV[t.codecpar.codecId],width:t.codecpar.width||0,height:t.codecpar.height||0,framerate:(0,w.lb)(t.codecpar.framerate)},t.metadata.title&&(this.script.onMetaData.videoTrackIdInfoMap[e].title=t.metadata.title),t.metadata.language&&(this.script.onMetaData.videoTrackIdInfoMap[e].lang=t.metadata.language)),t.privData={trackId:e}}})),a>1&&(this.context.multiAudioTracks=!0),s>1&&(this.context.multiVideoTracks=!0),this.avpacket=(0,g._5)(),0}async destroy(t){this.annexb2AvccFilter&&(this.annexb2AvccFilter.destroy(),this.annexb2AvccFilter=null),this.avpacket&&((0,g.Qe)(this.avpacket),this.avpacket=0)}writeMetadata(t,e){if((173===e.codecpar.codecId||167===e.codecpar.codecId||225===e.codecpar.codecId)&&this.isEnhancedStream(e)){const i=(0,g.Un)(e.codecpar[r.o9]+20,e.codecpar[r.o9]+24,22),a=(0,g.Un)(e.codecpar[r.o9]+20,e.codecpar[r.o9]+24,20),o={colorConfig:{}};if(2!==e.codecpar.colorTrc&&(o.colorConfig.transferCharacteristics=e.codecpar.colorTrc),2!==e.codecpar.colorSpace&&(o.colorConfig.matrixCoefficients=e.codecpar.colorSpace),2!==e.codecpar.colorPrimaries&&(o.colorConfig.colorPrimaries=e.codecpar.colorPrimaries),i){const t=s.f[20](i);o.hdrCll={maxCLL:s.f[8](t),maxFall:s.f[8](t+4)}}if(a){const t=s.f[20](a);o.hdrMdcv={},s.f[15](t+80)&&(o.hdrMdcv.redX=(0,w.lb)((0,n.A)(t,c.P)),o.hdrMdcv.redY=(0,w.lb)((0,n.A)(t+8,c.P)),o.hdrMdcv.greenX=(0,w.lb)((0,n.A)(t+16,c.P)),o.hdrMdcv.greenY=(0,w.lb)((0,n.A)(t+16+8,c.P)),o.hdrMdcv.blueX=(0,w.lb)((0,n.A)(t+32,c.P)),o.hdrMdcv.blueY=(0,w.lb)((0,n.A)(t+32+8,c.P)),o.hdrMdcv.whitePointX=(0,w.lb)((0,n.A)(t+48,c.P)),o.hdrMdcv.whitePointY=(0,w.lb)((0,n.A)(t+48+8,c.P))),s.f[15](t+84)&&(o.hdrMdcv.maxLuminance=(0,w.lb)((0,n.A)(t+72,c.P)),o.hdrMdcv.minLuminance=(0,w.lb)((0,n.A)(t+64,c.P)))}x.M5(t.ioWriter,9,BigInt(0),(t=>{x.Q4(t,e,this.context,!0,4,1,BigInt(0),0)}),(t=>{M.bD(t,"colorInfo"),M.bD(t,o)}))}}writeMultichannelConfig(t,e){this.isEnhancedStream(e)&&1===e.codecpar.codecType&&x.M5(t.ioWriter,8,BigInt(0),(t=>{x.zk(t,e,this.context,!0,4,BigInt(0),0)}),(t=>{switch(e.codecpar.chLayout.order){case 1:t.writeUint8(1);break;case 2:t.writeUint8(2);break;default:t.writeUint8(0)}if(t.writeUint8(e.codecpar.chLayout.nbChannels),1===e.codecpar.chLayout.order){let i=e.codecpar.chLayout.u.mask&BigInt(262143);i|=e.codecpar.chLayout.u.mask>>BigInt(35)-BigInt(18)&BigInt(16515072),t.writeUint32(Number(BigInt.asUintN(32,i)))}else if(2===e.codecpar.chLayout.order)for(let i=0;i<e.codecpar.chLayout.nbChannels;i++){const a=s.f[15](e.codecpar.chLayout.u.map+24*i);a>=0&&a<=17?t.writeUint8(a-0):a>=35&&a<=40?t.writeUint8(a-35+18):512===a?t.writeUint8(254):t.writeUint8(255)}}))}writeHeader(t){return this.header.write(t.ioWriter),t.ioWriter.writeUint32(0),this.options.live&&(this.script.write(t.ioWriter),this.context.scriptWrote=!0),t.streams.forEach((e=>{const i=e.privData;if(1===e.codecpar.codecType)e.codecpar.extradata&&(this.isEnhancedStream(e)||86018===e.codecpar.codecId)&&x.M5(t.ioWriter,8,BigInt(0),(t=>{x.zk(t,e,this.context,this.isEnhancedStream(e),(this.isEnhancedStream(e),0),BigInt(0),0)}),(0,u.s3)(e.codecpar.extradata,e.codecpar.extradataSize),(t=>{this.context.filesize+=t+4,i.trackId||(this.context.audioSize+=e.codecpar.extradataSize,this.script.onMetaData.hasMetadata=!0),this.context.datasize+=e.codecpar.extradataSize})),this.writeMultichannelConfig(t,e);else if(0===e.codecpar.codecType&&e.codecpar.extradata&&(this.isEnhancedStream(e)||27===e.codecpar.codecId||173===e.codecpar.codecId||12===e.codecpar.codecId)){let a=(0,u.s3)(e.codecpar.extradata,e.codecpar.extradataSize);27!==e.codecpar.codecId&&173!==e.codecpar.codecId&&196!==e.codecpar.codecId||!A.Bs(a)||(27===e.codecpar.codecId?a=b.S1(a):173===e.codecpar.codecId?a=k.S1(a):196===e.codecpar.codecId&&(a=y.S1(a)));const r=t.ioWriter.getPos();x.M5(t.ioWriter,9,BigInt(0),(t=>{x.Q4(t,e,this.context,this.isEnhancedStream(e),(this.isEnhancedStream(e),0),1,BigInt(0),0)}),a,(t=>{this.context.filesize+=t+4,i.trackId||(this.context.videosize+=e.codecpar.extradataSize,this.script.onMetaData.hasMetadata=!0),this.context.datasize+=e.codecpar.extradataSize,this.context.keyFrameTimes.push(0),this.context.keyframeFilePositions.push(Number(r)),this.context.videoMetadataWrote=!0}))}this.writeMetadata(t,e)})),0}isNewExtradata(t,e){if(t.length===e.codecpar.extradataSize){const i=(0,u.s3)(e.codecpar.extradata,e.codecpar.extradataSize);for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0}return!1}writeAVPacket(t,e){const i=t.getStreamByIndex(s.f[15](e+32));if(!i)return void m.R8(`can not found the stream width the packet's streamIndex: ${s.f[15](e+32)}, ignore it`,S,512);const a=i.privData;if(1===i.codecpar.codecType){const r=(0,g.rU)(e,1);if(r&&(this.isEnhancedStream(i)||86018===i.codecpar.codecId)){const c=(0,u.s3)(s.f[20](r),s.f[25](r+4));this.isNewExtradata(c,i)&&(x.M5(t.ioWriter,8,(0,w.Mr)(s.f[17](e+16),e+72,I.i0),(t=>{x.zk(t,i,this.context,this.isEnhancedStream(i),(this.isEnhancedStream(i),0),s.f[17](e+16),e+72)}),c,(t=>{this.context.filesize+=t+4})),a.trackId||(this.context.audioSize+=c.length),this.context.datasize+=c.length)}if(s.f[15](e+28)){this.headerWriter.reset(),this.headerBuffers.length=0,x.zk(this.headerWriter,i,this.context,this.isEnhancedStream(i),(this.isEnhancedStream(i),1),s.f[17](e+16),e+72),this.headerWriter.flush();const a=(0,p.A)(Uint8Array,this.headerBuffers),r=t.ioWriter.getPos();t.ioWriter.writeUint8(8),t.ioWriter.writeUint24(s.f[15](e+28)+a.length);const c=(0,w.Mr)(s.f[17](e+16),e+72,I.i0);t.ioWriter.writeUint24(Number(c&BigInt(16777215))),t.ioWriter.writeUint8(Number(c>>BigInt(24)&BigInt(255))),t.ioWriter.writeUint24(0),t.ioWriter.writeBuffer(a),t.ioWriter.writeBuffer((0,u.s3)(s.f[20](e+24),s.f[15](e+28)));const n=Number(t.ioWriter.getPos()-r);t.ioWriter.writeUint32(n),this.context.filesize+=n+4}a.trackId||(this.context.audioSize+=s.f[15](e+28),this.context.lasttimestamp=(0,w.Mr)(s.f[17](e+8),e+72,I.i0)),this.context.datasize+=s.f[15](e+28)}else if(0===i.codecpar.codecType){(27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId)&&64&s.f[15](e+36)&&(this.annexb2AvccFilter.sendAVPacket(e),this.annexb2AvccFilter.receiveAVPacket(this.avpacket),e=this.avpacket);const r=t.ioWriter.getPos(),c=(0,g.rU)(e,1);if(c){const r=(0,u.s3)(s.f[20](c),s.f[25](c+4));this.isNewExtradata(r,i)&&(this.isEnhancedStream(i)||27===i.codecpar.codecId||173===i.codecpar.codecId||12===i.codecpar.codecId)&&(x.M5(t.ioWriter,9,(0,w.Mr)(s.f[17](e+16),e+72,I.i0),(t=>{x.Q4(t,i,this.context,this.isEnhancedStream(i),(this.isEnhancedStream(i),0),s.f[15](e+36),s.f[17](e+16),e+72)}),r,(t=>{this.context.filesize+=t+4})),a.trackId||(this.context.videosize+=r.length),this.context.datasize+=r.length)}if(s.f[15](e+28)){let c=0;s.f[17](e+8)!==I.Dh&&(c=Number(BigInt.asIntN(32,(0,w.Mr)(s.f[17](e+8)-s.f[17](e+16),e+72,I.i0))));const n=s.f[17](e+16)===s.f[17](e+8)||173!==i.codecpar.codecId&&196!==i.codecpar.codecId&&27!==i.codecpar.codecId?3:1;this.headerWriter.reset(),this.headerBuffers.length=0,x.Q4(this.headerWriter,i,this.context,this.isEnhancedStream(i),this.isEnhancedStream(i)?n:1,s.f[15](e+36),s.f[17](e+16),e+72,c),this.headerWriter.flush();const o=(0,p.A)(Uint8Array,this.headerBuffers),d=t.ioWriter.getPos();t.ioWriter.writeUint8(9),t.ioWriter.writeUint24(s.f[15](e+28)+o.length);const h=(0,w.Mr)(s.f[17](e+16),e+72,I.i0);t.ioWriter.writeUint24(Number(h&BigInt(16777215))),t.ioWriter.writeUint8(Number(h>>BigInt(24)&BigInt(255))),t.ioWriter.writeUint24(0),t.ioWriter.writeBuffer(o),t.ioWriter.writeBuffer((0,u.s3)(s.f[20](e+24),s.f[15](e+28)));const l=Number(t.ioWriter.getPos()-d);t.ioWriter.writeUint32(l),this.context.filesize+=l+4,a.trackId||(this.context.frameCount++,this.context.videosize+=s.f[15](e+28),this.context.lasttimestamp=(0,w.Mr)(s.f[17](e+8),e+72,I.i0)),this.context.datasize+=s.f[15](e+28),1&s.f[15](e+36)&&(this.context.firstKeyframePositionWrote||!this.context.videoMetadataWrote?(this.context.lastkeyframetimestamp=(0,w.Mr)(s.f[17](e+8),e+72,I.i0),this.context.lastkeyframelocation=Number(r),this.context.keyFrameTimes.push(Number((Number(this.context.lastkeyframetimestamp)*(0,w.lb)(I.i0)).toFixed(2))),this.context.keyframeFilePositions.push(this.context.lastkeyframelocation)):this.context.firstKeyframePositionWrote=!0)}}return 0}writeTrailer(t){if(t.streams.forEach((e=>{const i=e.privData;(27===e.codecpar.codecId||173===e.codecpar.codecId||12===e.codecpar.codecId||this.isEnhancedStream(e))&&(x.M5(t.ioWriter,9,this.context.lasttimestamp,(t=>{x.Q4(t,e,this.context,this.isEnhancedStream(e),this.isEnhancedStream(e)?(e.codecpar.codecType,2):2,32,this.context.lasttimestamp,0)}),void 0,(t=>{this.context.filesize+=t+4})),0!==e.codecpar.codecType||i.trackId||(this.script.onMetaData.canSeekToEnd=!0))})),this.context.scriptWrote)t.ioWriter.flush();else{t.ioWriter.flush(),this.script.onMetaData.filesize=this.context.filesize,this.script.onMetaData.audiosize=this.context.audioSize,this.script.onMetaData.videosize=this.context.videosize,this.script.onMetaData.datasize=this.context.datasize,this.script.onMetaData.lasttimestamp=this.context.lasttimestamp,this.options.addKeyframePositions?(this.script.onMetaData.lastkeyframetimestamp=this.context.lastkeyframetimestamp,this.script.onMetaData.lastkeyframelocation=this.context.lastkeyframelocation,this.context.keyFrameTimes.length>1?(this.script.onMetaData.hasKeyframes=!0,this.script.onMetaData.keyframes={filepositions:this.context.keyframeFilePositions,times:this.context.keyFrameTimes}):this.script.onMetaData.hasKeyframes=!1):this.script.onMetaData.hasKeyframes=!1,this.script.onMetaData.duration=Number(this.context.lasttimestamp)/1e3,this.script.onMetaData.audiodatarate=this.context.audioSize/this.script.onMetaData.duration/1e3*8,this.script.onMetaData.videodatarate=this.context.videosize/this.script.onMetaData.duration/1e3*8,this.script.onMetaData.framerate=this.context.frameCount/this.script.onMetaData.duration;const e=this.script.computeSize();l.__(this.context.keyframeFilePositions,((t,i)=>{this.context.keyframeFilePositions[i]=t+11+e+4})),this.script.onMetaData.keyframes&&(this.script.onMetaData.keyframes.filepositions=this.context.keyframeFilePositions),this.context.filesize+=11+e+4,this.script.onMetaData.filesize=this.context.filesize;const i=[],a=t.ioWriter.onFlush;t.ioWriter.onFlush=t=>(i.push(t.slice()),0),this.script.write(t.ioWriter),t.ioWriter.flush(),t.ioWriter.onFlush=a;const r=(0,p.A)(Uint8Array,i);a&&a(r,BigInt(13))}return 0}flush(t){return t.ioWriter.flush(),0}}},58121:(t,e,i)=>{i.d(e,{A:()=>r});var a=i(134);class r{constructor(){(0,a.A)(this,"signature",void 0),(0,a.A)(this,"version",void 0),(0,a.A)(this,"flags",void 0),(0,a.A)(this,"dataOffset",void 0),(0,a.A)(this,"hasVideo",void 0),(0,a.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(t){this.signature=await t.readString(3),this.version=await t.readUint8(),this.flags=await t.readUint8(),this.dataOffset=await t.readUint32(),this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags)}write(t){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),t.writeString(this.signature),t.writeUint8(this.version),t.writeUint8(this.flags),t.writeUint32(this.dataOffset)}}},68243:(t,e,i)=>{i.d(e,{A:()=>h});var a=i(134),r=i(35336),s=i(92647),c=i(4624),n=i(94889),o=i(9705),d=i(73040);class h{constructor(){(0,a.A)(this,"onMetaData",void 0),this.onMetaData={canSeekToEnd:!1}}async read(t,e){const i=t.getPos(),a=i+BigInt(Math.floor(e)),r=await(0,d.$x)(t,a),s=await(0,d.$x)(t,a);this[r]=s,a>t.getPos()&&await t.skip(Number(BigInt.asIntN(32,a-t.getPos())));const n=Number(t.getPos()-i),h=await t.readUint32();return n+11!==h?(c.R8(`script size not match, size: ${n+11}, previousTagSize: ${h}`,"src\\avformat\\formats\\flv\\FlvScriptTag.ts",63),o.LR):0}computeSize(){const t=[],e=new r.A;return e.onFlush=e=>(t.push(e.slice()),0),(0,d.bD)(e,"onMetaData"),(0,d.bD)(e,this.onMetaData),e.flush(),(0,s.A)(Uint8Array,t).length}write(t){if(this.onMetaData){const e=[],i=new r.A;i.onFlush=t=>(e.push(t.slice()),0),(0,d.bD)(i,"onMetaData"),(0,d.bD)(i,this.onMetaData),i.flush();const a=(0,s.A)(Uint8Array,e);n.M5(t,18,BigInt(0),void 0,a)}}dts2Position(t){if(this.canSeek()){let e=-1;const i=this.onMetaData.keyframes.times,a=this.onMetaData.keyframes.filepositions;let r;for(r=0;r<i.length;r++){if(i[r]===t){e=r;break}if(i[r]>t){e=Math.max(r-1,0);break}}return r&&r===i.length&&(e=i.length-1),{pos:a[e],dts:i[e]}}return{pos:-1,dts:-1}}position2DTS(t){if(this.canSeek()){let i=-1;const a=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let s=0;for(s=0;s<r.length;s++)if(r[s]>t){i=s;break}var e;return s===r.length?null!==(e=this.onMetaData.duration)&&void 0!==e?e:a[a.length-1]:a[i]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},35028:(t,e,i)=>{i.d(e,{FJ:()=>r,FV:()=>a,Tf:()=>c,U5:()=>s});const a={65541:0,65536:3,86018:10,86017:2,86051:11,69645:1,86049:6,65543:7,65542:8,27:7,173:12,12:9,4:2,86:3,92:4,106:5,131:6},r={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},s={7:27,12:173,9:12,2:4,3:86,4:92,5:106,6:131},c={27:"avc1",173:"hvc1",196:"vvc1",139:"vp08",167:"vp09",225:"av01",86019:"ac-3",86056:"ec-3",86076:"Opus",86028:"fLaC",86017:".mp3",86018:"mp4a"}},94889:(t,e,i)=>{i.d(e,{C$:()=>h,M5:()=>d,Q4:()=>l,zk:()=>f});var a=i(35028),r=i(44328),s=i(77231),c=i(65977),n=i(67672);function o(t,e,i){const a=t.getPos(),r=t.getPointer(),s=a-BigInt(Math.floor(r));e<a&&e>=s?(t.seekInline(r+Number(e-a)),t.writeUint24(i),t.seekInline(r)):(t.seek(e),t.writeUint24(i),t.seek(a))}function d(t,e,i,a,r,s){t.flush(),t.writeUint8(e);const c=t.getPos();t.writeUint24(0),t.writeUint24(Number(i&BigInt(16777215))),t.writeUint8(Number(i>>BigInt(24)&BigInt(255))),t.writeUint24(0);const d=t.getPos();a&&a(t),n.Pc(r)?(r(t),o(t,c,Number(t.getPos()-d))):r&&(o(t,c,r.length+Number(t.getPos()-d)),t.writeBuffer(r));const h=Number(t.getPos()-c)+1;s&&s(h),t.writeUint32(h)}function h(t){return 86018!==t&&27!==t&&86017!==t&&12!==t&&!!a.Tf[t]}function l(t,e,i,n,o,d,h,l,f=0){const p=e.privData;let u=n?128:0;if(u|=(1&d?1:2)<<4,n){if(i.enableNanoTimestamp&&l){const e=(0,r.Mr)(h,l,s.FQ)-(0,r.Mr)(h,l,s.i0)*BigInt(1e6);e&&(u|=7,t.writeUint8(u),t.writeUint8(2),t.writeUint24(Number(BigInt.asIntN(32,e))),u=0)}i.multiVideoTracks&&(u|=6,t.writeUint8(u),u=0),u|=o,t.writeUint8(u),t.writeUint32((0,c.A)(a.Tf[e.codecpar.codecId])),i.multiVideoTracks&&t.writeUint8(p.trackId),1===o&&t.writeInt24(f)}else u|=15&a.FV[e.codecpar.codecId],t.writeUint8(u),27!==e.codecpar.codecId&&173!==e.codecpar.codecId&&196!==e.codecpar.codecId&&12!==e.codecpar.codecId||(t.writeUint8(o),t.writeInt24(f))}function f(t,e,i,n,o,d,h){const l=e.privData;let f=(n?9:15&a.FV[e.codecpar.codecId])<<4;if(n){if(i.enableNanoTimestamp){const e=(0,r.Mr)(d,h,s.FQ)-(0,r.Mr)(d,h,s.i0)*BigInt(1e6);e&&(f|=7,t.writeUint8(f),t.writeUint8(2),t.writeUint24(Number(BigInt.asIntN(32,e))),f=0)}i.multiVideoTracks&&(f|=5,t.writeUint8(f),f=0),f|=o,t.writeUint8(f),t.writeUint32((0,c.A)(a.Tf[e.codecpar.codecId])),i.multiVideoTracks&&t.writeUint8(l.trackId)}else(86018===e.codecpar.codecId||e.codecpar.chLayout.nbChannels>1)&&(f|=1),65541!==e.codecpar.codecId&&(f|=2),86018===e.codecpar.codecId||e.codecpar.sampleRate>=44e3?f|=12:e.codecpar.sampleRate>=22e3?f|=8:e.codecpar.sampleRate>=11e3&&(f|=4),t.writeUint8(f),86018===e.codecpar.codecId&&t.writeUint8(o)}},65977:(t,e,i)=>{i.d(e,{A:()=>s});var a=i(4624);const r="src\\avformat\\function\\mktag.ts";function s(t){4!==t.length&&a.R8(`tag length is not 4, tag: ${t}`,r,30);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},59166:(t,e,i)=>{i.d(e,{HL:()=>w,KD:()=>A,OD:()=>k,S1:()=>I,Ui:()=>S,XC:()=>y,kM:()=>b,oT:()=>M,sL:()=>v,wA:()=>x,wf:()=>D});var a=i(63939),r=i(72739),s=i(729),c=i(31865),n=i(37246),o=i(14686),d=i(60264),h=i(37837),l=i(23991),f=i(83314),p=i(39381),u=i(82774);const m=3;function g(t){const e=t.readU(9),i=t.readU(3),a=t.readU(2),r=t.readU(2),s=t.readU(3);t.readU(5),t.readU(2);const c=t.readU(6),n=t.readU(7),o=t.readU(1),d=t.readU(8),h=t.readU(1),l=t.readU(1),f=[],p=[];if(c){for(let e=0;e<c-1;e++)f[e]=t.readU(8);f[c-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let a=i-2;a>=0;--a)e|=t.readU(1)<<a;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let a=i-2;a>=0;--a)e&1<<a&&(p[a]=t.readU(8))}const u=t.readU(8),m=[];if(u)for(let e=0;e<u;e++)m.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:s,chromaFormatIdc:r,constantFrameRate:a,generalProfileIdc:n,generalTierFlag:o,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:h,ptlMultilayerEnabledFlag:l,generalConstraintInfo:f,sublayerLevelIdc:p,generalSubProfileIdc:m,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function w(t){const e=new c.A(t,!0);if(1&e.readUint8()){const i=new n.A;i.appendBuffer(t.subarray(1)),g(i),e.skip(i.getPointer())}let i=[],a=[],r=[];const s=e.readUint8();for(let t=0;t<s;t++){const t=31&e.readUint8();let s=1;13!==t&&12!==t&&(s=e.readUint16());const c=[];for(let t=0;t<s;t++){const t=e.readUint16();c.push(e.readBuffer(t))}14===t?i=c:15===t?a=c:16===t&&(r=c)}return{vpss:i,spss:a,ppss:r}}function U(t,e,i){const a=e[0];let c;if(a){const t=D(a);let e=t.generalConstraintInfo;e.length||(e=new Array(12).fill(0));const i=new f.A;if(i.writeU(9,0),i.writeU(3,t.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,t.chromaFormatIdc),i.writeU(3,t.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,e.length),i.writeU(7,t.profile),i.writeU1(t.tierFlag),i.writeU(8,t.level),i.writeU1(t.ptlFrameOnlyConstraintFlag),i.writeU1(t.ptlMultilayerEnabledFlag),e.length){for(let t=0;t<e.length-1;t++)i.writeU(8,e[t]);i.writeU(6,e[e.length-1])}else i.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let e=0;for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)e=e<<1|t.ptlSublayerLevelPresentFlag[i];i.writeU(t.spsMaxSublayersMinus1,e);for(let e=t.spsMaxSublayersMinus1+1;e<=8&&t.spsMaxSublayersMinus1>0;++e)i.writeU1(0);for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)t.ptlSublayerLevelPresentFlag[e]&&i.writeU(8,t.sublayerLevelIdc[e])}i.writeU(8,t.generalSubProfileIdc.length);for(let e=0;e<t.generalSubProfileIdc.length;e++)i.writeU(8,t.sublayerLevelIdc[e]);i.writeU(16,t.width),i.writeU(16,t.height),i.writeU(16,0),i.padding(),c=i.getBuffer().subarray(0,i.getPointer())}let n=2+(c?c.length:0);t.length&&(n+=3,n=t.reduce(((t,e)=>t+2+e.length),n)),e.length&&(n+=3,n=e.reduce(((t,e)=>t+2+e.length),n)),i.length&&(n+=3,n=i.reduce(((t,e)=>t+2+e.length),n));const o=new Uint8Array(n),d=new s.A(o,!0);d.writeUint8(m<<1|(c?1:0)|248),c&&d.writeBuffer(c);let h=0;return t.length&&h++,e.length&&h++,i.length&&h++,d.writeUint8(h),t.length&&(d.writeUint8(142),d.writeUint16(t.length),r.__(t,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),e.length&&(d.writeUint8(143),d.writeUint16(e.length),r.__(e,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),i.length&&(d.writeUint8(144),d.writeUint16(i.length),r.__(i,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),o}function I(t){let e=d.py(t);if(e.length>=2){const t=[],i=[],a=[];if(e.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&a.push(e)})),i.length&&a.length)return U(t,i,a)}}function v(t){let e=d.py(t);if(e.length>=2){const t=[],i=[],a=[];if(e.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&a.push(e)})),i.length&&a.length){const e=[i[0],a[0]];return t.length&&e.unshift(t[0]),d.nW(e,0)}}}function M(t,e=!1){let i,a=!1,r=d.py(t);if(r.length){const t=[],s=[],c=[];r.forEach((e=>{const i=e[1]>>>3&31;14===i?t.push(e):15===i?s.push(e):16===i&&c.push(e),8!==i&&7!==i&&9!==i&&10!==i||(a=!0)})),s.length&&c.length?(i=U(t,s,c),r=r.filter((t=>{const i=t[1]>>>3&31;return(e||14!==i&&15!==i&&16!==i)&&20!==i}))):r=r.filter((t=>20!=(t[1]>>>3&31)))}const s=r.reduce(((t,e)=>t+m+1+e.length),0),c=(0,h.sY)(s),n=(0,o.s3)(c,s);return d.S9(r,m,n),{bufferPointer:c,length:s,extradata:i,key:a}}function x(t,e,i,a,r){const s=[d.Le(t,0),d.Le(e,0),d.Le(i,0),d.Le(a,2)];let c=s.reduce(((t,e)=>t+e),0);const n=(0,h.sY)(c+7);let l=n;return u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),1),u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),161),u.w8((l+=1,l-1),(r?1:0)<<7|40),t.length&&(d.nW(t,0,(0,o.s3)(l,s[0])),l+=s[0]),e.length&&(d.nW(e,0,(0,o.s3)(l,s[1])),l+=s[1]),i.length&&(d.nW(i,0,(0,o.s3)(l,s[2])),l+=s[2]),a.length&&d.nW(a,2,(0,o.s3)(l,s[3])),{bufferPointer:n,length:c+7}}function b(t,e){let i=d.py(t).concat(d.py(e));if(i.length){let t=[],e=[],a=[],r=[];return i.forEach((i=>{const s=i[1]>>>3&31;14===s?t.push(i):15===s?e.push(i):16===s?a.push(i):20!==s&&r.push(i)})),x(t,e,a,r,!0)}}function k(t,e){const i=e?e[0]>>>1&3:m;let a=[],r=[],s=[],c=!1;if(e){const t=w(e);a=t.vpss,r=t.spss,s=t.ppss,c=!0}return{...x(a,r,s,d.wN(t,i).filter((t=>20!=(t[1]>>>3&31))),c),key:c}}function y(t,e){let i;if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&d.Bs(e))r.__(d.py(e),(t=>{if(15==(t[1]>>>3&31))return i=t,!1}));else if(e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=e[0]>>>1&3;const{spss:a}=w(e);a.length&&(i=a[0])}i&&function(t,e){const{profile:i,level:a,width:r,height:s,videoDelay:c,chromaFormatIdc:n,bitDepthMinus8:o}=D(e);switch(t.codecpar.profile=i,t.codecpar.level=a,t.codecpar.width=r,t.codecpar.height=s,t.codecpar.videoDelay=c,o){case 0:t.codecpar.format=3===n?5:2===n?4:0;break;case 2:t.codecpar.format=3===n?68:2===n?64:62}}(t,i)}function A(t,e=4){if(64&a.f[15](t+36))return d.py((0,o.s3)(a.f[20](t+24),a.f[15](t+28))).some((t=>{const e=t[1]>>>3&31;return 8===e||7===e}));{const i=a.f[15](t+28);let r=0;for(;r<i-e;){const i=p.r8(a.f[20](t+24)+(r+e+1))>>>3&31;if(8===i||7===i)return!0;r+=4===e?p.Sg(a.f[20](t+24)+r):3===e?p.ht(a.f[20](t+24)+r):2===e?p.yd(a.f[20](t+24)+r):p.r8(a.f[20](t+24)+r),r+=e}return!1}}function D(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,a=0,r=0,s=0,c=0,o=1,h=0,f=0,p=0;const u=[],m=[],g=[],w=[],U=d.BN(t.subarray(e)),I=new n.A(U.length);I.appendBuffer(U),I.readU1(),I.readU1(),I.readU(6),I.readU(5),I.readU(3),I.readU(8);const v=I.readU(3);o=I.readU(2);const M=I.readU(2);if(I.readU(1)){if(i=I.readU(7),h=I.readU(1),a=I.readU(8),f=I.readU(1),p=I.readU(1),I.readU(1)){for(let t=0;t<8;t++)u[t]=I.readU(8);u[8]=I.readU(7);const t=I.readU(8);I.readU(t)}I.skipPadding();for(let t=v-1;t>=0;t--)m[t]=I.readU(1);I.skipPadding();for(let t=v-1;t>=0;t--)m[t]&&(g[t]=I.readU(8));const t=I.readU(8);if(t)for(let e=0;e<t;e++)w[e]=I.readU(32)}I.readU1(),I.readU1()&&I.readU1();const x=r=l.xb(I),b=s=l.xb(I);if(I.readU1()&&(l.xb(I),l.xb(I),l.xb(I),l.xb(I)),I.readU1()){const t=l.xb(I),e=M+5,i=1<<e,a=x/(1<<e),r=b/(1<<e),s=Math.ceil(Math.log2(a)),c=Math.ceil(Math.log2(r));let n=0,o=0,d=0;t>0&&(d=I.readU1(),o=I.readU1());for(let e=0;t>0&&e<=t;e++)o&&0!=e||(e>0&&x>i&&I.readU(s),e>0&&b>i&&I.readU(c),e<t&&x>i&&I.readU(s),e<t&&b>i&&I.readU(c)),d||I.readU(2);if(n=l.xb(I)+1,I.readU(1)&&I.readU(1))for(let e=0;e<=t;e++)I.readU(n)}c=l.xb(I),I.readU(1),I.readU(1);const k=I.readU(4),y=I.readU(1);let A=0;y&&(A=l.xb(I));const D=[],S=I.readU(2);for(let t=0;t<8*S;t++)D[t]=I.readU(1);return{profile:i,level:a,width:r,height:s,videoDelay:v+1>2?2:v,chromaFormatIdc:o,bitDepthMinus8:c,generalProfileSpace:0,tierFlag:h,generalConstraintInfo:u,generalSubProfileIdc:w,ptlFrameOnlyConstraintFlag:f,ptlMultilayerEnabledFlag:p,spsMaxSublayersMinus1:v,ptlSublayerLevelPresentFlag:m,sublayerLevelIdc:g,sps_log2_max_pic_order_cnt_lsb_minus4:k,sps_poc_msb_cycle_flag:y,sps_poc_msb_cycle_len_minus1:A,sps_num_extra_ph_bytes:S,sps_extra_ph_bit_present_flag:D}}function S(t){d.Bs(t)&&(t=I(t));const e=new n.A;return e.appendBuffer(t),1&e.readU(8)?g(e):{}}},73040:(t,e,i)=>{i.d(e,{$x:()=>n,bD:()=>o});var a=i(67672),r=i(72739),s=i(95335);async function c(t,e){return{key:await t.readString(await t.readUint16()),value:await n(t,e)}}async function n(t,e){let i;switch(await t.readUint8()){case 0:i=await t.readDouble();break;case 1:i=!!await t.readUint8();break;case 2:i=await t.readString(await t.readUint16());break;case 3:for(i={};t.getPos()<e;){const{key:a,value:r}=await c(t,e);if(i[a]=r,9==(16777215&await t.peekUint24())){await t.skip(3);break}}break;case 8:for(i={},await t.skip(4);t.getPos()<e;){const{key:a,value:r}=await c(t,e);if(i[a]=r,9==(16777215&await t.peekUint24())){await t.skip(3);break}}break;case 9:case 5:i=null;break;case 10:i=[];const a=await t.readUint32();for(let r=0;r<a;r++)i.push(await n(t,e));break;case 11:const r=await t.readDouble(),s=await t.readInt16();i=new Date(r+60*s*1e3);break;case 12:i=await t.readString(await t.readUint32())}return i}function o(t,e){a.ai(e)?(t.writeUint8(0),t.writeDouble(e)):a.o(e)?(t.writeUint8(0),t.writeDouble(Number(e))):a.zM(e)?(t.writeUint8(1),t.writeUint8(e?1:0)):a.Yj(e)?e.length>=65536?(t.writeUint8(12),t.writeUint32(e.length),t.writeString(e)):(t.writeUint8(2),t.writeUint16(e.length),t.writeString(e)):a.YO(e)?(t.writeUint8(10),t.writeUint32(e.length),r.__(e,(e=>{o(t,e)}))):a.Ik(e)?(t.writeUint8(3),s.__(e,((e,i)=>{t.writeUint16(i.length),t.writeString(i),o(t,e)})),t.writeUint24(9)):e instanceof Date?(t.writeUint8(11),t.writeDouble(e.getTime()),t.writeInt16(0)):null==e&&t.writeUint8(5)}}}]);