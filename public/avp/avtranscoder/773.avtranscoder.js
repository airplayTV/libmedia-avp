"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[773],{28773:(e,t,a)=>{a.r(t),a.d(t,{default:()=>z});var i=a(134),r=a(14686),o=a(61499),n=a(63939),s=a(50932),d=(a(9599),a(58121)),c=a(68243),l=a(4624),h=a(35028),f=a(62815),p=a(95832),u=a(67659),m=a(59166),g=a(21477),w=a(82014),U=a(97077),I=a(14769),R=a(22576),v=a(87518),k=a(64093),M=a(9705),b=a(85947),B=a(37837),y=a(71517),A=a(65977),D=a(44328),x=a(77231),C=a(72739),P=a(52071),S=a(34677),L=a(73040),T=(a(55833),a(99991)),F=a(67672);const N="src\\avformat\\formats\\IFlvFormat.ts";class z extends b.A{constructor(e={}){super(),(0,i.A)(this,"type",0),(0,i.A)(this,"header",void 0),(0,i.A)(this,"script",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"firstTagPos",void 0),this.header=new d.A,this.script=new c.A,this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0)}async readHeader(e){try{if("FLV"!==await e.ioReader.peekString(3))return l.z3("the file format is not flv",N,118),M.LR;await this.header.read(e.ioReader),0!==await e.ioReader.readUint32()&&l.R8("the previousTagSize0 is not 0",N,125);let t=0;if(18===await e.ioReader.peekUint8()){await e.ioReader.skip(1);const a=await e.ioReader.readUint24();await e.ioReader.skip(7),t=await this.script.read(e.ioReader,a)}return t>=0&&(this.firstTagPos=e.ioReader.getPos()),t}catch(t){return l.z3(t.message,N,143),e.ioReader.error}}async readModEx(e,t,a){let i=await e.ioReader.readUint8()+1;256===i&&(i=await e.ioReader.readUint16()+1);const r=await e.ioReader.readBuffer(i),o=await e.ioReader.readUint8(),d=240&o;if(0===d&&0===a||0===d&&1===a){let e=0;3===r.length?(e=r[0]<<16|r[1]<<8|r[2],this.options.useNanoTimestamp?s.M[17](t+16,n.f[17](t+16)+BigInt(e)):s.M[17](t+16,n.f[17](t+16)+BigInt(e)/BigInt(1e6)),s.M[17](t+8,n.f[17](t+16))):l.R8(`Invalid ModEx size for Type TimestampOffsetNano!, need 3 but got ${r.length}`,N,176)}else l.R8(`unknown ModEx type: ${d}`,N,180);return 15&o}async readCodecConfigurationRecord(e,t,a,i){const o=(0,B.sY)(i);t.codecpar.extradata?((0,y.Ow)(a,1,o,i),await e.ioReader.readBuffer(i,(0,r.JW)(o,i))):(t.codecpar.extradata=o,t.codecpar.extradataSize=i,await e.ioReader.readBuffer(i,(0,r.JW)(o,i)),t.sideData[1]=(0,r.s3)(o,i).slice(),27===t.codecpar.codecId?f.XC(t):173===t.codecpar.codecId?u.XC(t):196===t.codecpar.codecId?m.XC(t):225===t.codecpar.codecId?g.XC(t):167===t.codecpar.codecId?w.XC(t):139===t.codecpar.codecId?U.XC(t):86018===t.codecpar.codecId?p.XC(t):86028===t.codecpar.codecId?I.XC(t):86076===t.codecpar.codecId&&R.XC(t))}async readAVPacketData(e,t,a,i){const o=(0,B.sY)(i);(0,y.NX)(a,o,i),await e.ioReader.readBuffer(i,(0,r.JW)(o,i))}parseColorInfo(e,t,a){let i=!1,r=!1;if(a.hdrMdcv&&(i=a.hdrMdcv.redX>0&&a.hdrMdcv.redY>0&&a.hdrMdcv.blueX>0&&a.hdrMdcv.blueY>0&&a.hdrMdcv.greenX>0&&a.hdrMdcv.greenY>0&&a.hdrMdcv.whitePointX>0&&a.hdrMdcv.whitePointY>0,r=a.hdrMdcv.maxLuminance>0&&a.hdrMdcv.minLuminance>0),3!==a.colorConfig.matrixCoefficients&&(e.codecpar.colorSpace=a.colorConfig.matrixCoefficients),3!==a.colorConfig.colorPrimaries&&0!==a.colorConfig.colorPrimaries&&(e.codecpar.colorPrimaries=a.colorConfig.colorPrimaries),3!==a.colorConfig.transferCharacteristics&&0!==a.colorConfig.transferCharacteristics&&(e.codecpar.colorTrc=a.colorConfig.transferCharacteristics),a.hdrCll&&a.hdrCll.maxCLL&&a.hdrCll.maxFall){const n=(0,B.Gy)(8);s.M[8](n,a.hdrCll.maxCLL),s.M[8](n+4,a.hdrCll.maxFall),(0,y.sn)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,22)?(0,y.Ow)(t,22,n,8):(0,y.$W)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,22,n,8)}if(r||i){const d=(0,B.Gy)(88);function c(e,t){const a=(0,D.j2)(t,x.go);s.M[15](e+4,a.den),s.M[15](e,a.num)}r&&(s.M[15](d+84,1),c(d+72,a.hdrMdcv.maxLuminance),c(d+64,a.hdrMdcv.minLuminance)),i&&(s.M[15](d+80,1),c(d,a.hdrMdcv.redX),c(d+8,a.hdrMdcv.redY),c(d+16,a.hdrMdcv.greenX),c(d+16+8,a.hdrMdcv.greenY),c(d+32,a.hdrMdcv.blueX),c(d+32+8,a.hdrMdcv.blueY)),(0,y.sn)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,20)?(0,y.Ow)(t,20,d,88):(0,y.$W)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,20,d,88)}}findStream(e,t,a){for(let i=0;i<e.streams.length;i++)if(e.streams[i].codecpar.codecType===t){const t=e.streams[i].privData;if(t&&t.trackId===a)return e.streams[i]}}createStream(e,t,a,i){var r;const o=e.createStream();o.codecpar.codecType=t,o.timeBase.den=this.options.useNanoTimestamp?x.H3:x.qs,o.timeBase.num=1,o.startTime=n.f[17](a+8);const s={trackId:i};var d,c,l;if(o.privData=s,null!==(r=this.script.onMetaData)&&void 0!==r&&r.duration&&(o.duration=(0,D.k)(BigInt(Math.floor(1e3*this.script.onMetaData.duration)),x.i0,o.timeBase)),0===t)(null===(d=this.script.onMetaData)||void 0===d?void 0:d.width)>0&&(o.codecpar.width=this.script.onMetaData.width),(null===(c=this.script.onMetaData)||void 0===c?void 0:c.height)>0&&(o.codecpar.height=this.script.onMetaData.height),null!==(l=this.script.onMetaData)&&void 0!==l&&null!==(l=l.videoTrackIdInfoMap)&&void 0!==l&&l[i]&&(this.script.onMetaData.videoTrackIdInfoMap[i].title&&(o.metadata.title=this.script.onMetaData.videoTrackIdInfoMap[i].title),this.script.onMetaData.videoTrackIdInfoMap[i].lang&&(o.metadata.language=this.script.onMetaData.videoTrackIdInfoMap[i].lang),this.script.onMetaData.videoTrackIdInfoMap[i].width>0&&(o.codecpar.width=this.script.onMetaData.videoTrackIdInfoMap[i].width),this.script.onMetaData.videoTrackIdInfoMap[i].height>0&&(o.codecpar.height=this.script.onMetaData.videoTrackIdInfoMap[i].height),this.script.onMetaData.videoTrackIdInfoMap[i].duration>0&&(o.duration=(0,D.k)(BigInt(1e3*this.script.onMetaData.videoTrackIdInfoMap[i].duration),x.i0,o.timeBase)));else if(1===t){var h;null!==(h=this.script.onMetaData)&&void 0!==h&&null!==(h=h.audioTrackIdInfoMap)&&void 0!==h&&h[i]&&(this.script.onMetaData.audioTrackIdInfoMap[i].title&&(o.metadata.title=this.script.onMetaData.audioTrackIdInfoMap[i].title),this.script.onMetaData.audioTrackIdInfoMap[i].lang&&(o.metadata.language=this.script.onMetaData.audioTrackIdInfoMap[i].lang),this.script.onMetaData.audioTrackIdInfoMap[i].duration>0&&(o.duration=(0,D.k)(BigInt(1e3*this.script.onMetaData.audioTrackIdInfoMap[i].duration),x.i0,o.timeBase)))}return this.onStreamAdd&&this.onStreamAdd(o),o}async readAVPacket_(e,t){const a=e.ioReader.getPos();s.M[17](t+56,a);let i=!1;const d=31&await e.ioReader.readUint8();let c=await e.ioReader.readUint24(),f=await e.ioReader.readUint24();const p=await e.ioReader.readUint8();if(p&&(f|=p<<24),s.M[17](t+16,this.options.useNanoTimestamp?(0,D.k)(BigInt(Math.floor(f)),x.i0,x.FQ):BigInt(Math.floor(f))),s.M[17](t+8,n.f[17](t+16)),await e.ioReader.skip(3),8===d){s.M[15](t+36,1|n.f[15](t+36));const d=await e.ioReader.readUint8();c--;const f=(240&d)>>4;if(9===f){let h=!1,f=15&d;for(;7===f;){let a=e.ioReader.getPos();f=await this.readModEx(e,t,1),c-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let p=0,u=0;if(5===f){h=!0;const t=await e.ioReader.readUint8();c--,u=(240&t)>>4,f=15&t,2!==u&&(p=await e.ioReader.readUint32(),c-=4)}else p=await e.ioReader.readUint32(),c-=4;let m=t;for(;;){let d=c,g=0;h&&(2===u&&(p=await e.ioReader.readUint32(),c-=4),g=await e.ioReader.readUint8(),c--,0!==u?(d=await e.ioReader.readUint24(),c-=3):d=c);let w=this.findStream(e,1,g);if(w||(w=this.createStream(e,1,m,g),p===(0,A.A)("ac-3")?w.codecpar.codecId=86019:p===(0,A.A)("ec-3")?w.codecpar.codecId=86056:p===(0,A.A)("Opus")?(w.codecpar.codecId=86076,w.codecpar.sampleRate=48e3):p===(0,A.A)(".mp3")?w.codecpar.codecId=86017:p===(0,A.A)("fLaC")?w.codecpar.codecId=86028:p===(0,A.A)("mp4a")?w.codecpar.codecId=86018:(l.R8(`unknown codec fourcc(${p.toString(16)})`,N,509),w.codecpar.codecId=0)),s.M[15](m+32,w.index),c-=d,4===f){const t=await e.ioReader.readUint8(),a=await e.ioReader.readUint8();if(d-=2,(0,T.bl)(w.codecpar[o.o9]+112),2===t){(0,T.xY)(w.codecpar[o.o9]+112,a);for(let t=0;t<a;t++){const a=await e.ioReader.readUint8();d--,a<18?s.M[15](w.codecpar.chLayout.u.map+24*t,a):a>=18&&a<=23?s.M[15](w.codecpar.chLayout.u.map+24*t,a-18+35):254===a?s.M[15](w.codecpar.chLayout.u.map+24*t,512):s.M[15](w.codecpar.chLayout.u.map+24*t,768)}}else if(1===t){let t=BigInt(await e.ioReader.readUint32());d-=4,t=t&BigInt(262143)|(t&BigInt(16515072))<<BigInt(35)-BigInt(18),(0,T.ML)(w.codecpar[o.o9]+112,t)}i=!0}else if(0===f)d?(await this.readCodecConfigurationRecord(e,w,m,d),d=0,i=!1,(0,y.fQ)(t,1)||(i=!0)):i=!0;else if(2===f)s.M[15](m+36,32|n.f[15](m+36)),i=!1;else if(1===f){if(await this.readAVPacketData(e,w,m,d),(86019===w.codecpar.codecId||86056===w.codecpar.codecId||86017===w.codecpar.codecId)&&w.codecpar.sampleRate===x.N_)if(86019===w.codecpar.codecId||86056===w.codecpar.codecId){const e=v.R((0,y.iI)(m));F.ai(e)||(w.codecpar.sampleRate=e.sampleRate,w.codecpar.chLayout.nbChannels=e.channels,w.codecpar.bitrate=BigInt(e.bitrate))}else 86017===w.codecpar.codecId&&k.XC(w,(0,y.iI)(m));i=!1,d=0}else l.R8(`invalid audioPacketType ${f}`,N,591);if(d&&await e.ioReader.skip(d),m===t||i||e.interval.packetBuffer.push(m),!h||0===u||!c)break;m=(0,y._5)(),s.M[17](m+56,a),(0,r.Mr)(m+72,t+72,8),s.M[17](m+16,n.f[17](t+16)),s.M[17](m+8,n.f[17](t+8)),s.M[15](m+36,1|n.f[15](m+36))}}else{let a=this.findStream(e,1,0);if(!a){if(a=this.createStream(e,1,t,0),a.disposition|=1,a.codecpar.chLayout.nbChannels=1&~d?1:2,a.codecpar.sampleRate=44100<<((12&d)>>>2)>>3,a.codecpar.bitsPerCodedSample=2&d?16:8,0===f)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else if(3===f)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else{var u;a.codecpar.codecId=null!==(u=h.FJ[f])&&void 0!==u?u:0}86051===a.codecpar.codecId?(a.codecpar.sampleRate=16e3,a.codecpar.chLayout.nbChannels=1):65543!==a.codecpar.codecId&&65542!==a.codecpar.codecId||(a.codecpar.sampleRate=8e3)}s.M[15](t+32,a.index),86018===a.codecpar.codecId&&(c--,0===await e.ioReader.readUint8()&&(this.readCodecConfigurationRecord(e,a,t,c),c=0,(0,y.fQ)(t,1)||(i=!0))),c&&(await this.readAVPacketData(e,a,t,c),c=0)}}else if(9===d){const o=await e.ioReader.readUint8(),d=128&o,f=(112&o)>>4;if(c--,1===f&&s.M[15](t+36,1|n.f[15](t+36)),d){let d=!0,h=!1,p=15&o;for(;7===p;){let a=e.ioReader.getPos();p=await this.readModEx(e,t,0),c-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let u=0,m=0;if(4!==p&&5===f)d=!1,i=!0;else if(6===p){h=!0;const t=await e.ioReader.readUint8();c--,m=(240&t)>>4,p=15&t,2!==m&&(u=await e.ioReader.readUint32(),c-=4)}else u=await e.ioReader.readUint32(),c-=4;let g=t;for(;d;){let o=c,d=0;h&&(2===m&&(u=await e.ioReader.readUint32(),c-=4),d=await e.ioReader.readUint8(),c--,0!==m?(o=await e.ioReader.readUint24(),c-=3):o=c);let w=this.findStream(e,0,d);if(w||(w=this.createStream(e,0,g,d),u===(0,A.A)("avc1")?w.codecpar.codecId=27:u===(0,A.A)("hvc1")?w.codecpar.codecId=173:u===(0,A.A)("vvc1")?w.codecpar.codecId=196:u===(0,A.A)("av01")?w.codecpar.codecId=225:u===(0,A.A)("vp09")?w.codecpar.codecId=167:u===(0,A.A)("vp08")&&(w.codecpar.codecId=139)),s.M[15](g+32,w.index),c-=o,4===p){const t=e.ioReader.getPos()+BigInt(Math.floor(o)),a=await L.$x(e.ioReader,t),r=await L.$x(e.ioReader,t);"colorInfo"===a?this.parseColorInfo(w,g,r):l.R8(`unknown metadata key ${a}`,N,768),e.ioReader.getPos()<t&&await e.ioReader.seek(t),i=!0,o=0}else if(0===p)o?(await this.readCodecConfigurationRecord(e,w,g,o),o=0,i=!1,(0,y.fQ)(t,1)||(i=!0)):i=!0;else if(2===p)s.M[15](g+36,32|n.f[15](g+36)),i=!1;else if(5===p)225===w.codecpar.codecId?(await this.readCodecConfigurationRecord(e,w,g,o-2),i=!1,o=0,(0,y.fQ)(t,1)||(i=!0)):i=!0;else if(1===p||3===p){if(1===p&&(173===w.codecpar.codecId||196===w.codecpar.codecId||27===w.codecpar.codecId)){const a=await e.ioReader.readInt24();s.M[17](g+8,n.f[17](g+16)+(this.options.useNanoTimestamp?(0,D.FP)(BigInt(0|a),x.i0,t+72):BigInt(0|a))),o-=3}await this.readAVPacketData(e,w,g,o),o=0,i=!1}else l.R8(`invalid videoPacketType ${p}`,N,827);if(o&&await e.ioReader.skip(o),i||g===t||e.interval.packetBuffer.push(g),!h||0===m||!c)break;g=(0,y._5)(),s.M[17](g+56,a),(0,r.Mr)(g+72,t+72,8),s.M[17](g+16,n.f[17](t+16)),s.M[17](g+8,n.f[17](t+8)),1===f&&s.M[15](g+36,1|n.f[15](g+36))}}else if(5!==f){let a=this.findStream(e,0,0);var m;if(a||(a=this.createStream(e,0,t,0),a.disposition|=1,a.codecpar.codecId=null!==(m=h.U5[15&o])&&void 0!==m?m:0),s.M[15](t+32,a.index),27===a.codecpar.codecId||173===a.codecpar.codecId||196===a.codecpar.codecId||12===a.codecpar.codecId){const r=await e.ioReader.readUint8(),o=await e.ioReader.readInt24();c-=4,s.M[17](t+8,n.f[17](t+16)+(this.options.useNanoTimestamp?(0,D.FP)(BigInt(0|o),x.i0,t+72):BigInt(0|o))),0===r?(await this.readCodecConfigurationRecord(e,a,t,c),(0,y.fQ)(t,1)||(i=!0)):2===r?s.M[15](t+36,32|n.f[15](t+36)):await this.readAVPacketData(e,a,t,c)}else await this.readAVPacketData(e,a,t,c);c=0}else i=!0}else{if(18===d){let a=await this.script.read(e.ioReader,c);return a<0?a:await this.readAVPacket_(e,t)}if(15!==d)return l.R8(`invalid tag type: ${d}, try to sync to next tag`,N,913),await this.syncTag(e),this.readAVPacket_(e,t);l.R8("not support script tag encoded by amf3, ignore it",N,910)}c&&await e.ioReader.skip(c);const g=e.ioReader.getPos()-a,w=BigInt(Math.floor(await e.ioReader.readUint32()));return g!==w?(l.R8(`tag ${d} size not match, size: ${g}, previousTagSize: ${w}`,N,926),M.LR):i?this.readAVPacket_(e,t):0}async readAVPacket(e,t){try{return s.M[15](t+76,this.options.useNanoTimestamp?x.H3:x.qs),s.M[15](t+72,1),await this.readAVPacket_(e,t)}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(l.z3(`read packet error, ${t}`,N,946),M.LR):e.ioReader.error}}async syncTag(e){let t=x.Dh;for(;;)try{if(8&e.ioReader.flags)break;const a=await e.ioReader.readUint8();if(8===a||9===a){t=e.ioReader.getPos()-BigInt(1);const a=await e.ioReader.readUint24();if(a>10485760){await e.ioReader.seek(t+BigInt(1));continue}if(await e.ioReader.skip(4),0!==await e.ioReader.readUint24()){await e.ioReader.seek(t+BigInt(1));continue}await e.ioReader.skip(a);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32()))){await e.ioReader.seek(t+BigInt(1)),t=x.Dh;continue}{let a=0;for(;a<=3;){const t=e.ioReader.getPos(),i=await e.ioReader.readUint8();if(8!==i&&9!==i&&18!==i)break;{const i=await e.ioReader.readUint24();await e.ioReader.skip(7+i);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32())))break;a++}}if(!(a<3))break;await e.ioReader.seek(t+BigInt(1)),t=x.Dh}}}catch(e){break}t!==x.Dh&&await e.ioReader.seek(t)}async seek(e,t,a,i){const r=e.ioReader.getPos();if(2&i)return await e.ioReader.seek(a),4&i||await this.syncTag(e),r;if(t&&t.sampleIndexes.length){let i=C.El(t.sampleIndexes,(e=>e.pts>a?-1:1));if(i>0&&(0,D.k)(a-t.sampleIndexes[i-1].pts,t.timeBase,x.i0)<BigInt(1e4))return l.Yz(`seek in sampleIndexes, found index: ${i}, pts: ${t.sampleIndexes[i-1].pts}, pos: ${t.sampleIndexes[i-1].pos}`,N,1053),await e.ioReader.seek(t.sampleIndexes[i-1].pos),r}if(this.script.canSeek()){const{pos:i,dts:o}=this.script.dts2Position(Number((0,D.k)(a,t.timeBase,x.i0)/BigInt(1e3)));if(i>0){l.Yz(`seek in filepositions, found pts: ${o}, pos: ${i}`,N,1062),await e.ioReader.seek(BigInt(Math.floor(i)));const t=await e.ioReader.peekUint8();return 8!==t&&9!==t&&18!==t&&await this.syncTag(e),r}}return l.Yz("not found any keyframe index, try to seek in bytes",N,1072),(0,P.A)(e,t,a,this.firstTagPos,this.readAVPacket.bind(this),this.syncTag.bind(this))}getAnalyzeStreamsCount(){let e=0;return(this.header.hasAudio||(0,S.A)(this.script.onMetaData.audiocodecid))&&e++,(this.header.hasVideo||(0,S.A)(this.script.onMetaData.videocodecid))&&e++,e}}},85947:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(134);class r{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},58121:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(134);class r{constructor(){(0,i.A)(this,"signature",void 0),(0,i.A)(this,"version",void 0),(0,i.A)(this,"flags",void 0),(0,i.A)(this,"dataOffset",void 0),(0,i.A)(this,"hasVideo",void 0),(0,i.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(e){this.signature=await e.readString(3),this.version=await e.readUint8(),this.flags=await e.readUint8(),this.dataOffset=await e.readUint32(),this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags)}write(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(this.flags),e.writeUint32(this.dataOffset)}}},68243:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(134),r=a(35336),o=a(92647),n=a(4624),s=a(94889),d=a(9705),c=a(73040);class l{constructor(){(0,i.A)(this,"onMetaData",void 0),this.onMetaData={canSeekToEnd:!1}}async read(e,t){const a=e.getPos(),i=a+BigInt(Math.floor(t)),r=await(0,c.$x)(e,i),o=await(0,c.$x)(e,i);this[r]=o,i>e.getPos()&&await e.skip(Number(BigInt.asIntN(32,i-e.getPos())));const s=Number(e.getPos()-a),l=await e.readUint32();return s+11!==l?(n.R8(`script size not match, size: ${s+11}, previousTagSize: ${l}`,"src\\avformat\\formats\\flv\\FlvScriptTag.ts",63),d.LR):0}computeSize(){const e=[],t=new r.A;return t.onFlush=t=>(e.push(t.slice()),0),(0,c.bD)(t,"onMetaData"),(0,c.bD)(t,this.onMetaData),t.flush(),(0,o.A)(Uint8Array,e).length}write(e){if(this.onMetaData){const t=[],a=new r.A;a.onFlush=e=>(t.push(e.slice()),0),(0,c.bD)(a,"onMetaData"),(0,c.bD)(a,this.onMetaData),a.flush();const i=(0,o.A)(Uint8Array,t);s.M5(e,18,BigInt(0),void 0,i)}}dts2Position(e){if(this.canSeek()){let t=-1;const a=this.onMetaData.keyframes.times,i=this.onMetaData.keyframes.filepositions;let r;for(r=0;r<a.length;r++){if(a[r]===e){t=r;break}if(a[r]>e){t=Math.max(r-1,0);break}}return r&&r===a.length&&(t=a.length-1),{pos:i[t],dts:a[t]}}return{pos:-1,dts:-1}}position2DTS(e){if(this.canSeek()){let a=-1;const i=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let o=0;for(o=0;o<r.length;o++)if(r[o]>e){a=o;break}var t;return o===r.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:i[i.length-1]:i[a]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},35028:(e,t,a)=>{a.d(t,{FJ:()=>r,FV:()=>i,Tf:()=>n,U5:()=>o});const i={65541:0,65536:3,86018:10,86017:2,86051:11,69645:1,86049:6,65543:7,65542:8,27:7,173:12,12:9,4:2,86:3,92:4,106:5,131:6},r={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},o={7:27,12:173,9:12,2:4,3:86,4:92,5:106,6:131},n={27:"avc1",173:"hvc1",196:"vvc1",139:"vp08",167:"vp09",225:"av01",86019:"ac-3",86056:"ec-3",86076:"Opus",86028:"fLaC",86017:".mp3",86018:"mp4a"}},94889:(e,t,a)=>{a.d(t,{C$:()=>l,M5:()=>c,Q4:()=>h,zk:()=>f});var i=a(35028),r=a(44328),o=a(77231),n=a(65977),s=a(67672);function d(e,t,a){const i=e.getPos(),r=e.getPointer(),o=i-BigInt(Math.floor(r));t<i&&t>=o?(e.seekInline(r+Number(t-i)),e.writeUint24(a),e.seekInline(r)):(e.seek(t),e.writeUint24(a),e.seek(i))}function c(e,t,a,i,r,o){e.flush(),e.writeUint8(t);const n=e.getPos();e.writeUint24(0),e.writeUint24(Number(a&BigInt(16777215))),e.writeUint8(Number(a>>BigInt(24)&BigInt(255))),e.writeUint24(0);const c=e.getPos();i&&i(e),s.Pc(r)?(r(e),d(e,n,Number(e.getPos()-c))):r&&(d(e,n,r.length+Number(e.getPos()-c)),e.writeBuffer(r));const l=Number(e.getPos()-n)+1;o&&o(l),e.writeUint32(l)}function l(e){return 86018!==e&&27!==e&&86017!==e&&12!==e&&!!i.Tf[e]}function h(e,t,a,s,d,c,l,h,f=0){const p=t.privData;let u=s?128:0;if(u|=(1&c?1:2)<<4,s){if(a.enableNanoTimestamp&&h){const t=(0,r.Mr)(l,h,o.FQ)-(0,r.Mr)(l,h,o.i0)*BigInt(1e6);t&&(u|=7,e.writeUint8(u),e.writeUint8(2),e.writeUint24(Number(BigInt.asIntN(32,t))),u=0)}a.multiVideoTracks&&(u|=6,e.writeUint8(u),u=0),u|=d,e.writeUint8(u),e.writeUint32((0,n.A)(i.Tf[t.codecpar.codecId])),a.multiVideoTracks&&e.writeUint8(p.trackId),1===d&&e.writeInt24(f)}else u|=15&i.FV[t.codecpar.codecId],e.writeUint8(u),27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId&&12!==t.codecpar.codecId||(e.writeUint8(d),e.writeInt24(f))}function f(e,t,a,s,d,c,l){const h=t.privData;let f=(s?9:15&i.FV[t.codecpar.codecId])<<4;if(s){if(a.enableNanoTimestamp){const t=(0,r.Mr)(c,l,o.FQ)-(0,r.Mr)(c,l,o.i0)*BigInt(1e6);t&&(f|=7,e.writeUint8(f),e.writeUint8(2),e.writeUint24(Number(BigInt.asIntN(32,t))),f=0)}a.multiVideoTracks&&(f|=5,e.writeUint8(f),f=0),f|=d,e.writeUint8(f),e.writeUint32((0,n.A)(i.Tf[t.codecpar.codecId])),a.multiVideoTracks&&e.writeUint8(h.trackId)}else(86018===t.codecpar.codecId||t.codecpar.chLayout.nbChannels>1)&&(f|=1),65541!==t.codecpar.codecId&&(f|=2),86018===t.codecpar.codecId||t.codecpar.sampleRate>=44e3?f|=12:t.codecpar.sampleRate>=22e3?f|=8:t.codecpar.sampleRate>=11e3&&(f|=4),e.writeUint8(f),86018===t.codecpar.codecId&&e.writeUint8(d)}},2187:(e,t,a)=>{a.d(t,{d:()=>n});var i=a(72739),r=a(44328),o=a(77231);function n(e,t,a){let n=BigInt(0);return i.__(e,(e=>{n+=e.codecpar.bitrate*(0,r.k)(t,a,o.i0)/BigInt(8e3)})),n}},65977:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(4624);const r="src\\avformat\\function\\mktag.ts";function o(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,r,30);let t=0;for(let a=0;a<4;a++)t=t<<8|e.charCodeAt(a);return t}},52071:(e,t,a)=>{a.d(t,{A:()=>h});var i=a(63939),r=(a(9599),a(77231)),o=a(44328),n=a(2187),s=a(71517),d=a(9705),c=a(4624);const l="src\\avformat\\function\\seekInBytes.ts";async function h(e,t,a,h,f,p){const u=e.ioReader.getPos(),m=await e.ioReader.fileSize();let g=r.Dh,w=a;t.startTime!==r.Dh?w-=t.startTime:w-=t.firstDTS;const U=(0,o.k)(a,t.timeBase,r.i0);if(U<BigInt(1e4))return c.Yz(`seek pts is earlier then 10s, seek to first packet pos(${h}) directly`,l,63),await e.ioReader.seek(h),u;let I=(0,n.d)(e.streams,w,t.timeBase);const R=m-(0,n.d)(e.streams,BigInt(1e4),r.i0),v=(0,n.d)(e.streams,BigInt(1e4),r.i0);if(I>R&&(I=R),I<h)return await e.ioReader.seek(h),u;const k=(0,s._5)();let M=m,b=BigInt(0);e:for(;M-b<v&&(I=b),await e.ioReader.seek(I),await p(e),!(8&e.ioReader.flags);){let a=await f(e,k),n=i.f[17](k+56);if(!(a>=0)){g=r.Dh;break}{const d=(0,o.Mr)(i.f[17](k+8),k+72,r.i0);let h=d-U;if(c.Yz(`try to seek to pos: ${I}, got packet pts: ${i.f[17](k+8)}(${d}ms), diff: ${h}ms`,l,100),h<=BigInt(0)&&-h<BigInt(1e4)||M-b<v){const d=[n];for(;h<=0;){if(i.f[15](k+32)===t.index&&1&i.f[15](k+36)&&d.push(n),(0,s.Up)(k),a=await f(e,k),a<0){if(-1048576===a)break;if(-1048575===a)continue;g=r.Dh;break e}n=i.f[17](k+56),h=(0,o.Mr)(i.f[17](k+8),k+72,r.i0)-U}g=d.pop();break}h>BigInt(0)?(M=I,I=b+M>>BigInt(1)):(b=I,I=b+M>>BigInt(1))}if(8&e.ioReader.flags)break}return(0,s.Qe)(k),g!==r.Dh?(c.Yz(`finally seek to pos ${g}`,l,155),await e.ioReader.seek(g),await p(e),u):(await e.ioReader.seek(u),8&e.ioReader.flags?BigInt(d.LT):BigInt(d.E$))}},95832:(e,t,a)=>{a.d(t,{Bq:()=>f,Hm:()=>n,Ij:()=>h,XC:()=>l,_5:()=>c,f7:()=>p,uF:()=>o});var i=a(77231),r=a(37246);const o={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],d=[i.N_,1,2,3,4,5,6,7];function c(e){let t=i.N_,a=i.N_,r=i.N_;return e.length>=2&&(t=e[0]>>3&31,a=s[(7&e[0])<<1|e[1]>>7],r=d[e[1]>>3&15]),{profile:t,sampleRate:a,channels:r}}function l(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:i,channels:r}=c(t);e.codecpar.profile=a,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=r,e.codecpar.frameSize=5===a?2048:1024,e.codecpar.format=8}}function h(e){const t=n[e.sampleRate],a=e.chLayout.nbChannels,r=e.profile===i.N_?2:e.profile,o=new Uint8Array(2);return o[0]=(31&r)<<3|(14&t)>>1,o[1]=(1&t)<<7|(15&a)<<3,o}function f(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],i=(192&e[2])>>>6,r=(60&e[2])>>>2,o=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,c=3&e[6];let l=1===a?7:9,h=n-l;return{syncWord:t,profile:i+1,sampleRate:s[r],channels:d[o],aacFrameLength:n,numberOfRawDataBlocksInFrame:c,headerLength:l,framePayloadLength:h}}function p(e,t){function a(){const e=t.readU(2);let a=0;for(let i=0;i<=e;i++)a<<=8,a|=t.readU(8);return a}t||(t=new r.A).appendBuffer(e);const i=t.getPointer(),o={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;o.syncWord=n,o.muxLengthBytes=t.readU(13);const c=1===t.readU1();if(o.useSameStreamMux=c,!c){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let i=e?a():0;const r=t.readU(5);i-=5;const n=t.readU(4);i-=4;const c=t.readU(4);if(i-=4,t.readU(3),i-=3,i>0&&t.readU(i),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),o.profile=r+1,o.sampleRate=s[n],o.channels=d[c]}let l=0;for(;;){const e=t.readU(8);if(l+=e,255!==e)break}return o.framePayloadLength=l,o.headerLength=t.getPointer()-i+(8===t.getBitLeft()?0:1),o}},87518:(e,t,a)=>{a.d(t,{R:()=>p,j:()=>r});var i=a(37246);const r=[3,4,3,7,259,263,1539,1543],o=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],s=[4,6,7,6],d=[48e3,44100,32e3,0],c=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],h=[1,2,3,6],f=7;function p(e){const t=new i.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=n[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=s[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=d[a.srCode]>>a.srShift,a.bitrate=1e3*c[a.ac3BitrateCode]>>a.srShift,a.channels=l[a.channelMode]+a.lfeOn,a.frameSize=2*o[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<f)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=d[e]/2,a.srShift=1}else a.numBlocks=h[t.readU(2)],a.sampleRate=d[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=l[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(r[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},21477:(e,t,a)=>{a.d(t,{Ui:()=>p,XC:()=>f,Yj:()=>u,k9:()=>h,zk:()=>d});var i=a(63939),r=a(37246),o=a(11573),n=a(83314),s=a(97317);const d={0:"Main",1:"High",2:"Professional"},c=[{level:20,maxResolution:2359296},{level:21,maxResolution:4460544},{level:30,maxResolution:10653696},{level:31,maxResolution:17040384},{level:40,maxResolution:21233664},{level:41,maxResolution:21233664},{level:50,maxResolution:35651584},{level:51,maxResolution:35651584},{level:52,maxResolution:35651584},{level:53,maxResolution:35651584},{level:60,maxResolution:142606336},{level:61,maxResolution:142606336},{level:62,maxResolution:142606336},{level:63,maxResolution:142606336}],l=[20,21,22,23,30,31,32,33,40,41,42,43,50,51,52,53,60,61,62,63,70,71,72,73];function h(e,t,a){const i=e*t;for(const e of c)if(i<=e.maxResolution)return e.level}function f(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const a=p(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function p(e){const t=new r.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const a=t.readU(3),i=t.readU(5),o=t.readU1();let n=t.readU1()?10:8;return t.readU1()&&(n=12),{profile:a,level:i,tier:o,bitDepth:n,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}function u(e,t){const a=new n.A(4);a.writeU1(1),a.writeU(7,1);const d=function(e){const t=new r.A;t.appendBuffer(e);const a=[];for(;t.remainingLength();){const i=t.getPointer();t.readU1(),t.readU(4);const r=t.readU1(),n=t.readU1();t.readU1(),r&&t.readU(8);const s=n?o.v(t):e.length-1-r,d=t.getPointer()-i;a.push(e.subarray(i,i+d+s)),t.skip(8*s)}return a}(t).find((e=>1==(e[0]>>>3&15)));if(d){const e=function(e){const t=new r.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(4);const a=t.readU1(),i=t.readU1();t.readU1(),a&&t.readU(8),i&&o.v(t);const n=o.f(t,3),s=(o.f(t,1),o.f(t,1));let d=0,c=0,h=[0],f=[0],p=[0],u=[0],m=[0],g=[0],w=0,U=[0],I=[0],R=[0];if(s)f[0]=o.f(t,5);else{d=o.f(t,1),d?(o.f(t,32),o.f(t,32),o.f(t,1)&&o.d(t),o.f(t,1)&&(w=o.f(t,5),o.f(t,32),o.f(t,5),o.f(t,5))):c=0;let e=o.f(t,1),a=o.f(t,5);for(let i=0;i<=a;i++){if(h[i]=o.f(t,12),f[i]=o.f(t,5),f[i]>7?p[i]=o.f(t,1):p[i]=0,c){if(u[i]=o.f(t,1),u[i]){let e=w+1;U[i]=o.f(t,e),I[i]=o.f(t,e),R[i]=o.f(t,1)}}else u[i]=0;e&&(m[i]=o.f(t,1),m[i]&&(g[i]=o.f(t,4)))}}let v=o.f(t,4),k=o.f(t,4),M=v+1,b=o.f(t,M);M=k+1;let B=o.f(t,M),y=0,A=0,D=0;y=s?0:o.f(t,1),y&&(o.f(t,4),o.f(t,3)),o.f(t,1),o.f(t,1),o.f(t,1);let x=0,C=0,P=0,S=0,L=0,T=0,F=2,N=2,z=0;s||(o.f(t,1),o.f(t,1),o.f(t,1),o.f(t,1),S=o.f(t,1),S?(L=o.f(t,1),T=o.f(t,1)):(L=0,T=0),F=o.f(t,1)?2:o.f(t,1),F>0?o.f(t,1)?2:o.f(t,1):2,S&&o.f(t,3)),o.f(t,1),o.f(t,1),o.f(t,1);let $=o.f(t,1),E=0,V=0,_=0;2==n&&$?(E=o.f(t,1),V=E?12:10):n<=2&&(V=$?10:8),_=1==n?0:o.f(t,1);let X=0,O=0,Y=0;o.f(t,1)?(X=o.f(t,8),O=o.f(t,8),Y=o.f(t,8)):(X=2,O=2,Y=2);let W=0,H=0,Q=0,j=0,J=0;return _?(W=o.f(t,1),H=1,Q=1,j=0,J=0):1==X&&13==O&&0==Y?(W=1,H=0,Q=0,J=o.f(t,1)):(W=o.f(t,1),0==n?(H=1,Q=1):1==n?(H=0,Q=0):12==V?(H=o.f(t,1),Q=H?o.f(t,1):0):(H=1,Q=0),H&&Q&&(j=o.f(t,2)),J=o.f(t,1)),o.f(t,1),{width:b+1,height:B+1,profile:n,level:l[f[0]],tier:p[0],bitDepth:V,monoChrome:_,colorRange:W,colorPrimaries:X,transferCharacteristics:O,matrixCoefficients:Y,subsamplingX:H,subsamplingY:Q,chromaSamplePosition:j}}(d);a.writeU(3,e.profile),a.writeU(5,e.level),a.writeU(1,e.tier),a.writeU(1,e.bitDepth>8?1:0),a.writeU(1,12===e.bitDepth?1:0),a.writeU(1,e.monoChrome),a.writeU(1,e.subsamplingX),a.writeU(1,e.subsamplingY),a.writeU(1,e.chromaSamplePosition)}else{const t=(0,s.I)(i.f[15](e+28));a.writeU(3,i.f[15](e+48)),a.writeU(5,i.f[15](e+52)),a.writeU(1,0),a.writeU(1,t.comp[0].depth>8?1:0),a.writeU(1,12===t.comp[0].depth?1:0),a.writeU(1,0),a.writeU(1,1),a.writeU(1,1),a.writeU(1,0)}return a.writeU(8,0),a.padding(),a.getBuffer()}},14769:(e,t,a)=>{a.d(t,{DK:()=>s,XC:()=>c,Xr:()=>d,jA:()=>o,ob:()=>r,oe:()=>n});var i=a(31865);const r=34,o=8,n=[0,8,12,0,16,20,24,32],s=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],d=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length===r){const{bitsPerRawSample:a,sampleRate:r,channels:o}=function(e){const t=new i.A(e);t.skip(10);const a=t.readUint24();return{sampleRate:a>>4,channels:1+((15&a)>>>1),bitsPerRawSample:1+((1&a)<<4|(240&t.readUint8())>>>4)}}(t);e.codecpar.bitsPerRawSample=a,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=o}}},64093:(e,t,a)=>{a.d(t,{Au:()=>U,He:()=>I,XC:()=>R,Y2:()=>m,hG:()=>g,oz:()=>w});var i=a(77231);const r=[44100,48e3,32e3,0],o=[22050,24e3,16e3,0],n=[11025,12e3,8e3,0],s=[0,1152,1152,384],d=[0,576,1152,384],c=[0,576,1152,384],l=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],h=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],f=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],p=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],u=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return n[t];case 2:return o[t];case 3:return r[t]}return i.N_}function g(e,t){switch(e){case 0:return c[t];case 2:return d[t];case 3:return s[t]}return i.N_}function w(e,t,a){switch(t){case 1:switch(e){case 0:case 2:return u[a];case 3:return f[a]}break;case 2:switch(e){case 0:case 2:return u[a];case 3:return h[a]}case 3:switch(e){case 0:case 2:return p[a];case 3:return l[a]}}return i.N_}function U(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return i.N_}const I={32:"Layer1",33:"Layer2",34:"Layer3"};function R(e,t){if(t&&t.length>=4){const a=t[1]>>>3&3,i=(6&t[1])>>1,r=(12&t[2])>>>2,o=3&~(t[3]>>>6)?2:1,n=U(i),s=m(a,r);e.codecpar.profile=n,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=o}}},22576:(e,t,a)=>{a.d(t,{Ij:()=>c,XC:()=>d,kt:()=>s});var i=a(31865),r=a(729),o=a(44328);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function s(e){let t=0,a=0,i=0;if(e.length<1)return 0;switch(t=e[0],a=n[t>>3],3&t){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*a}function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const a=new i.A(t,!1);a.skip(9),e.codecpar.chLayout.nbChannels=a.readUint8(),e.codecpar.initialPadding=a.readUint16(),e.codecpar.sampleRate=a.readUint32(),e.codecpar.seekPreroll=Number((0,o.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function c(e){const t=new Uint8Array(19),a=new r.A(t,!1);return a.writeString("OpusHead"),a.writeUint8(1),a.writeUint8(e.chLayout.nbChannels),a.writeUint16(e.initialPadding),a.writeUint32(e.sampleRate),t}},97077:(e,t,a)=>{a.d(t,{Ui:()=>o,XC:()=>r});var i=a(37246);function r(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=o(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function o(e){const t=new i.A(e.length);return t.appendBuffer(e.subarray(4)),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},82014:(e,t,a)=>{a.d(t,{Ui:()=>m,XC:()=>u,Yj:()=>g,k9:()=>p,wN:()=>h});var i=a(63939),r=a(9599),o=a(29170),n=a(37246),s=a(77231),d=a(97317),c=a(44328),l=a(729);const h={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"},f=[{level:10,maxResolution:196608,maxFrameRate:30},{level:11,maxResolution:196608,maxFrameRate:60},{level:20,maxResolution:518400,maxFrameRate:30},{level:21,maxResolution:518400,maxFrameRate:60},{level:30,maxResolution:2073600,maxFrameRate:30},{level:31,maxResolution:2073600,maxFrameRate:60},{level:40,maxResolution:3686400,maxFrameRate:30},{level:41,maxResolution:3686400,maxFrameRate:60},{level:50,maxResolution:8294400,maxFrameRate:30},{level:51,maxResolution:8294400,maxFrameRate:60},{level:60,maxResolution:8847360,maxFrameRate:30},{level:61,maxResolution:8847360,maxFrameRate:60},{level:70,maxResolution:35389440,maxFrameRate:30},{level:71,maxResolution:35389440,maxFrameRate:60}];function p(e,t,a){const i=e*t;for(const e of f)if(i<=e.maxResolution&&a<=e.maxFrameRate)return e.level}function u(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=m(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function m(e){const t=new n.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}function g(e){const t=new l.A(new Uint8Array(8)),a=function(e){let t=i.f[15](e+48),a=i.f[15](e+52);a===s.N_&&(a=p(i.f[15](e+56),i.f[15](e+60),(0,c.lb)((0,o.A)(e+72,r.P))));const n=(0,d.I)(i.f[15](e+28));let l=i.f[15](e+40),h=1;n&&(l=n.comp[0].depth,1===n.log2ChromaW&&1===n.log2ChromaH?1===i.f[15](e+100)&&(h=0):1===n.log2ChromaW&&0===n.log2ChromaH?h=2:0===n.log2ChromaW&&0===n.log2ChromaH&&(h=3));const f=2===i.f[15](e+84)?1:0;return t===s.N_&&l&&(t=0==h||1==h?8==l?0:2:8==l?1:3),{profile:t,level:a,bitDepth:l,chromaSubsampling:h,fullRange:f}}(e);return t.writeUint8(a.profile),t.writeUint8(a.level),t.writeUint8(a.bitDepth<<4|a.chromaSubsampling<<1|a.fullRange),t.writeUint8(i.f[15](e+88)),t.writeUint8(i.f[15](e+92)),t.writeUint8(i.f[15](e+96)),t.writeUint16(0),t.getWroteBuffer()}},73040:(e,t,a)=>{a.d(t,{$x:()=>s,bD:()=>d});var i=a(67672),r=a(72739),o=a(95335);async function n(e,t){return{key:await e.readString(await e.readUint16()),value:await s(e,t)}}async function s(e,t){let a;switch(await e.readUint8()){case 0:a=await e.readDouble();break;case 1:a=!!await e.readUint8();break;case 2:a=await e.readString(await e.readUint16());break;case 3:for(a={};e.getPos()<t;){const{key:i,value:r}=await n(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 8:for(a={},await e.skip(4);e.getPos()<t;){const{key:i,value:r}=await n(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 9:case 5:a=null;break;case 10:a=[];const i=await e.readUint32();for(let r=0;r<i;r++)a.push(await s(e,t));break;case 11:const r=await e.readDouble(),o=await e.readInt16();a=new Date(r+60*o*1e3);break;case 12:a=await e.readString(await e.readUint32())}return a}function d(e,t){i.ai(t)?(e.writeUint8(0),e.writeDouble(t)):i.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):i.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):i.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):i.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),r.__(t,(t=>{d(e,t)}))):i.Ik(t)?(e.writeUint8(3),o.__(t,((t,a)=>{e.writeUint16(a.length),e.writeString(a),d(e,t)})),e.writeUint24(9)):t instanceof Date?(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0)):null==t&&e.writeUint8(5)}},11573:(e,t,a)=>{function i(e,t){let a=0;for(let i=0;i<t;i++)a=2*a+e.readU1();return a}function r(e){let t=0;for(;!i(e,1);)t++;return t>=32?0:i(e,t)+(1<<t)-1}function o(e){let t=0;for(let a=0;a<8;a++){let r=i(e,8);if(t|=(127&r)<<7*a,!(128&r))break}return t}a.d(t,{d:()=>r,f:()=>i,v:()=>o})},35336:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(134),r=a(50011);class o{constructor(e=1048576,t=!0,a){if((0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),(0,i.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,a&&a.view)this.size=a.length,this.buffer=a,this.data=a.view;else if(a&&!a.byteOffset)this.size=a.length,this.buffer=a,this.data=new DataView(this.buffer.buffer);else{if(a)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,a=(65280&e)>>8,i=255&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(a),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(a),this.writeUint8(i))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let a=0;for(;t>0;){this.flush();const i=Math.min(this.size,t);this.buffer.set(e.subarray(a,a+i),this.pointer),this.pointer+=i,this.pos+=BigInt(i),a+=i,t-=i}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=r.encode(e);return this.writeBuffer(t),t.length}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}}}]);