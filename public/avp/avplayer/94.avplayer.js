"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[94],{64436:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(134),i=a(63939),s=(a(77162),a(37837)),n=a(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,s.Gy)(168),(0,n.Yi)(this.inCodecpar,e),this.inTimeBase={den:i.f[15](t+4),num:i.f[15](t)},0}destroy(){this.inCodecpar&&((0,n.dn)(this.inCodecpar),this.inCodecpar=0)}}},36488:(e,t,a)=>{a.d(t,{A:()=>w});var r=a(134),i=a(63939),s=a(50932),n=a(77162),o=a(29170),c=a(64436),d=a(14686),f=a(4624),l=a(9705),h=a(77231),p=a(95832),m=a(44328),u=a(37837),g=a(71517),R=a(37246),k=a(67672);class w extends c.A{constructor(...e){super(...e),(0,r.A)(this,"bitReader",void 0),(0,r.A)(this,"streamMuxConfig",void 0),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"refSampleDuration",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.refSampleDuration=BigInt(0),this.bitReader=new R.A,this.streamMuxConfig={profile:h.N_,sampleRate:h.N_,channels:h.N_},0}sendAVPacket(e){const t=(0,d.s3)(i.f[20](e+24),i.f[15](e+28));this.bitReader.appendBuffer(t);let a=i.f[17](e+16)!==h.Dh?i.f[17](e+16):i.f[17](e+8);for(;this.bitReader.remainingLength()>=20;){const t=this.bitReader.getPointer(),r=p.f7(null,this.bitReader);if(k.ai(r)){let e=!1;for(;this.bitReader.remainingLength()>=20;){if(695===this.bitReader.peekU(11)){e=!0;break}this.bitReader.readU1()}if(e)continue;return f.z3("AACLATMParser parse failed","src\\avformat\\bsf\\aac\\LATM2RawFilter.ts",107),this.bitReader.reset(),l.LR}if(r.framePayloadLength>=this.bitReader.remainingLength()){this.bitReader.skipPadding(),this.bitReader.setPointer(t);break}r.useSameStreamMux||(this.streamMuxConfig.profile=r.profile,this.streamMuxConfig.sampleRate=r.sampleRate,this.streamMuxConfig.channels=r.channels);const c=r.framePayloadLength,g=new Uint8Array(c);for(let e=0;e<c;e++)g[e]=this.bitReader.readU(8);const R={dts:a,buffer:g,extradata:null,pos:i.f[17](e+56)};if(i.f[15](this.inCodecpar+48)!==this.streamMuxConfig.profile||i.f[15](this.inCodecpar+136)!==this.streamMuxConfig.sampleRate||i.f[15](this.inCodecpar+116)!==this.streamMuxConfig.channels){this.refSampleDuration=(0,m.k)(BigInt(Math.floor(1024/this.streamMuxConfig.sampleRate*h.SF)),h.KR,this.inTimeBase),s.M[15](this.inCodecpar+48,this.streamMuxConfig.profile),s.M[15](this.inCodecpar+136,this.streamMuxConfig.sampleRate),s.M[15](this.inCodecpar+116,this.streamMuxConfig.channels);const e=(0,p.Ij)((0,o.A)(this.inCodecpar,n.A));i.f[20](this.inCodecpar+12)&&(0,u.Eb)(i.f[20](this.inCodecpar+12)),s.M[20](this.inCodecpar+12,(0,u.sY)(e.length)),(0,d.lW)(i.f[20](this.inCodecpar+12),e.length,e),s.M[15](this.inCodecpar+16,e.length),R.extradata=e}this.caches.push(R),a+=this.refSampleDuration,this.bitReader.skipPadding()}return 0}receiveAVPacket(e){if(this.caches.length){(0,g.Up)(e);const t=this.caches.shift(),a=(0,u.sY)(t.buffer.length);if((0,d.lW)(a,t.buffer.length,t.buffer),(0,g.NX)(e,a,t.buffer.length),s.M[17](e+16,t.dts),s.M[17](e+8,t.dts),s.M[17](e+56,t.pos),s.M[15](e+36,1|i.f[15](e+36)),s.M[17](e+48,this.refSampleDuration),t.extradata){const a=(0,u.sY)(t.extradata.length);(0,d.lW)(a,t.extradata.length,t.extradata),(0,g.Ow)(e,1,a,t.extradata.length)}return 0}return l.LT}reset(){return this.bitReader.reset(),this.caches.length=0,0}}},47094:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var r=a(134),i=a(61499),s=a(63939),n=a(50932),o=a(4624),c=a(9705),d=a(85947),f=a(14686),l=a(37837),h=a(71517),p=a(44328),m=a(77231),u=a(72739),g=a(95832),R=a(67672),k=a(36488),w=a(19028);const T="src\\avformat\\formats\\IAacFormat.ts",B=1024;class b extends d.A{constructor(){super(),(0,r.A)(this,"type",15),(0,r.A)(this,"frameType",void 0),(0,r.A)(this,"fileSize",void 0),(0,r.A)(this,"currentPts",void 0),(0,r.A)(this,"latmFilter",void 0),(0,r.A)(this,"encodeSampleRate",void 0)}init(e){this.currentPts=BigInt(0)}async destroy(e){this.latmFilter&&(this.latmFilter.destroy(),this.latmFilter=null)}async estimateTotalBlock(e){let t=0;const a=e.ioReader.getPos();for(;;)try{const a=await e.ioReader.peekBuffer(7),r=(3&a[3])<<11|a[4]<<3|(224&a[5])>>>5;t+=1+(3&a[6]),await e.ioReader.skip(r)}catch(e){break}return await e.ioReader.seek(a),t}async parseTransportStreamTimestamp(e){if("ID3"===await e.ioReader.peekString(3)){await e.ioReader.skip(3);const t={version:await e.ioReader.readUint8(),revision:await e.ioReader.readUint8(),flags:await e.ioReader.readUint8()},a={},r=(127&await e.ioReader.readUint8())<<21|(127&await e.ioReader.readUint8())<<14|(127&await e.ioReader.readUint8())<<7|127&await e.ioReader.readUint8();if(await w.q(e.ioReader,r,t,a),R.o(a["com.apple.streaming.transportStreamTimestamp"]))return a["com.apple.streaming.transportStreamTimestamp"]}}async readHeader(e){let t;2&e.ioReader.flags&&(t=await this.parseTransportStreamTimestamp(e));const a=await e.ioReader.peekBuffer(4);if(this.fileSize=await e.ioReader.fileSize(),65===a[0]&&68===a[1]&&73===a[2]&&70===a[3]){const t=e.createStream();t.codecpar.codecId=86018,t.codecpar.codecType=1,this.frameType=0,t.duration=this.fileSize,t.timeBase.den=16384,t.timeBase.num=1}else if(255!==a[0]||240&~a[1]){if(86!==a[0]||224&~a[1])return c.LR;{this.frameType=2;const t=e.createStream();t.codecpar.codecId=86018,t.codecpar.codecType=1;const a=(0,g.f7)(await e.ioReader.peekBuffer(20));if(R.ai(a))return c.LR;t.codecpar.profile=a.profile,t.codecpar.sampleRate=a.sampleRate,t.codecpar.chLayout.nbChannels=a.channels;const r=(0,g.Ij)(t.codecpar);t.codecpar.extradata=(0,l.sY)(r.length),(0,f.lW)(t.codecpar.extradata,r.length,r),t.codecpar.extradataSize=r.length,t.duration=this.fileSize,t.timeBase.den=16384,t.timeBase.num=1,this.latmFilter=new k.A,this.latmFilter.init(t.codecpar[i.o9],t.timeBase[i.o9])}}else{this.frameType=1;const a=e.createStream();a.codecpar.codecId=86018,a.codecpar.codecType=1;const r=(0,g.Bq)(await e.ioReader.peekBuffer(20));if(R.ai(r))return c.LR;this.encodeSampleRate=r.sampleRate,a.codecpar.profile=r.profile,a.codecpar.sampleRate=r.sampleRate,a.codecpar.chLayout.nbChannels=r.channels;const i=(0,g.Ij)(a.codecpar);a.codecpar.extradata=(0,l.sY)(i.length),(0,f.lW)(a.codecpar.extradata,i.length,i),a.codecpar.extradataSize=i.length,a.timeBase.den=a.codecpar.sampleRate,a.timeBase.num=1,2&e.ioReader.flags?R.o(t)&&(this.currentPts=(0,p.k)(t,{num:1,den:9e4},a.timeBase)):a.duration=(0,p.k)(BigInt(Math.floor(1024*await this.estimateTotalBlock(e)/this.encodeSampleRate*m.SF)),m.KR,a.timeBase)}return 0}async readAVPacket(e,t){const a=e.streams.find((e=>e.codecpar.codecType=1));try{if(2&e.ioReader.flags){let t=await this.parseTransportStreamTimestamp(e);R.o(t)&&(this.currentPts=(0,p.k)(t,{num:1,den:9e4},a.timeBase))}const r=e.ioReader.getPos();let i;if(0===this.frameType){i=await e.ioReader.readBuffer(Math.min(B,Number(BigInt.asIntN(32,this.fileSize-r))));const a=(0,l.sY)(i.length);(0,f.lW)(a,i.length,i),(0,h.NX)(t,a,i.length),n.M[17](t+48,BigInt(B)),n.M[17](t+56,r)}else if(1===this.frameType){const s=await e.ioReader.readBuffer(7),o=1&s[1],c=(3&s[3])<<11|s[4]<<3|(224&s[5])>>>5,d=3&s[6];let u=1===o?7:9,g=c-u;9===u&&await e.ioReader.skip(2);const R=(0,p.k)(BigInt(Math.floor(1024*(d+1)/this.encodeSampleRate*m.SF)),m.KR,a.timeBase);n.M[17](t+48,R),i=await e.ioReader.readBuffer(g);const k=(0,l.sY)(i.length);(0,f.lW)(k,i.length,i),(0,h.NX)(t,k,i.length),n.M[17](t+56,r)}else if(2===this.frameType){if(r===this.fileSize)return-1048576;for(;;){let a=this.latmFilter.receiveAVPacket(t);if(a!==c.LT){if(a<0)return a;n.M[17](t+48,BigInt(0|s.f[15](t+28))),n.M[17](t+56,this.currentPts);break}{if(e.ioReader.getPos()===this.fileSize)return-1048576;i=await e.ioReader.readBuffer(Math.min(B,Number(BigInt.asIntN(32,this.fileSize-r))));const a=(0,l.sY)(i.length);(0,f.lW)(a,i.length,i),(0,h.NX)(t,a,i.length),this.latmFilter.sendAVPacket(t)}}}return n.M[15](t+32,a.index),n.M[15](t+76,a.timeBase.den),n.M[15](t+72,a.timeBase.num),n.M[17](t+16,this.currentPts),n.M[17](t+8,this.currentPts),n.M[15](t+36,1|s.f[15](t+36)),this.currentPts+=s.f[17](t+48),0}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(o.z3(`read packet error, ${t}`,T,337),c.LR):e.ioReader.error}}async syncFrame(e){if(0===this.frameType)return;let t=m.Dh;const a=1===this.frameType?4095:695,r=1===this.frameType?4:5;for(;;)try{let i=0;for(t=e.ioReader.getPos();3!==i&&await e.ioReader.peekUint16()>>>r===a;){const t=1===this.frameType?(0,g.Bq)(await e.ioReader.peekBuffer(9)):(0,g.f7)(await e.ioReader.peekBuffer(20));if(R.ai(t))break;i++,await e.ioReader.skip(t.headerLength+t.framePayloadLength)}if(3===i)break;await e.ioReader.skip(1)}catch(e){break}t!==m.Dh&&await e.ioReader.seek(t)}async seek(e,t,a,r){if(16&r&&2&e.ioReader.flags){const r=(0,p.k)(a,t.timeBase,m.i0);return await e.ioReader.seek(r,!0),this.currentPts=a,BigInt(0)}if(1===this.frameType){const i=e.ioReader.getPos();if(2&r){const s=await e.ioReader.fileSize();return s<=BigInt(0)?BigInt(c.E$):(a<BigInt(0)?a=BigInt(0):a>s&&(a=s),await e.ioReader.seek(a),4&r||(await this.syncFrame(e),t.duration&&this.fileSize&&(this.currentPts=a/this.fileSize*t.duration)),i)}if(t&&t.sampleIndexes.length){let r=u.El(t.sampleIndexes,(e=>e.pts>a?-1:1));if(r>0&&(0,p.k)(a-t.sampleIndexes[r-1].pts,t.timeBase,m.i0)<BigInt(5e3))return o.Yz(`seek in sampleIndexes, found index: ${r}, pts: ${t.sampleIndexes[r-1].pts}, pos: ${t.sampleIndexes[r-1].pos}`,T,443),await e.ioReader.seek(t.sampleIndexes[r-1].pos),this.currentPts=a,i}if(o.Yz("not found any keyframe index, try to seek in bytes",T,450),!t.duration)return BigInt(c.E$);{await e.ioReader.seek(BigInt(0));let r=BigInt(0);for(;;)try{if(r>=a)return this.currentPts=r,i;const s=await e.ioReader.peekBuffer(7),n=(3&s[3])<<11|s[4]<<3|(224&s[5])>>>5,o=3&s[6];r+=(0,p.k)(BigInt(Math.floor(1024*(o+1)/this.encodeSampleRate*m.SF)),m.KR,t.timeBase),await e.ioReader.skip(n)}catch(e){return BigInt(c.E$)}}}else if(0===this.frameType||2===this.frameType){this.latmFilter&&this.latmFilter.reset();const t=e.ioReader.getPos();return a<BigInt(0)?a=BigInt(0):a>this.fileSize&&(a=this.fileSize),await e.ioReader.seek(a),this.currentPts=a,2!==this.frameType||4&r||await this.syncFrame(e),t}return BigInt(c.E$)}getAnalyzeStreamsCount(){return 1}}},85947:(e,t,a)=>{a.d(t,{A:()=>i});var r=a(134);class i{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},19028:(e,t,a)=>{a.d(t,{q:()=>o});var r=a(4624),i=a(50011);const s="src\\avformat\\formats\\mp3\\id3v2.ts";function n(e,t){let a="utf-8";return 0===e?a="iso-8859-1":1===e?a="utf-16":2===e&&(a="utf-16be"),new TextDecoder(a).decode(t)}async function o(e,t,a,o){const c=2!==a.version,d=c?10:6;let f=e.getPos()+BigInt(0|t);async function l(){await e.seek(f)}if(c&&64&a.flags){let i=await async function(e,t){let a=0;for(;t--;)a=(a<<7)+(127&await e.readUint8());return a}(e,4);if(4===a.version&&(i-=4),i<0)return r.z3("invalid extended header length",s,88),await l();if(await e.skip(i),(t-=i+4)<0)return r.z3("extended header too long",s,94),await e.seek(f),await l()}for(;t>d;){let a,f;if(c){if(a=await e.readString(4),f=await e.readUint32(),!f){r.z3("invalid frame size",s,108);break}await e.readUint16()}else a=await e.readString(3),f=await e.readUint24();if("APIC"===a)o.poster=await e.readBuffer(f);else if("USLT"===a){const t=await e.readUint8(),a=await e.readString(3),r=await e.readBuffer(f-4);o.lyrics=`${a} ${n(t,r)}`}else if("COMM"===a||"COM"===a){const t=await e.readUint8(),a=await e.readString(3),r=await e.readBuffer(f-4);o.comment=`${a} ${n(t,r)}`}else if("PRIV"===a){const t=e.getPos(),a=[];for(;;){const t=await e.readUint8();if(0===t)break;a.push(t)}const r=i.decode(new Uint8Array(a));let s;s="com.apple.streaming.transportStreamTimestamp"===r?await e.readUint64():await e.readBuffer(f-Number(e.getPos()-t)),o[r]=s}else{let t;switch(t="T"===a[0]?n(await e.readUint8(),await e.readBuffer(f-1)):await e.readBuffer(f),a){case"TIT2":case"TT2":o.title=t;break;case"TPE1":case"TP1":o.artist=t;break;case"TPE2":case"TP2":o.albumArtist=t;break;case"TPOS":o.disc=t;break;case"TCOP":o.copyright=t;break;case"TALB":case"TAL":o.album=t;break;case"TRCK":case"TRK":o.track=t;break;case"TYER":case"TDRL":case"TDRC":o.date=t;break;case"COMM":case"COM":o.comment=t;break;case"TCON":case"TCO":o.genre=t;break;case"TSSE":case"TEN":o.encoder=t;break;case"TCOM":o.composer=t;break;case"TENC":o.vendor=t;break;case"TLAN":o.language=t;break;case"TPE3":case"TP3":o.performer=t;break;case"TPUB":o.publisher=t;break;case"TCMP":case"TCP":o.compilation=t;break;case"TDEN":o.creationTime=t;break;case"TSOA":o.albumSort=t;break;case"TSOP":o.artistSort=t;break;case"TSOT":o.titleSort=t;break;case"TIT1":o.grouping=t;break;default:o[a]=t}}t-=f+d}4==a.version&&16&a.flags&&(f+=BigInt(10)),await e.seek(f)}},95832:(e,t,a)=>{a.d(t,{Bq:()=>l,Ij:()=>f,XC:()=>d,f7:()=>h,uF:()=>s});var r=a(77231),i=a(37246);const s={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],c=[r.N_,1,2,3,4,5,6,7];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:i,channels:s}=function(e){let t=r.N_,a=r.N_,i=r.N_;return e.length>=2&&(t=e[0]>>3&31,a=o[(7&e[0])<<1|e[1]>>7],i=c[e[1]>>3&15]),{profile:t,sampleRate:a,channels:i}}(t);e.codecpar.profile=a,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=s,e.codecpar.frameSize=5===a?2048:1024,e.codecpar.format=8}}function f(e){const t=n[e.sampleRate],a=e.chLayout.nbChannels,i=e.profile===r.N_?2:e.profile,s=new Uint8Array(2);return s[0]=(31&i)<<3|(14&t)>>1,s[1]=(1&t)<<7|(15&a)<<3,s}function l(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],r=(192&e[2])>>>6,i=(60&e[2])>>>2,s=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let f=1===a?7:9,l=n-f;return{syncWord:t,profile:r+1,sampleRate:o[i],channels:c[s],aacFrameLength:n,numberOfRawDataBlocksInFrame:d,headerLength:f,framePayloadLength:l}}function h(e,t){function a(){const e=t.readU(2);let a=0;for(let r=0;r<=e;r++)a<<=8,a|=t.readU(8);return a}t||(t=new i.A).appendBuffer(e);const r=t.getPointer(),s={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;s.syncWord=n,s.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(s.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let r=e?a():0;const i=t.readU(5);r-=5;const n=t.readU(4);r-=4;const d=t.readU(4);if(r-=4,t.readU(3),r-=3,r>0&&t.readU(r),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),s.profile=i+1,s.sampleRate=o[n],s.channels=c[d]}let f=0;for(;;){const e=t.readU(8);if(f+=e,255!==e)break}return s.framePayloadLength=f,s.headerLength=t.getPointer()-r+(8===t.getBitLeft()?0:1),s}}}]);