{"version":3,"file":"src_avformat_formats_IFormat_ts-src_avformat_formats_ogg_vorbis_ts-src_avformat_function_seek-152564.avplayer.js","mappings":"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","sources":["webpack://AVPlayer/./src/avformat/formats/IFormat.ts","webpack://AVPlayer/./src/avformat/formats/ogg/OggPage.ts","webpack://AVPlayer/./src/avformat/formats/ogg/vorbis.ts","webpack://AVPlayer/./src/avformat/function/getBytesByDuration.ts","webpack://AVPlayer/./src/avformat/function/seekInBytes.ts"],"sourcesContent":["/*\r\n * libmedia abstract format decoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Stream from 'avutil/AVStream'\r\nimport { AVIFormatContext } from '../AVFormatContext'\r\nimport AVPacket from 'avutil/struct/avpacket'\r\nimport { AVFormat } from 'avutil/avformat'\r\n\r\nexport default abstract class IFormat {\r\n\r\n  public type: AVFormat = AVFormat.UNKNOWN\r\n\r\n  public onStreamAdd: (stream: Stream) => void\r\n\r\n  public abstract init(formatContext: AVIFormatContext): void\r\n\r\n  public async destroy(formatContext: AVIFormatContext): Promise<void> {}\r\n\r\n  public abstract getAnalyzeStreamsCount(): number\r\n  public abstract readHeader(formatContext: AVIFormatContext): Promise<number>\r\n  public abstract readAVPacket(formatContext: AVIFormatContext, avpacket: pointer<AVPacket>): Promise<number>\r\n\r\n  /**\r\n   * seek\r\n   * \r\n   * @param context \r\n   * @param stream \r\n   * @param timestamp 毫秒时间戳\r\n   * @param flags \r\n   * \r\n   * @returns 返回 seek 之前的下一个 avpacket pos（若不知道返回 0n 方便之后可以再 seek 回来）返回负数表示 seek 失败\r\n   */\r\n  public abstract seek(\r\n    formatContext: AVIFormatContext,\r\n    stream: Stream,\r\n    timestamp: int64,\r\n    flags: int32\r\n  ): Promise<int64>\r\n}\r\n","/*\r\n * libmedia oggs page parser\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport IOReader from 'common/io/IOReader'\r\nimport IOWriter from 'common/io/IOWriterSync'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport IOReaderSync from 'common/io/IOReaderSync'\r\nimport { NOPTS_VALUE_BIGINT } from 'avutil/constant'\r\nimport * as text from 'common/util/text'\r\n\r\nexport interface PagePayload {\r\n  signature: string\r\n  read(ioReader: IOReaderSync): void\r\n  write(ioWriter: IOWriter): void\r\n  setCodec(codecpar: AVCodecParameters): void\r\n  streamIndex: number\r\n}\r\n\r\nclass UserComment {\r\n\r\n  public list: string[]\r\n\r\n  constructor() {\r\n    this.list = []\r\n  }\r\n\r\n  public read(ioReader: IOReaderSync, count: number) {\r\n    for (let i = 0; i < count; i++) {\r\n      const length = ioReader.readUint32()\r\n      this.list.push(ioReader.readString(length))\r\n    }\r\n  }\r\n\r\n  public write(ioWriter: IOWriter) {\r\n    for (let i = 0; i < this.list.length; i++) {\r\n      const buffer = text.encode(this.list[i])\r\n      ioWriter.writeUint32(buffer.length)\r\n      ioWriter.writeBuffer(buffer)\r\n    }\r\n  }\r\n\r\n  public addComment(comment: string) {\r\n    this.list.push(comment)\r\n  }\r\n}\r\n\r\nexport class OggPage {\r\n  /**\r\n   * 4 bytes 页标识， OggS ASCII 字符\r\n   */\r\n  public capturePattern: string\r\n\r\n  /**\r\n   * 1 bytes 版本 id, 目前为 0\r\n   */\r\n  public streamStructureVersion: number\r\n\r\n  /**\r\n   * 1 bytes 类型标识， 表示该页为逻辑流的第一页\r\n   * \r\n   * - 0x01：本页媒体编码数据与前一页属于同一个逻辑流的同一个 packet，若此位没有设，表示本页是以一个新的 packet 开始的；\r\n   * - 0x02：表示该页为逻辑流的第一页，bos 标识，如果此位未设置，那表示不是第一页；\r\n   * - 0x04：表示该页为逻辑流的最后一页，eos 标识，如果此位未设置，那表示本页不是最后一页；\r\n   */\r\n  public headerTypeFlag: number\r\n\r\n  /**\r\n   * 8 bytes 媒体编码相关的参数信息\r\n   * \r\n   * 对于音频流来说，它存储着到本页为止逻辑流在 PCM 输出中采样码的数目，可以由它来算得时间戳\r\n   * 对于视频流来说，它存储着到本页为止视频帧编码的数目\r\n   * 若此值为 -1，那表示截止到本页，逻辑流的 packet 未结束\r\n   */\r\n  public granulePosition: bigint\r\n\r\n  /**\r\n   * 4 bytes 当前页中的流的 id，它是区分本页所属逻辑流与其他逻辑流的序号，我们可以通过这个值来划分流\r\n   */\r\n  public serialNumber: number\r\n\r\n  /**\r\n   * 4 bytes 本页在逻辑流的序号\r\n   */\r\n  public pageSequenceNumber: number\r\n\r\n  /**\r\n   * 4 bytes 循环冗余效验码效验， 用来效验每页的有效性\r\n   */\r\n  public crcCheckSum: number\r\n\r\n  /**\r\n   * 1 bytes 给定本页在 segment_table 域中出现的 segment 个数\r\n   */\r\n  public numberPageSegments: number\r\n\r\n  /**\r\n   * segment 长度表\r\n   * \r\n   * 表示着每个 segment 的长度，取值范围是 0~255\r\n   * 由 segment（1 个 segment 就是 1 个字节）可以得到 packet 的值，每个 packet 的大小是以最后一个不等于 255 的 segment 结束的\r\n   */\r\n  public segmentTable: number[]\r\n\r\n  public payload: Uint8Array\r\n\r\n  public pos: int64\r\n\r\n  constructor() {\r\n    this.reset()\r\n  }\r\n\r\n  public reset() {\r\n    this.capturePattern = 'OggS'\r\n    this.streamStructureVersion = 0\r\n    this.headerTypeFlag = 0\r\n    this.granulePosition = NOPTS_VALUE_BIGINT\r\n    this.serialNumber = 0\r\n    this.pageSequenceNumber = 0\r\n    this.crcCheckSum = 0\r\n    this.numberPageSegments = 0\r\n    this.segmentTable = []\r\n    this.pos = 0n\r\n  }\r\n\r\n  public async read(ioReader: IOReader) {\r\n    this.pos = ioReader.getPos()\r\n    await this.readPageHeader(ioReader)\r\n\r\n    const length = this.segmentTable.reduce((prev, len) => {\r\n      return prev + len\r\n    }, 0)\r\n\r\n    if (length) {\r\n      this.payload = await ioReader.readBuffer(length)\r\n    }\r\n  }\r\n\r\n  public async readPageHeader(ioReader: IOReader) {\r\n    this.capturePattern = await ioReader.readString(4)\r\n    this.streamStructureVersion = await ioReader.readUint8()\r\n    this.headerTypeFlag = await ioReader.readUint8()\r\n    this.granulePosition = await ioReader.readUint64()\r\n    this.serialNumber = await ioReader.readUint32()\r\n    this.pageSequenceNumber = await ioReader.readUint32()\r\n    this.crcCheckSum = await ioReader.readUint32()\r\n    this.numberPageSegments = await ioReader.readUint8()\r\n\r\n    if (this.numberPageSegments) {\r\n      for (let i = 0; i < this.numberPageSegments; i++) {\r\n        const len = await ioReader.readUint8()\r\n        this.segmentTable.push(len)\r\n      }\r\n    }\r\n  }\r\n\r\n  public write(ioWriter: IOWriter) {\r\n    this.pos = ioWriter.getPos()\r\n    ioWriter.writeString(this.capturePattern)\r\n    ioWriter.writeUint8(this.streamStructureVersion)\r\n    ioWriter.writeUint8(this.headerTypeFlag)\r\n    ioWriter.writeUint64(this.granulePosition)\r\n    ioWriter.writeUint32(this.serialNumber)\r\n    ioWriter.writeUint32(this.pageSequenceNumber)\r\n    ioWriter.writeUint32(this.crcCheckSum)\r\n\r\n    if (this.payload) {\r\n      this.numberPageSegments = Math.floor(this.payload.length / 255) + 1\r\n      const last = this.payload.length % 255\r\n\r\n      ioWriter.writeUint8(this.numberPageSegments)\r\n\r\n      for (let i = 0; i < this.numberPageSegments - 1; i++) {\r\n        ioWriter.writeUint8(255)\r\n      }\r\n      ioWriter.writeUint8(last)\r\n      ioWriter.writeBuffer(this.payload)\r\n    }\r\n    else {\r\n      ioWriter.writeUint8(0)\r\n    }\r\n  }\r\n}\r\n\r\nexport class OggsCommentPage implements PagePayload {\r\n\r\n  public streamIndex: number\r\n\r\n  /**\r\n   * 8 bytes Magic Signature: OpusTags\r\n   */\r\n  public signature: string\r\n\r\n  /**\r\n   * 4 bytes unsigned\r\n   */\r\n  public vendorStringLength: number\r\n\r\n  /**\r\n   * 长度由 Vendor String Length 指定， utf-8 编码\r\n   */\r\n  public vendorString: string\r\n\r\n  /**\r\n   * 4 bytes unsigned, 该字段指示用户提供的注释数。它可能表示用户提供的评论为零，在这种情况下数据包中没有其他字段。\r\n   * 一定不要表示评论太多，以至于评论字符串长度将需要比其余的可用数据更多的数据数据包\r\n   */\r\n  public userCommentListLength: number\r\n\r\n  public comments: UserComment\r\n\r\n  constructor() {\r\n    this.vendorString = defined(VERSION)\r\n    this.vendorStringLength = this.vendorString.length\r\n    this.userCommentListLength = 0\r\n    this.comments = new UserComment()\r\n  }\r\n\r\n  public read(ioReader: IOReaderSync) {\r\n    this.vendorStringLength = ioReader.readUint32()\r\n    this.vendorString = ioReader.readString(this.vendorStringLength)\r\n    this.userCommentListLength = ioReader.readUint32()\r\n    if (this.userCommentListLength) {\r\n      this.comments.read(ioReader, this.userCommentListLength)\r\n    }\r\n  }\r\n\r\n  public write(ioWriter: IOWriter) {\r\n    const buffer = text.encode(this.vendorString)\r\n    ioWriter.writeUint32(buffer.length)\r\n    ioWriter.writeBuffer(buffer)\r\n\r\n    ioWriter.writeUint32(this.comments.list.length)\r\n    this.comments.write(ioWriter)\r\n  }\r\n\r\n  public addComment(comment: string) {\r\n    this.comments.addComment(comment)\r\n  }\r\n\r\n  public setCodec(codecpar: AVCodecParameters) {\r\n  }\r\n}\r\n","/*\r\n * libmedia oggs vorbis page parser\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\n/**\r\n * oggs vorbis IDPage 和 commentPage\r\n * \r\n * https://datatracker.ietf.org/doc/html/rfc7845\r\n */\r\n\r\nimport IOWriter from 'common/io/IOWriterSync'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { OggsCommentPage, PagePayload } from './OggPage'\r\nimport IOReaderSync from 'common/io/IOReaderSync'\r\nimport { Data } from 'common/types/type'\r\nimport { AVStreamMetadataKey } from 'avutil/AVStream'\r\nimport * as object from 'common/util/object'\r\nimport isDef from 'common/function/isDef'\r\n\r\nconst CommentKeyMap = {\r\n  'album': AVStreamMetadataKey.ALBUM,\r\n  'artist': AVStreamMetadataKey.ARTIST,\r\n  'description': AVStreamMetadataKey.DESCRIPTION,\r\n  'encoder': AVStreamMetadataKey.ENCODER,\r\n  'title': AVStreamMetadataKey.TITLE,\r\n  'tracknumber': AVStreamMetadataKey.TRACK,\r\n  'date': AVStreamMetadataKey.DATE,\r\n  'genre': AVStreamMetadataKey.GENRE,\r\n  'comment': AVStreamMetadataKey.COMMENT,\r\n  'albumartist': AVStreamMetadataKey.ALBUM_ARTIST,\r\n  'composer': AVStreamMetadataKey.COMPOSER,\r\n  'performer': AVStreamMetadataKey.PERFORMER,\r\n  'discnumber': AVStreamMetadataKey.DISC,\r\n  'organization': AVStreamMetadataKey.VENDOR,\r\n  'copyright': AVStreamMetadataKey.COPYRIGHT,\r\n  'license': AVStreamMetadataKey.LICENSE,\r\n  'isrc': AVStreamMetadataKey.ISRC,\r\n  'lyrics': AVStreamMetadataKey.LYRICS,\r\n  'language': AVStreamMetadataKey.LANGUAGE,\r\n  'label': AVStreamMetadataKey.VENDOR,\r\n  'script': AVStreamMetadataKey.LYRICS,\r\n  'encoded_by': AVStreamMetadataKey.VENDOR\r\n}\r\n\r\nexport function parseVorbisComment(list: string[], metadata: Data) {\r\n  if (!list) {\r\n    return\r\n  }\r\n  list.forEach((value) => {\r\n    const l = value.split('=')\r\n    if (l.length === 2) {\r\n      const k = l[0].trim().toLowerCase()\r\n      const v = l[1].trim()\r\n      if (CommentKeyMap[k]) {\r\n        metadata[CommentKeyMap[k]] = v\r\n      }\r\n      else {\r\n        metadata[k.toLowerCase()] = v\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nexport function addVorbisComment(metadata: Data) {\r\n  const list: string[] = []\r\n  object.each(CommentKeyMap, (value, key) => {\r\n    if (isDef(metadata[value])) {\r\n      list.push(`${key.toUpperCase()}=${metadata[value]}`)\r\n    }\r\n  })\r\n  return list\r\n}\r\n\r\nexport class VorbisOggsIdPage implements PagePayload {\r\n\r\n  public streamIndex: number\r\n\r\n  /**\r\n   * 8 bits packet_type \r\n   */\r\n  public packetType: number\r\n\r\n  /**\r\n   * 6 bytes Magic Signature: vorbis\r\n   */\r\n  public signature: string\r\n\r\n  /**\r\n   * 4 bytes unsigned, 对应值 0x01\r\n   */\r\n  public version: number\r\n\r\n  /**\r\n   * 1 bytes unsigned, 声道数\r\n   */\r\n  public channels: number\r\n\r\n  /**\r\n   * 4 bytes unsigned, 原始输入采样率\r\n   */\r\n  public sampleRate: number\r\n\r\n  /**\r\n   * 4 bytes \r\n   */\r\n  public bitrateMaximum: number\r\n\r\n  /**\r\n   * 4 bytes \r\n   */\r\n  public bitrateNominal: number\r\n\r\n  /**\r\n   * 4 bytes \r\n   */\r\n  public bitrateMinimum: number\r\n\r\n  /**\r\n   * 4 bits\r\n   */\r\n  public blocksize0: number\r\n\r\n  /**\r\n   * 4 bits\r\n   */\r\n  public blocksize1: number\r\n\r\n  /**\r\n   * 1 bit\r\n   */\r\n  public framingFlag: number\r\n\r\n  constructor(signature: string = 'vorbis') {\r\n    this.signature = signature\r\n    this.version = 0\r\n    this.channels = 1\r\n    this.sampleRate = 48000\r\n    this.bitrateMaximum = 0\r\n    this.bitrateNominal = 0\r\n    this.bitrateMinimum = 0\r\n    this.blocksize0 = 2048\r\n    this.blocksize1 = 256\r\n  }\r\n\r\n  public read(ioReader: IOReaderSync) {\r\n    this.packetType = ioReader.readUint8()\r\n    this.signature = ioReader.readString(6)\r\n    this.version = ioReader.readUint32()\r\n    this.channels = ioReader.readUint8()\r\n    this.sampleRate = ioReader.readInt32()\r\n    this.bitrateMaximum = ioReader.readInt32()\r\n    this.bitrateNominal = ioReader.readInt32()\r\n    this.bitrateMinimum = ioReader.readInt32()\r\n\r\n    const block = ioReader.readUint8() & 0xff\r\n\r\n    this.blocksize0 = Math.pow(2, block >>> 4)\r\n    this.blocksize1 = Math.pow(2, block & 0x0f)\r\n\r\n    this.framingFlag = ioReader.readUint8()\r\n  }\r\n\r\n  public write(ioWriter: IOWriter) {\r\n    ioWriter.writeUint8(0x01)\r\n    ioWriter.writeString(this.signature)\r\n    ioWriter.writeUint32(this.version)\r\n    ioWriter.writeUint8(this.channels)\r\n    ioWriter.writeInt32(this.sampleRate)\r\n    ioWriter.writeInt32(this.bitrateMaximum)\r\n    ioWriter.writeInt32(this.bitrateNominal)\r\n    ioWriter.writeInt32(this.bitrateMinimum)\r\n\r\n    ioWriter.writeUint8((Math.log2(this.blocksize0) << 4) | Math.log2(this.blocksize1))\r\n\r\n    ioWriter.writeUint8(0x01)\r\n  }\r\n\r\n  public setCodec(codecpar: AVCodecParameters) {\r\n    this.sampleRate = codecpar.sampleRate\r\n    this.channels = codecpar.chLayout.nbChannels\r\n  }\r\n}\r\n\r\nexport class VorbisOggsCommentPage extends OggsCommentPage {\r\n  /**\r\n   * 8 bits packet_type \r\n   */\r\n  public packetType: number\r\n\r\n  /**\r\n   * 1 bit\r\n   */\r\n  public framingFlag: number\r\n\r\n  constructor(signature: string = 'vorbis') {\r\n    super()\r\n    this.signature = signature\r\n    this.packetType = 0x01\r\n    this.framingFlag = 0x01\r\n  }\r\n\r\n  public read(ioReader: IOReaderSync) {\r\n    this.packetType = ioReader.readUint8()\r\n    this.signature = ioReader.readString(6)\r\n    super.read(ioReader)\r\n    if (this.signature === 'vorbis') {\r\n      this.framingFlag = ioReader.readUint8()\r\n    }\r\n  }\r\n\r\n  public write(ioWriter: IOWriter) {\r\n    ioWriter.writeUint8(this.packetType)\r\n    ioWriter.writeString(this.signature)\r\n    super.write(ioWriter)\r\n    if (this.signature === 'vorbis') {\r\n      ioWriter.writeUint8(this.framingFlag)\r\n    }\r\n  }\r\n\r\n  public addComment(comment: string) {\r\n    this.comments.addComment(comment)\r\n  }\r\n\r\n  public setCodec(codecpar: AVCodecParameters) {\r\n  }\r\n}\r\n","/*\r\n * libmedia get bytes by duration\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport AVStream from 'avutil/AVStream'\r\nimport * as array from 'common/util/array'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_MILLI_TIME_BASE_Q } from 'avutil/constant'\r\n\r\nexport function getBytesByDuration(streams: AVStream[], duration: int64, timeBase: Rational) {\r\n  let bytes = 0n\r\n  array.each(streams, (st) => {\r\n    bytes += st.codecpar.bitrate * avRescaleQ(duration, timeBase, AV_MILLI_TIME_BASE_Q) / 8000n\r\n  })\r\n  return bytes\r\n}\r\n","/*\r\n * libmedia seek in bytes with timestamp\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVIFormatContext } from '../AVFormatContext'\r\nimport AVStream from 'avutil/AVStream'\r\nimport { AV_MILLI_TIME_BASE_Q, NOPTS_VALUE_BIGINT } from 'avutil/constant'\r\nimport { avRescaleQ, avRescaleQ2 } from 'avutil/util/rational'\r\nimport { getBytesByDuration } from './getBytesByDuration'\r\nimport { createAVPacket, destroyAVPacket, unrefAVPacket } from 'avutil/util/avpacket'\r\nimport * as errorType from 'avutil/error'\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport * as logger from 'common/util/logger'\r\nimport { IOFlags } from 'avutil/avformat'\r\nimport { IOError } from 'common/io/error'\r\n\r\nexport default async function seekInBytes(\r\n  context: AVIFormatContext,\r\n  stream: AVStream,\r\n  timestamp: int64,\r\n  firstPacketPos: int64,\r\n  readAVPacket: (context: AVIFormatContext, avpacket: pointer<AVPacket>) => Promise<int32>,\r\n  syncAVPacket: (context: AVIFormatContext) => Promise<void>\r\n) {\r\n\r\n  const now = context.ioReader.getPos()\r\n\r\n  const fileSize = await context.ioReader.fileSize()\r\n  let pos: int64 = NOPTS_VALUE_BIGINT\r\n  let duration = timestamp\r\n  if (stream.startTime !== NOPTS_VALUE_BIGINT) {\r\n    duration -= stream.startTime\r\n  }\r\n  else {\r\n    duration -= stream.firstDTS\r\n  }\r\n\r\n  const pointPts = avRescaleQ(timestamp, stream.timeBase, AV_MILLI_TIME_BASE_Q)\r\n\r\n  // 头十秒直接回到开始位置\r\n  if (pointPts < 10000n) {\r\n    logger.debug(`seek pts is earlier then 10s, seek to first packet pos(${firstPacketPos}) directly`)\r\n    await context.ioReader.seek(firstPacketPos)\r\n    return now\r\n  }\r\n\r\n  let bytes = getBytesByDuration(context.streams, duration, stream.timeBase)\r\n  // 最大到结尾往前 10 秒\r\n  const max = fileSize - getBytesByDuration(context.streams, 10000n, AV_MILLI_TIME_BASE_Q)\r\n  const length = getBytesByDuration(context.streams, 10000n, AV_MILLI_TIME_BASE_Q)\r\n  if (bytes > max) {\r\n    bytes = max\r\n  }\r\n  if (bytes < firstPacketPos) {\r\n    await context.ioReader.seek(firstPacketPos)\r\n    return now\r\n  }\r\n  const avpacket = createAVPacket()\r\n  let seekMax = fileSize\r\n  let seekMin = 0n\r\n\r\n  failed: while (true) {\r\n    if (seekMax - seekMin < length) {\r\n      bytes = seekMin\r\n    }\r\n    await context.ioReader.seek(bytes)\r\n    await syncAVPacket(context)\r\n    if (context.ioReader.flags & IOFlags.ABORT) {\r\n      break\r\n    }\r\n\r\n    let ret = await readAVPacket(context, avpacket)\r\n    let now = avpacket.pos\r\n\r\n    if (ret >= 0) {\r\n      const currentPts = avRescaleQ2(avpacket.pts, addressof(avpacket.timeBase), AV_MILLI_TIME_BASE_Q)\r\n      let diff = currentPts - pointPts\r\n\r\n      logger.debug(`try to seek to pos: ${bytes}, got packet pts: ${avpacket.pts}(${currentPts}ms), diff: ${diff}ms`)\r\n\r\n      // seek 时间戳的前面 10 秒内\r\n      if (diff <= 0n && -diff < 10000n || seekMax - seekMin < length) {\r\n        // 查找最近的关键帧\r\n        const keyPos: int64[] = [now]\r\n        while (diff <= 0) {\r\n          if (avpacket.streamIndex === stream.index && (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY)) {\r\n            keyPos.push(now)\r\n          }\r\n          unrefAVPacket(avpacket)\r\n          ret = await readAVPacket(context, avpacket)\r\n          if (ret < 0) {\r\n            if (ret === IOError.END) {\r\n              break\r\n            }\r\n            else if (ret === IOError.AGAIN) {\r\n              continue\r\n            }\r\n            // 失败了重新 seek 回原来的位置\r\n            else {\r\n              pos = NOPTS_VALUE_BIGINT\r\n              break failed\r\n            }\r\n          }\r\n          now = avpacket.pos\r\n          diff = avRescaleQ2(avpacket.pts, addressof(avpacket.timeBase), AV_MILLI_TIME_BASE_Q) - pointPts\r\n        }\r\n        pos = keyPos.pop()\r\n        break\r\n      }\r\n      // seek 后面\r\n      else if (diff > 0n) {\r\n        seekMax = bytes\r\n        bytes = (seekMin + seekMax) >> 1n\r\n      }\r\n      // seek 前面 10 秒外\r\n      else {\r\n        seekMin = bytes\r\n        bytes = (seekMin + seekMax) >> 1n\r\n      }\r\n    }\r\n    else {\r\n      // 失败了重新 seek 回原来的位置\r\n      pos = NOPTS_VALUE_BIGINT\r\n      break\r\n    }\r\n    if (context.ioReader.flags & IOFlags.ABORT) {\r\n      break\r\n    }\r\n  }\r\n\r\n  destroyAVPacket(avpacket)\r\n\r\n  if (pos !== NOPTS_VALUE_BIGINT) {\r\n    logger.debug(`finally seek to pos ${pos}`)\r\n\r\n    await context.ioReader.seek(pos)\r\n    await syncAVPacket(context)\r\n    return now\r\n  }\r\n  else {\r\n    await context.ioReader.seek(now)\r\n    if (context.ioReader.flags & IOFlags.ABORT) {\r\n      return static_cast<int64>(errorType.EOF)\r\n    }\r\n  }\r\n\r\n  return static_cast<int64>(errorType.FORMAT_NOT_SUPPORT)\r\n}\r\n"],"names":[],"sourceRoot":""}