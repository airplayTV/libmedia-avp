"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[527],{96635:(e,a,t)=>{t.r(a),t.d(a,{default:()=>F});var r=t(134),i=t(63939),c=t(50932),d=t(4624),o=t(9705),n=t(85947),s=t(14686),l=t(37837),p=t(71517),f=t(35531),h=t(77231),m=t(92647),u=t(67672),w=t(79682),g=t(44328),A=t(39381),R=t(53260),x=t(60264),S=t(43607),I=t(72739),U=t(95335),k=t(62815),B=t(95832),D=t(67659),v=t(59166),P=t(21477),M=t(82014),b=t(97077),y=t(14769),z=t(22576),L=t(2911);const C="src\\avformat\\formats\\IAviFormat.ts",E=[["R","I","F","F","A","V","I"," "],["R","I","F","F","A","V","I","X"],["R","I","F","F","A","V","I",25],["O","N","2"," ","O","N","2","f"],["R","I","F","F","A","M","V"," "]],V={useOdml:!0};class F extends n.A{constructor(e={}){super(),(0,r.A)(this,"type",10),(0,r.A)(this,"context",void 0),(0,r.A)(this,"options",void 0),this.options=U.X$(V,e)}init(e){e.ioReader.setEndian(!1),this.context={riffEndPos:h.Dh,fileSize:h.Dh,moviList:h.Dh,moviEnd:h.Dh,isOdml:!1,header:{},dvDemux:!1,lastPktPos:BigInt(0),ioFileSize:BigInt(0),currentIndex:-1,packetSize:0,remaining:0,odmlRead:BigInt(0),odmlMaxPos:BigInt(0),nonInterleaved:!1,hasVideoKey:!1,indexLoaded:!1},e.privateData=this.context}getStreamIndex(e){return e[0]>="0"&&e[0]<="9"&&e[1]>="0"&&e[0]<="9"?10*+e[0]+ +e[1]:100}getDuration(e,a){return e.dwSampleSize?BigInt(0|a):e.dshowBlockAlign?BigInt(0|Math.floor((a+e.dshowBlockAlign-1)/e.dshowBlockAlign)):BigInt(1)}async readHeader(e){let a,t=await e.ioReader.readBuffer(4);this.context.riffEndPos=BigInt(await e.ioReader.readUint32()),this.context.riffEndPos+=e.ioReader.getPos(),t=(0,m.A)(Uint8Array,[t,await e.ioReader.readBuffer(4)]);for(let e=0;e<E.length;e++){const r=E[e];let i=0;for(;i<r.length;i++){let e=r[i];if(u.Yj(e)&&(e=e.charCodeAt(0)),e!==t[i])break}if(i===r.length){a=r;break}}if(!a)return d.z3("the file format is not avi",C,187),o.LR;25===a[7]&&d.R8("This file has been generated by a totally broken muxer.",C,191),this.context.ioFileSize=this.context.fileSize=await e.ioReader.fileSize(),(this.context.fileSize<=0||this.context.fileSize<this.context.riffEndPos)&&(this.context.fileSize=this.context.riffEndPos===BigInt(8)?h.vh:this.context.riffEndPos);let r=!1,i=BigInt(0),c="",n=!1;try{for(;e.ioReader.getPos()<this.context.fileSize&&!r;){const a=await e.ioReader.readString(4);let t=await e.ioReader.readUint32();switch(a){case"LIST":i=e.ioReader.getPos()+BigInt(t),c=await e.ioReader.readString(4),"movi"===c?(this.context.moviList=e.ioReader.getPos()-BigInt(4),this.context.moviEnd=t?this.context.moviList+BigInt(t)+(BigInt(t)&BigInt(1)):this.context.fileSize,r=!0):"INFO"===c?await(0,f.LV)(e.ioReader,BigInt(t),e.metadata):"ncdt"===c&&d.R8("ignore tag ncdt",C,227);break;case"IDIT":{t+=1&t;const a=Math.min(t,63);e.metadata.creation_time=await e.ioReader.readString(a),a<t&&await e.ioReader.skip(t-a);break}case"dmlh":this.context.isOdml=!0,await e.ioReader.skip(t+(1&t));break;case"amvh":n=!0;case"avih":this.context.header.dwMicroSecPerFrame=await e.ioReader.readUint32(),this.context.header.dwMaxBytesPerSec=await e.ioReader.readUint32(),this.context.header.dwPaddingGranularity=await e.ioReader.readUint32(),this.context.header.dwFlages=await e.ioReader.readUint32(),this.context.header.dwTotalFrame=await e.ioReader.readUint32(),this.context.header.dwInitialFrames=await e.ioReader.readUint32(),this.context.header.dwStreams=await e.ioReader.readUint32(),this.context.header.dwSuggestedBufferSize=await e.ioReader.readUint32(),this.context.header.dwWidth=await e.ioReader.readUint32(),this.context.header.dwHeight=await e.ioReader.readUint32(),32&this.context.header.dwFlages&&(this.context.nonInterleaved=!0),await e.ioReader.skip(t-40);break;case"strh":{const a={sampleEnd:!1,currentSample:0};if(a.fccType=await e.ioReader.readString(4),a.fccHandler=await e.ioReader.readString(4),"pads"===a.fccType){await e.ioReader.skip(t-8);break}const r=e.createStream();if(r.privData=a,n&&(a.fccType=r.index?"auds":"vids"),"iavs"===a.fccType||"ivas"===a.fccType)return d.z3("dv format in avi not support now",C,286),o.E$;switch(a.dwFlags=await e.ioReader.readUint32(),a.wPriority=await e.ioReader.readUint16(),a.wLanguage=await e.ioReader.readUint16(),a.dwInitalFrames=await e.ioReader.readUint32(),a.dwScale=await e.ioReader.readUint32(),a.dwRate=await e.ioReader.readUint32(),a.dwScale&&a.dwRate||(this.context.header.dwMicroSecPerFrame?(a.dwRate=1e6,a.dwScale=this.context.header.dwMicroSecPerFrame):(a.dwRate=25,a.dwScale=1)),r.timeBase={num:a.dwScale,den:a.dwRate},(0,g.iU)(r.timeBase),a.dwStart=await e.ioReader.readUint32(),a.dwLength=await e.ioReader.readUint32(),a.dwSuggestedBufferSize=await e.ioReader.readUint32(),a.dwQuality=await e.ioReader.readUint32(),a.dwSampleSize=await e.ioReader.readUint32(),r.startTime=BigInt(0),r.duration=BigInt(a.dwLength),a.dwStart>3600*a.dwRate/a.dwScale&&(d.R8("crazy start time, iam scared, giving up",C,323),a.dwStart=0),a.dwSampleSize<0&&(d.z3(`Invalid sample_size ${a.dwSampleSize} at stream ${r.index} setting it to 0`,C,327),a.dwSampleSize=0),a.dwStart*=Math.max(1,a.dwSampleSize),a.fccType){case"vids":r.codecpar.codecType=0,a.dwSampleSize=0;break;case"auds":r.codecpar.codecType=1;break;case"txts":r.codecpar.codecType=3;break;case"dats":r.codecpar.codecType=2;break;default:d.R8(`unknown stream type ${a.fccType}`,C,351)}a.currentDts=BigInt(0|a.dwStart),await e.ioReader.skip(t-48);break}case"strf":{const a=e.streams[e.streams.length-1];if(!a||this.context.dvDemux){await e.ioReader.skip(t);break}const r=a.privData;if(!t&&(1===a.codecpar.codecType||0===a.codecpar.codecType))break;switch(e.ioReader.getPos()<i&&(t=Math.min(t,Number(BigInt.asIntN(32,i-e.ioReader.getPos())))),a.codecpar.codecType){case 0:{if(n){a.codecpar.width=this.context.header.dwWidth||0,a.codecpar.height=this.context.header.dwHeight||0,a.codecpar.codecId=107,await e.ioReader.skip(t);break}const i=await(0,f.nF)(e.ioReader,a);if(a.codecpar.codecTag===(0,w.A)("DXSB")||a.codecpar.codecTag===(0,w.A)("DXSA")){a.codecpar.codecType=3,a.codecpar.codecId=94211;break}if(t>40&&t<1073741824&&t<this.context.fileSize&&(a.codecpar.extradataSize=i===t-1&&1&i?i-40:t-40,a.codecpar.extradata=(0,l.sY)(a.codecpar.extradataSize),await e.ioReader.readBuffer(a.codecpar.extradataSize,(0,s.JW)(a.codecpar.extradata,a.codecpar.extradataSize))),1&a.codecpar.extradataSize&&await e.ioReader.skip(1),a.codecpar.extradataSize&&a.codecpar.bitsPerCodedSample<=8){let e,t=1<<a.codecpar.bitsPerCodedSample<<2;t=Math.min(t,a.codecpar.extradataSize),e=a.codecpar.extradata+(a.codecpar.extradataSize-t),e-a.codecpar.extradata>=9&&"BottomUp"===(0,s.lH)(a.codecpar.extradata+(a.codecpar.extradataSize-9),8)&&(e-=9),r.pal=new Uint32Array(256);for(let a=0;a<t/4;a++)r.pal[a]=-16777216|A.Y0(e+4*a);r.hasPal=!0}a.codecpar.codecId=R.nz[a.codecpar.codecTag];break}case 1:{let i=await(0,f.ML)(e.ioReader,a,t);if(i<0)return i;r.dshowBlockAlign=a.codecpar.blockAlign,r.dwSampleSize&&a.codecpar.blockAlign&&r.dwSampleSize!==a.codecpar.blockAlign&&(d.R8(`sample size (${r.dwSampleSize}) != block align (${a.codecpar.blockAlign})`,C,437),r.dwSampleSize=a.codecpar.blockAlign),1&t&&await e.ioReader.skip(1),"Axan"===r.fccHandler&&(a.codecpar.codecId=81922,a.codecpar.codecTag=0,r.dshowBlockAlign=0),n&&(a.codecpar.codecId=69651,r.dshowBlockAlign=0),(86018==a.codecpar.codecId||86116==a.codecpar.codecId||86028==a.codecpar.codecId||86016==a.codecpar.codecId)&&r.dshowBlockAlign<=4&&r.dshowBlockAlign&&(d.Yz(`overriding invalid dshow_block_align of ${r.dshowBlockAlign}`,C,458),r.dshowBlockAlign=0),(86018==a.codecpar.codecId&&1024==r.dshowBlockAlign&&1024==r.dwSampleSize||86018==a.codecpar.codecId&&4096==r.dshowBlockAlign&&4096==r.dwSampleSize||86017==a.codecpar.codecId&&1152==r.dshowBlockAlign&&1152==r.dwSampleSize)&&(d.Yz("overriding sample_size",C,465),r.dwSampleSize=0);break}case 3:await e.ioReader.skip(t);break;default:a.codecpar.codecType=2,a.codecpar.codecId=0,a.codecpar.codecTag=0,await e.ioReader.skip(t)}break}case"strd":{const a=e.streams[e.streams.length-1];if(!a||a.codecpar.extradataSize||a.codecpar.codecTag===(0,w.A)("H264")){await e.ioReader.skip(t);break}e.ioReader.getPos()<i&&(t=Math.min(t,Number(i-e.ioReader.getPos()))),a.codecpar.extradata&&(0,l.Eb)(a.codecpar.extradata),a.codecpar.extradataSize=t,a.codecpar.extradata=(0,l.sY)(t),await e.ioReader.readBuffer(t,(0,s.JW)(a.codecpar.extradata,t)),1&a.codecpar.extradataSize&&await e.ioReader.skip(1);break}case"indx":{const a=e.ioReader.getPos();if(1&e.ioReader.flags&&this.options.useOdml){const a={};e.streams.forEach((e=>{const t=e.privData;a[e.index]=t.currentDts}));const t=await this.readOdmlIndex(e);if(t<0)return t;e.streams.forEach((e=>{e.privData.currentDts=a[e.index]}))}await e.ioReader.seek(a+BigInt(t));break}default:if(t>1e6){this.context.moviList=e.ioReader.getPos()-BigInt(4),this.context.moviEnd=this.context.fileSize,r=!0;break}case"idx1":t+=1&t,await e.ioReader.seek(e.ioReader.getPos()+BigInt(t))}}e.streams.forEach((e=>{if(e.codecpar.extradataSize)e.sideData[1]=(0,s.s3)(e.codecpar.extradata,e.codecpar.extradataSize).slice(),27===e.codecpar.codecId?k.XC(e):173===e.codecpar.codecId?D.XC(e):196===e.codecpar.codecId?v.XC(e):225===e.codecpar.codecId?P.XC(e):167===e.codecpar.codecId?M.XC(e):139===e.codecpar.codecId?b.XC(e):86018===e.codecpar.codecId?B.XC(e):86028===e.codecpar.codecId?y.XC(e):86076===e.codecpar.codecId&&z.XC(e),27!==e.codecpar.codecId&&173!==e.codecpar.codecId&&196!==e.codecpar.codecId||x.Bs(e.sideData[1])&&(e.codecpar.flags|=1);else if(86018===e.codecpar.codecId){const a=B.Ij(e.codecpar),t=(0,l.sY)(a.length);(0,s.lW)(t,a.length,a),e.codecpar.extradata=t,e.codecpar.extradataSize=a.length,e.codecpar.profile===h.N_&&(e.codecpar.profile=2)}27!==e.codecpar.codecId&&173!==e.codecpar.codecId&&196!==e.codecpar.codecId&&2!==e.codecpar.codecId&&12!==e.codecpar.codecId||(e.codecpar.flags|=2)})),await e.ioReader.seek(this.context.moviList),this.context.indexLoaded||await this.loadIndex(e),this.context.dvDemux?this.context.nonInterleaved=!1:e.streams.some((e=>!!e.privData.samples))||(this.context.nonInterleaved=!1)}catch(e){return o.LR}return 0}async readOdmlIndex(e){const a=await e.ioReader.readUint16(),t=await e.ioReader.readUint8(),r=await e.ioReader.readUint8(),i=await e.ioReader.readInt32(),c=await e.ioReader.readString(4);let d=await e.ioReader.readUint64();const n=this.getStreamIndex(c);if(n>=e.streams.length)return o.LR;let s=-BigInt(1),l=this.context.fileSize;const p=e.streams[n].privData;if(p.samples||(p.samples=[]),t||i<0)return o.LR;if(await e.ioReader.skip(4),r&&2!==a)return o.LR;if(r>1)return o.LR;if(l>0&&d>=l){if(!(d>>BigInt(32)==(d&BigInt(4294967295))&&(d&BigInt(4294967295))<l&&l<=4294967295))return o.LR;d&=BigInt(4294967295)}for(let a=0;a<i;a++){if(this.context.odmlMaxPos=S.T9(this.context.odmlMaxPos,e.ioReader.getPos()),this.context.odmlRead>this.context.odmlMaxPos)return o.LR;if(r){const a=BigInt(await e.ioReader.readUint32())+d-BigInt(8);let t=await e.ioReader.readInt32();const r=t>=0;t&=2147483647,this.context.odmlRead+=BigInt(8),s!=a&&a!=d-BigInt(8)||(this.context.nonInterleaved=!0),s!=a&&t&&p.samples.push({pos:a,size:t,key:r,dts:p.currentDts}),p.currentDts+=this.getDuration(p,t),s=a}else{this.context.odmlRead+=BigInt(16);let a=await e.ioReader.readUint64();await e.ioReader.skip(8);let t=e.ioReader.getPos();await e.ioReader.seek(a+BigInt(8));let r=await this.readOdmlIndex(e);if(r<0)return r;await e.ioReader.seek(t)}}return this.context.indexLoaded=!0,0}async readIdx1(e,a){let t=!0,r=-BigInt(1),i=-BigInt(1),c=BigInt(0),d=BigInt(0),n=!1,s=a/16;if(s<=0)return o.LR;let l=e.ioReader.getPos();await e.ioReader.seek(this.context.moviList+BigInt(4)),0===await this.syncChunk(e)&&(c=e.ioReader.getPos()-BigInt(8)),this.context.currentIndex=-1,await e.ioReader.seek(l),1===e.streams.length&&e.streams[0].codecpar.codecTag===(0,w.A)("MMES")&&(c=BigInt(0),d=this.context.moviList);for(let a=0;a<s;a++){const a=await e.ioReader.readString(4),o=await e.ioReader.readUint32();let s=BigInt(Math.floor(await e.ioReader.readUint32()));const l=await e.ioReader.readUint32(),p=this.getStreamIndex(a);if(p>=e.streams.length)continue;const f=e.streams[p].privData;f.samples||(f.samples=[]),"p"===a[2]&&"c"===a[3]||(t&&c&&((this.context.moviList+BigInt(4)!==s||s+BigInt(500)>c)&&(d=c-s),t=!1),s+=d,r===s&&(this.context.nonInterleaved=!0),i!==s&&l&&(f.samples.push({pos:s,size:l,key:(16&o)>0,dts:f.currentDts}),i=s),f.currentDts+=this.getDuration(f,l),r=s,16&o&&(n=!0))}return n||e.streams.forEach((e=>{var a;const t=e.privData;null!==(a=t.samples)&&void 0!==a&&a.length&&(t.samples[0].key=!0)})),0}async loadIndex(e){let a=e.ioReader.getPos();const t={};if(e.streams.forEach((e=>{const a=e.privData;t[e.index]=a.currentDts})),!(this.context.moviEnd>=this.context.fileSize)){for(await e.ioReader.seek(this.context.moviEnd);;){const a=await e.ioReader.readString(4),t=await e.ioReader.readUint32();let r=e.ioReader.getPos();if(r<0||r>h.vh-BigInt(Math.floor(t+(1&t))))break;if(r+=BigInt(Math.floor(t+(1&t))),"idx1"===a){await this.readIdx1(e,t);break}await e.ioReader.seek(r)}await e.ioReader.seek(a),this.context.indexLoaded=!0,e.streams.forEach((e=>{e.privData.currentDts=t[e.index]}))}}getNextSample(e){let a,t,r,i,c,d,o=BigInt(0);if(e.streams.forEach((e=>{const a=e.privData;if(!a.samples||!a.samples.length)return a.sampleEnd=!0,!0;a.sampleEnd||r&&!(a.samples[a.currentSample].pos<r.pos)||(r=a.samples[a.currentSample],i=e),a.sampleEnd||c&&!((0,g.k)(a.samples[a.currentSample].dts,e.timeBase,h.KR)<o)||(c=a.samples[a.currentSample],o=(0,g.k)(c.dts,e.timeBase,h.KR),d=e)})),r&&c){const o=(0,g.k)(r.dts,i.timeBase,h.KR),n=(0,g.k)(c.dts,d.timeBase,h.KR),s=Math.abs(Number(o-n));1&e.ioReader.flags?s<5e6?Math.abs(Number(r.pos-e.ioReader.getPos()))>Math.abs(Number(c.pos-e.ioReader.getPos()))?(a=c,t=d):(a=r,t=i):(a=c,t=d):(a=r,t=i)}else r?(a=r,t=i):c&&(a=c,t=d);if(t){const e=t.privData;e.currentSample++,e.currentSample>=e.samples.length&&(e.sampleEnd=!0)}return{sample:a,stream:t}}async readAVPacket_(e,a){if(this.context.currentIndex<0){if(this.context.nonInterleaved&&e.streams.length>1){const{sample:a,stream:t}=this.getNextSample(e);if(!a)return-1048576;await e.ioReader.seek(a.pos),t.privData.currentDts=a.dts}for(;;){let a=await this.syncChunk(e);if(a<0)return a;if(this.context.remaining)break;const t=e.streams[this.context.currentIndex];if(!t)return o.LR;const r=t.privData;r.currentDts+=this.getDuration(r,0)}}const t=e.streams[this.context.currentIndex];if(!t)return o.LR;const r=t.privData;var d;if(c.M[15](a+76,t.timeBase.den),c.M[15](a+72,t.timeBase.num),c.M[15](a+32,t.index),c.M[17](a+16,r.currentDts),c.M[17](a+56,e.ioReader.getPos()-BigInt(8)),0===t.codecpar.codecType)if(null!==(d=r.samples)&&void 0!==d&&d.length){let e=I.El(r.samples,(e=>e.dts>r.currentDts?-1:e.dts===r.currentDts?0:1));e>-1&&r.samples[e].key&&c.M[15](a+36,1|i.f[15](a+36))}else this.context.hasVideoKey||(c.M[15](a+36,1|i.f[15](a+36)),this.context.hasVideoKey=!0);else c.M[15](a+36,1|i.f[15](a+36));let n;this.context.lastPktPos=e.ioReader.getPos(),n=r.dwSampleSize<=1?h.go:r.dwSampleSize<32?1024*r.dwSampleSize:r.dwSampleSize,n>this.context.remaining&&(n=this.context.remaining);const f=(0,l.sY)(n);if(await e.ioReader.readBuffer(n,(0,s.JW)(f,n)),(0,p.NX)(a,f,n),r.hasPal&&n<h.go/2&&!this.context.dvDemux){const e=(0,l.sY)(L.B5);(0,s.lW)(e,L.B5,new Uint8Array(r.pal.buffer)),(0,p.Ow)(a,0,e,L.B5),r.hasPal=!1}return r.dwSampleSize&&c.M[17](a+16,i.f[17](a+16)/BigInt(0|r.dwSampleSize)),2&t.codecpar.flags||c.M[17](a+8,i.f[17](a+16)),r.currentDts+=this.getDuration(r,n),this.context.remaining-=n,this.context.remaining||(this.context.currentIndex=-1,this.context.packetSize=0),0}async readAVPacket(e,a){try{return await this.readAVPacket_(e,a)}catch(a){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(d.z3(`read packet error, ${a}`,C,1063),o.LR):e.ioReader.error}}async syncChunk(e){let a=h.Dh;for(;;)try{if(8&e.ioReader.flags)break;const t=e.ioReader.getPos(),r=await e.ioReader.readString(4),i=await e.ioReader.readUint32();if((this.context.ioFileSize?t:BigInt(0))+BigInt(i)>this.context.fileSize||r.charCodeAt(0)>127){await e.ioReader.seek(t+BigInt(1));continue}if("i"===r[0]&&"x"===r[1]&&this.getStreamIndex(r.slice(2))<e.streams.length||"JUNK"===r||"idx1"===r||"indx"===r){await e.ioReader.skip(i);continue}if("LIST"===r){await e.ioReader.skip(4);continue}const c=this.getStreamIndex(r);if(!(t-this.context.lastPktPos&BigInt(1))&&this.getStreamIndex(r.slice(1))<e.streams.length)continue;if("i"==r[2]&&"x"==r[3]&&c<e.streams.length){await e.ioReader.skip(i);continue}if("w"==r[2]&&"c"==r[3]&&c<e.streams.length){await e.ioReader.skip(56);continue}if(this.context.dvDemux&&0!==c)continue;if(c<e.streams.length){const t=e.streams[c].privData;if("p"==r[2]&&"c"==r[3]&&i<=1028){let a=await e.ioReader.readUint8();const r=a+await e.ioReader.readUint8()-1&255;for(await e.ioReader.skip(2);a<=r;a++)t.pal[a]=-16777216|await e.ioReader.readUint32()>>8;t.hasPal=!0;continue}this.context.currentIndex=c,this.context.remaining=i,this.context.packetSize=i+8,a=e.ioReader.getPos();break}await e.ioReader.seek(t+BigInt(1))}catch(a){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(d.z3(`read packet error, ${a}`,C,1153),o.LR):e.ioReader.error}return a!==h.Dh&&await e.ioReader.seek(a),0}async seek(e,a,t,r){const i=e.ioReader.getPos();if(2&r)return await e.ioReader.seek(t),4&r||await this.syncChunk(e),i;this.context.indexLoaded||BigInt(o.NU);const c=a.privData;let d=h.Dh,n=I.El(c.samples,(e=>e.dts>t?-1:e.dts===t?0:1));if(n>-1&&0===a.codecpar.codecType){let e=n;for(;e>=0;e--)if(c.samples[e].key){n=e;break}e<0&&(n=-1)}return n>-1?(c.currentDts=c.samples[n].dts,c.sampleEnd=!1,c.currentSample=n,d=c.samples[n].pos,I.__(e.streams,(e=>{if(e!==a){const t=e.privData;let r=(0,g.k)(c.currentDts,a.timeBase,e.timeBase),i=I.El(t.samples,(e=>e.dts>r?-1:e.dts===r?0:1));if(i>-1&&0===e.codecpar.codecType){let e=i;for(;e>=0;e--)if(t.samples[e].key){i=e;break}e<0&&(i=-1)}i>=0&&(d=S.jk(d,t.samples[i].pos),t.currentDts=t.samples[i].dts,t.currentSample=i,t.sampleEnd=!1)}})),d!==h.Dh&&(await e.ioReader.seek(d),this.context.currentIndex=-1),i):BigInt(o.NU)}getAnalyzeStreamsCount(){return this.context.header.dwStreams}}},85947:(e,a,t)=>{t.d(a,{A:()=>i});var r=t(134);class i{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},35531:(e,a,t)=>{t.d(a,{LV:()=>g,ML:()=>R,nF:()=>A,yr:()=>w});var r=t(61499),i=t(63939),c=t(50932),d=t(4624),o=t(9705),n=t(53260),s=t(95644),l=t(37837),p=t(14686),f=t(39381),h=t(99991);const m="src\\avformat\\formats\\riff\\iriff.ts";function u(e,a){let t=n.gi[e];return t?(65541===t?t=(0,s.uU)(a,!1,!1,-2):65557===t&&(t=(0,s.uU)(a,!0,!1,0)),69633===t&&8===a&&(t=69676),t):0}async function w(e,a,t){if(t<14)return d.z3("wav format size < 14",m,49),o.LR;c.M[15](a,1);const r=await e.readUint16();let n=await e.readUint16();const s=await e.readUint32();let h=8*await e.readUint32();const w=await e.readUint16();if(c.M[15](a+136,s),c.M[15](a+140,w),14===t?c.M[15](a+40,8):c.M[15](a+40,await e.readUint16()),65534===r?c.M[8](a+8,0):(c.M[8](a+8,r),c.M[15](a+4,u(r,i.f[15](a+40)))),t>=18&&357!==r){let d=await e.readUint16();t-=18,d=Math.min(t,d),d>=22&&65534===r&&(await e.skip(22),d-=22,t-=22),d>0&&(c.M[20](a+12,(0,l.sY)(d)),c.M[15](a+16,d),await e.readBuffer(d,(0,p.JW)(i.f[20](a+12),d)),t-=d),t>0&&await e.skip(t)}else if(357===r&&t>=32){t-=4,c.M[20](a+12,(0,l.sY)(t)),c.M[15](a+16,t),await e.readBuffer(t,(0,p.JW)(i.f[20](a+12),t));const r=f.E3(i.f[20](a+12)+4);if(c.M[15](a+136,f.Y0(i.f[20](a+12)+12)),n=0,h=0,t<8+20*r)return o.LR;for(let e=0;e<r;e++)n+=i.f[2](i.f[20](a+12)+(8+20*e+17))}return c.M[17](a+32,BigInt(h)),i.f[15](a+136)<0?(d.z3(`Invalid sample rate: ${i.f[15](a+136)}`,m,129),o.LR):(86065===i.f[15](a+4)&&(n=0,c.M[15](a+136,0)),69643==i.f[15](a+4)&&i.f[15](a+136)&&c.M[15](a+40,Number(BigInt.asIntN(32,i.f[17](a+32)))/i.f[15](a+136)),n!=i.f[15](a+116)&&(c.M[15](a+112,0),c.M[15](a+116,n)),0)}async function g(e,a,t){const r=e.getPos()+a;for(;e.getPos()<r;){const a=await e.readString(4),r=await e.readUint32(),i=await e.readString(r);t[a]=i,r%2&&await e.skip(1)}}async function A(e,a){const t=await e.readUint32();return a.codecpar.width=await e.readUint32(),a.codecpar.height=await e.readUint32(),await e.skip(2),a.codecpar.bitsPerCodedSample=await e.readUint16(),a.codecpar.codecTag=await e.readUint32(),await e.skip(20),t}async function R(e,a,t){if(t<14)return d.z3("wav header size < 14",m,197),o.LR;let c,s,w;if((0,h.bl)(a.codecpar[r.o9]+112),c=await e.readUint16(),(357!==c||e.isBigEndian())&&(s=await e.readUint16(),a.codecpar.sampleRate=await e.readUint32(),w=8*await e.readUint32(),a.codecpar.blockAlign=await e.readUint16()),a.codecpar.bitsPerCodedSample=14===t?8:await e.readUint16(),65534===c?a.codecpar.codecTag=0:(a.codecpar.codecTag=c,a.codecpar.codecId=u(c,a.codecpar.bitsPerCodedSample)),t>=18&&357!=c){let i=await e.readUint16();if(e.isBigEndian())return d.z3("WAVEFORMATEX support for RIFX files",m,229),o.LR;t-=18,i=Math.min(i,t),i>=22&&65534==c&&(await async function(e,a){const t=await e.readUint16();t&&(a.codecpar.bitsPerCodedSample=t);const i=await e.readUint32();(0,h.ML)(a.codecpar[r.o9]+112,BigInt(i));const c=(await e.readHex(16)).toLocaleUpperCase();var o;c.slice(4)===n.IC||c.slice(4)===n.mO||c.slice(4)===n.dd?(a.codecpar.codecTag=await e.readUint32(),a.codecpar.codecId=u(a.codecpar.codecTag,a.codecpar.bitsPerCodedSample)):(a.codecpar.codecId=(o=c,n.t6[o.toLocaleUpperCase()]||0),a.codecpar.codecId||d.R8(`unknown subformat: ${c}`,m,190))}(e,a),i-=22,t-=22),i>0&&(a.codecpar.extradata&&(0,l.Eb)(a.codecpar.extradata),a.codecpar.extradataSize=i,a.codecpar.extradata=(0,l.sY)(i),await e.readBuffer(i,(0,p.JW)(a.codecpar.extradata,i)),t-=i),t>0&&await e.skip(t)}else if(357==c&&t>=32){t-=4,a.codecpar.extradata&&(0,l.Eb)(a.codecpar.extradata),a.codecpar.extradataSize=t,a.codecpar.extradata=(0,l.sY)(t),await e.readBuffer(t,(0,p.JW)(a.codecpar.extradata,t));const r=f.E3(a.codecpar.extradata+4);if(a.codecpar.sampleRate=f.Y0(a.codecpar.extradata+12),t<8+20*r)return o.LR;for(let e=0;e<r;e++)s+=i.f[2](a.codecpar.extradata+(8+20*e+17))}return a.codecpar.bitrate=BigInt(0|w),a.codecpar.sampleRate<0?(d.z3(`Invalid sample rate ${a.codecpar.sampleRate}`,m,272),o.LR):(86065===a.codecpar.codecId&&(s=0,a.codecpar.sampleRate=0),69643===a.codecpar.codecId&&a.codecpar.sampleRate&&(a.codecpar.bitsPerCodedSample=Number(a.codecpar.bitrate)/a.codecpar.sampleRate),s!==a.codecpar.chLayout.nbChannels&&((0,h.bl)(a.codecpar[r.o9]+112),a.codecpar.chLayout.order=0,a.codecpar.chLayout.nbChannels=s),0)}},53260:(e,a,t)=>{t.d(a,{IC:()=>o,dd:()=>d,gi:()=>i,mO:()=>n,nz:()=>c,t6:()=>s});var r=t(79682);const i={1:65541,2:69638,3:65557,6:65543,7:65542,10:86052,16:69664,17:69633,23:69664,32:69646,34:86037,49:86046,50:86046,56:73728,66:86068,69:69643,20:69643,64:69643,80:86016,85:86017,87:73728,88:73729,97:69635,98:69634,100:69643,105:69633,117:86079,131:86069,255:86018,273:86068,304:86057,309:86106,352:86023,353:86024,354:86053,355:86054,357:86095,358:86096,384:86116,512:69644,533:86022,534:86022,624:86047,654:86111,655:69660,848:86114,1025:86043,1026:86074,1280:86081,1281:86081,5376:86046,5377:86037,5632:86018,5634:86065,8192:86019,8193:86020,8264:86085,8738:86069,27765:65542,28781:86018,16707:86018,16768:86116,22858:81922,29338:86069,33152:86116,41216:86068,41222:86018,41225:86051,61868:86028,65534:86112,21318:69645,22127:86021},c={[(0,r.A)("H261")]:3,[(0,r.A)("H263")]:4,[(0,r.A)("X263")]:4,[(0,r.A)("T263")]:4,[(0,r.A)("L263")]:4,[(0,r.A)("VX1K")]:4,[(0,r.A)("ZyGo")]:4,[(0,r.A)("M263")]:4,[(0,r.A)("lsvm")]:4,[(0,r.A)("I263")]:20,[(0,r.A)("U263")]:4,[(0,r.A)("VSM4")]:4,[(0,r.A)("H264")]:27,[(0,r.A)("h264")]:27,[(0,r.A)("X264")]:27,[(0,r.A)("x264")]:27,[(0,r.A)("avc1")]:27,[(0,r.A)("DAVC")]:27,[(0,r.A)("SMV2")]:27,[(0,r.A)("VSSH")]:27,[(0,r.A)("Q264")]:27,[(0,r.A)("V264")]:27,[(0,r.A)("GAVC")]:27,[(0,r.A)("UMSV")]:27,[(0,r.A)("tshd")]:27,[(0,r.A)("INMC")]:27,[(0,r.A)("FMP4")]:12,[(0,r.A)("DIVX")]:12,[(0,r.A)("DX50")]:12,[(0,r.A)("XVID")]:12,[(0,r.A)("MP4S")]:12,[(0,r.A)("M4S2")]:12,[(0,r.A)("DIVX")]:12,4:12,[(0,r.A)("ZMP4")]:12,[(0,r.A)("DIV1")]:12,[(0,r.A)("BLZ0")]:12,[(0,r.A)("mp4v")]:12,[(0,r.A)("UMP4")]:12,[(0,r.A)("WV1F")]:12,[(0,r.A)("SEDG")]:12,[(0,r.A)("RMP4")]:12,[(0,r.A)("3IV2")]:12,[(0,r.A)("WAWV")]:12,[(0,r.A)("FFDS")]:12,[(0,r.A)("FVFW")]:12,[(0,r.A)("DCOD")]:12,[(0,r.A)("MVXM")]:12,[(0,r.A)("PM4V")]:12,[(0,r.A)("SMP4")]:12,[(0,r.A)("DXGM")]:12,[(0,r.A)("VIDM")]:12,[(0,r.A)("M4T3")]:12,[(0,r.A)("GEOX")]:12,[(0,r.A)("G264")]:12,[(0,r.A)("HDX4")]:12,[(0,r.A)("DM4V")]:12,[(0,r.A)("DMK2")]:12,[(0,r.A)("DYM4")]:12,[(0,r.A)("DIGI")]:12,[(0,r.A)("EPHV")]:12,[(0,r.A)("EM4A")]:12,[(0,r.A)("M4CC")]:12,[(0,r.A)("SN40")]:12,[(0,r.A)("VSPX")]:12,[(0,r.A)("ULDX")]:12,[(0,r.A)("GEOV")]:12,[(0,r.A)("SIPP")]:12,[(0,r.A)("SM4V")]:12,[(0,r.A)("XVIX")]:12,[(0,r.A)("DreX")]:12,[(0,r.A)("QMP4")]:12,[(0,r.A)("PLV1")]:12,[(0,r.A)("GLV4")]:12,[(0,r.A)("GMP4")]:12,[(0,r.A)("MNM4")]:12,[(0,r.A)("GTM4")]:12,[(0,r.A)("MPG4")]:14,[(0,r.A)("MP41")]:14,[(0,r.A)("MP42")]:15,[(0,r.A)("DIV2")]:15,[(0,r.A)("MP43")]:16,[(0,r.A)("DIV3")]:16,[(0,r.A)("MPG3")]:16,[(0,r.A)("DIV5")]:16,[(0,r.A)("DIV6")]:16,[(0,r.A)("DIV4")]:16,[(0,r.A)("DVX3")]:16,[(0,r.A)("AP41")]:16,[(0,r.A)("COL1")]:16,[(0,r.A)("COL0")]:16,[(0,r.A)("WMV1")]:17,[(0,r.A)("WMV2")]:18,[(0,r.A)("GXVE")]:18,[(0,r.A)("dvsd")]:24,[(0,r.A)("dvhd")]:24,[(0,r.A)("dvh1")]:24,[(0,r.A)("dvsl")]:24,[(0,r.A)("dv25")]:24,[(0,r.A)("dv50")]:24,[(0,r.A)("cdvc")]:24,[(0,r.A)("CDVH")]:24,[(0,r.A)("CDV5")]:24,[(0,r.A)("dvc ")]:24,[(0,r.A)("dvcs")]:24,[(0,r.A)("dvh1")]:24,[(0,r.A)("dvis")]:24,[(0,r.A)("pdvc")]:24,[(0,r.A)("SL25")]:24,[(0,r.A)("SLDV")]:24,[(0,r.A)("AVd1")]:24,[(0,r.A)("mpg1")]:2,[(0,r.A)("mpg2")]:2,[(0,r.A)("MPEG")]:2,[(0,r.A)("PIM1")]:2,[(0,r.A)("PIM2")]:2,[(0,r.A)("VCR2")]:2,268435457:2,268435458:2,268435460:2,[(0,r.A)("DVR ")]:2,[(0,r.A)("MMES")]:2,[(0,r.A)("LMP2")]:2,[(0,r.A)("slif")]:2,[(0,r.A)("EM2V")]:2,[(0,r.A)("M701")]:2,[(0,r.A)("M702")]:2,[(0,r.A)("M703")]:2,[(0,r.A)("M704")]:2,[(0,r.A)("M705")]:2,[(0,r.A)("mpgv")]:2,[(0,r.A)("BW10")]:2,[(0,r.A)("XMPG")]:2,[(0,r.A)("MJPG")]:7,[(0,r.A)("RV40")]:69,[(0,r.A)("AV01")]:225,[(0,r.A)("VP80")]:139,[(0,r.A)("VP90")]:167,[(0,r.A)("HEVC")]:173,[(0,r.A)("H265")]:173},d="00001000800000AA00389B71",o="2107D3118644C8C1CA000000",n="0000000000001000800000AA",s={"2C806DE046DBCF11B4D100805F6CBBEA":86019,BFAA23E958CB7144A119FFFA01E4CE62:86055,D242E147BA368D4D88FC61654F8C836C:86104,AF87FBA7022DFB42A4D405CD93843BDD:86056,"2B806DE046DBCF11B4D100805F6CBBEA":86016,"82EC1F6ACADB1945BDE756D3B3EF981D":69673,"3AC1FA38811D4361A40DCE53CA607CD1":86112}},79682:(e,a,t)=>{t.d(a,{A:()=>c});var r=t(4624);const i="src\\avformat\\function\\mktagle.ts";function c(e){4!==e.length&&r.R8(`tag length is not 4, tag: ${e}`,i,30);let a=0;for(let t=3;t>=0;t--)a=a<<8|e.charCodeAt(t);return a}},95832:(e,a,t)=>{t.d(a,{Bq:()=>p,Ij:()=>l,XC:()=>s,f7:()=>f,uF:()=>c});var r=t(77231),i=t(37246);const c={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},d={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],n=[r.N_,1,2,3,4,5,6,7];function s(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a){const{profile:t,sampleRate:i,channels:c}=function(e){let a=r.N_,t=r.N_,i=r.N_;return e.length>=2&&(a=e[0]>>3&31,t=o[(7&e[0])<<1|e[1]>>7],i=n[e[1]>>3&15]),{profile:a,sampleRate:t,channels:i}}(a);e.codecpar.profile=t,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=c,e.codecpar.frameSize=5===t?2048:1024,e.codecpar.format=8}}function l(e){const a=d[e.sampleRate],t=e.chLayout.nbChannels,i=e.profile===r.N_?2:e.profile,c=new Uint8Array(2);return c[0]=(31&i)<<3|(14&a)>>1,c[1]=(1&a)<<7|(15&t)<<3,c}function p(e){if(e.length<7)return-1;const a=e[0]<<4|e[1]>>4;if(4095!==a)return-1;const t=1&e[1],r=(192&e[2])>>>6,i=(60&e[2])>>>2,c=(1&e[2])<<2|(192&e[3])>>>6,d=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,s=3&e[6];let l=1===t?7:9,p=d-l;return{syncWord:a,profile:r+1,sampleRate:o[i],channels:n[c],aacFrameLength:d,numberOfRawDataBlocksInFrame:s,headerLength:l,framePayloadLength:p}}function f(e,a){function t(){const e=a.readU(2);let t=0;for(let r=0;r<=e;r++)t<<=8,t|=a.readU(8);return t}a||(a=new i.A).appendBuffer(e);const r=a.getPointer(),c={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},d=a.readU(11);if(695!==d)return-1;c.syncWord=d,c.muxLengthBytes=a.readU(13);const s=1===a.readU1();if(c.useSameStreamMux=s,!s){const e=1===a.readU1();if(e&&1===a.readU1())return-1;if(e&&t(),1!==a.readU1())return-1;if(0!==a.readU(6))return-1;if(0!==a.readU(4))return-1;if(0!==a.readU(3))return-1;let r=e?t():0;const i=a.readU(5);r-=5;const d=a.readU(4);r-=4;const s=a.readU(4);if(r-=4,a.readU(3),r-=3,r>0&&a.readU(r),0!==a.readU(3))return-1;if(a.readU(8),1===a.readU1())if(e)t();else{let e=0;for(;;){e<<=8;const t=1===a.readU1();if(e+=a.readU(8),!t)break}}1===a.readU1()&&a.readU(8),c.profile=i+1,c.sampleRate=o[d],c.channels=n[s]}let l=0;for(;;){const e=a.readU(8);if(l+=e,255!==e)break}return c.framePayloadLength=l,c.headerLength=a.getPointer()-r+(8===a.getBitLeft()?0:1),c}},21477:(e,a,t)=>{t.d(a,{Ui:()=>d,XC:()=>c,zk:()=>i});var r=t(37246);t(83314),t(97317);const i={0:"Main",1:"High",2:"Professional"};function c(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=4){const t=d(a);e.codecpar.profile=t.profile,e.codecpar.level=t.level}}function d(e){const a=new r.A(e.length);a.appendBuffer(e),a.readU1(),a.readU(7);const t=a.readU(3),i=a.readU(5),c=a.readU1();let d=a.readU1()?10:8;return a.readU1()&&(d=12),{profile:t,level:i,tier:c,bitDepth:d,monochrome:a.readU1(),chromaSubsamplingX:a.readU1(),chromaSubsamplingY:a.readU1(),chromaSamplePosition:a.readU(2)}}},14769:(e,a,t)=>{t.d(a,{DK:()=>o,XC:()=>s,Xr:()=>n,jA:()=>c,ob:()=>i,oe:()=>d});var r=t(31865);const i=34,c=8,d=[0,8,12,0,16,20,24,32],o=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],n=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function s(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length===i){const{bitsPerRawSample:t,sampleRate:i,channels:c}=function(e){const a=new r.A(e);a.skip(10);const t=a.readUint24();return{sampleRate:t>>4,channels:1+((15&t)>>>1),bitsPerRawSample:1+((1&t)<<4|(240&a.readUint8())>>>4)}}(a);e.codecpar.bitsPerRawSample=t,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=c}}},22576:(e,a,t)=>{t.d(a,{Ij:()=>s,XC:()=>n,kt:()=>o});var r=t(31865),i=t(729),c=t(44328);const d=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(e){let a=0,t=0,r=0;if(e.length<1)return 0;switch(a=e[0],t=d[a>>3],3&a){case 0:r=1;break;case 1:case 2:r=2;break;case 3:if(e.length<2)return 0;r=63&e[1]}return r*t}function n(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=19){const t=new r.A(a,!1);t.skip(9),e.codecpar.chLayout.nbChannels=t.readUint8(),e.codecpar.initialPadding=t.readUint16(),e.codecpar.sampleRate=t.readUint32(),e.codecpar.seekPreroll=Number((0,c.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function s(e){const a=new Uint8Array(19),t=new i.A(a,!1);return t.writeString("OpusHead"),t.writeUint8(1),t.writeUint8(e.chLayout.nbChannels),t.writeUint16(e.initialPadding),t.writeUint32(e.sampleRate),a}},97077:(e,a,t)=>{t.d(a,{Ui:()=>c,XC:()=>i});var r=t(37246);function i(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=6){const t=c(a);e.codecpar.profile=t.profile,e.codecpar.level=t.level}}function c(e){const a=new r.A(e.length);return a.appendBuffer(e.subarray(4)),{profile:a.readU(8),level:a.readU(8),bitDepth:a.readU(4),chromaSubsampling:a.readU(3),fullRangeFlag:a.readU1(),colorPrimaries:a.readU(8),colorTrc:a.readU(8),colorSpace:a.readU(8)}}},82014:(e,a,t)=>{t.d(a,{Ui:()=>d,XC:()=>c,wN:()=>i}),t(9599);var r=t(37246);t(77231),t(97317),t(44328),t(729);const i={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function c(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=6){const t=d(a);e.codecpar.profile=t.profile,e.codecpar.level=t.level}}function d(e){const a=new r.A(e.length);return a.appendBuffer(e),{profile:a.readU(8),level:a.readU(8),bitDepth:a.readU(4),chromaSubsampling:a.readU(3),fullRangeFlag:a.readU1(),colorPrimaries:a.readU(8),colorTrc:a.readU(8),colorSpace:a.readU(8)}}},2911:(e,a,t)=>{t.d(a,{B5:()=>r});const r=1024},null:()=>{},95644:(e,a,t)=>{function r(e,a,t,r){if(e<=0||e>64)return 0;if(a)switch(e){case 32:return t?65556:65557;case 64:return t?65558:65559;default:return 0}else if(e+=7,r&1<<(e>>>=3)-1)switch(e){case 1:return 65540;case 2:return t?65537:65536;case 3:return t?65549:65548;case 4:return t?65545:65544;case 8:return t?65568:65567;default:return 0}else switch(e){case 1:return 65541;case 2:return t?65539:65538;case 3:return t?65551:65550;case 4:return t?65547:65546;default:return 0}}function i(e){switch(e){case 69649:return 2;case 69648:return 3;case 69647:case 69633:case 69632:case 69645:case 69638:return 4;default:return function(e){switch(e){case 86070:case 86071:case 69674:case 69644:case 69678:case 69651:case 69661:case 69677:case 69655:case 69664:case 69636:case 69675:case 69660:case 69646:case 69670:return 4;case 86089:case 86090:case 86091:case 86092:case 65543:case 65542:case 65571:case 65540:case 65563:case 65572:case 65541:case 81924:case 81926:return 8;case 65537:case 65566:case 65536:case 65554:case 65539:case 65538:return 16;case 65552:case 65549:case 65548:case 65564:case 65551:case 65550:return 24;case 65545:case 65544:case 65565:case 65547:case 65546:case 65556:case 65557:case 65570:case 65569:return 32;case 65558:case 65559:case 65568:case 65567:return 64;default:return 0}}(e)}}t.d(a,{MZ:()=>i,uU:()=>r})}}]);